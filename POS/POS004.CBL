      $set LINKCOUNT"512"
      ******************************************************************
      *                                                                *
      *  *******     ******	******	   ****       ****	  **   *
      *  **    **   **	  **   **    **   **  **     **  **	 ***   *
      *  **    **   **	  **   **	 **    **   **	  **	* **   *
      *  *******    **	  **	******	 **    **   **	  **   *  **   *
      *  **	    **	  **	     **  **    **   **	  **  *******  *
      *  **	    **	  **   **    **   **  **     **  **	  **   *
      *  **	     ******	******	   ****       ****	 ****  *
      *                                                                *
      *     ENGLISH                                                    *
      *                                                                *
      *     ( A P A C )   P O S   P R O G R A M M I N G   K E Y S      *
      *                                                                *
      *     P O S  -   U S I N G   P R O G R A M M A B L E   K E Y S   *
      *                                                                *
      *     VERSION 8.14.03 - May 2010				       *
      * 							       *
      ******************************************************************
000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID.     POS004.
000030 AUTHOR.         J W LEMMON  (APAC).
000040 DATE-WRITTEN.   JUNE 1990.

		   COPYRIGHT NOTICE: COPYRIGHT (C) 1990 - 2010
				     by James William Lemmon.
				       (Id No. 4412165050082).

		   All rights reserved.

		   e-mail jwlemmon@gmail.com.

000050 SECURITY.
		   This program is free software; you can redistribute
		   it and/or modify it under the terms of the GNU General
		   Public License as published by the Free Software
		   Foundation; either version 2 of the License, or (at
		   your option) any later version.

		   This program is distributed in the hope that it will
		   be useful, but WITHOUT ANY WARRANTY; without even the
		   implied warranty of MERCHANTABILITY or FITNESS FOR A
		   PARTICULAR PURPOSE.	See the GNU General Public License
		   for more details.

		   You should have received a copy of the GNU General
		   Public License along with this program; if not, write
		   to the Free Software Foundation, Inc., 59 Temple Place
		   - Suite 330, Boston, MA 02111-1307, USA.

000050 ENVIRONMENT DIVISION.
000060 CONFIGURATION SECTION.
000070 SPECIAL-NAMES.  
000080		       CURSOR IS CSTART
000090		       CONSOLE IS CRT
		       CRT STATUS IS KEY-STATUS.
000090 INPUT-OUTPUT SECTION.
000100 FILE-CONTROL.

       COPY APACFIDS.SL.

000140 COPY DEPART.SL.

000120 COPY PARAM.SL.

       COPY POSPLU.SL.

	   SELECT POSKBD  ASSIGN DISK
			  LOCK MANUAL
                          WITH LOCK ON MULTIPLE RECORDS
000180                    STATUS WS-STATUS
000190                    ACCESS DYNAMIC
000200                    ORGANIZATION INDEXED
000210			  RECORD POS-KEY
			  ALTERNATE RECORD POS-KEY2 DUPLICATES.

000180 COPY STOCK.SL.

      /
000320 DATA DIVISION.
000330 FILE SECTION.

       COPY APACFIDS.FDE.

000370 COPY DEPART.FDE.

000350 COPY PARAM.FDE.

       COPY POSPLU.FDE.

000010 FD  POSKBD    LABEL RECORD STANDARD
000020		     VALUE OF FILE-ID "POSKBD".
000030 01  POS-RECORD1.
	   03  POS-KEY.
	       05  POS-ACT	PIC  X(01).
	       05  POS-CODE.
		   07  POS-HEX	PIC  X(01) COMP-X.
      *
      *    SPECIFIES THE PLU-NUMBER
      *
	   03  POS-KEY2.
	       05  POS-NO	PIC  9(03).

000390 COPY STOCK.FDE.

      /
000570 WORKING-STORAGE SECTION.
       77  WS-CHECK	   PIC	X(18)	 VALUE
			   "aeWlimemnomLalismJ".
       77  WS-S1	   PIC	9(02) COMP-0.
001720 77  WS-S2	   PIC	9(04)	 COMP-5.
001730 77  WS-S3	   PIC	9(04)	 COMP-5.
001740 77  WS-S4	   PIC	9(04)	 COMP-5.
001750 77  WS-S5	   PIC	9(04)	 COMP-5.
001760 77  WS-S6	   PIC	9(04)	 COMP-5.
001770 77  WS-S7	   PIC	9(04)	 COMP-5.
001780 77  WS-S8	   PIC	9(04)	 COMP-5.
001790 77  WS-IXS	   PIC	9(04)	 COMP-5.
001800 77  WS-IXS1	   PIC	9(04)	 COMP-5.
001810 77  WS-IXS2	   PIC	9(04)	 COMP-5.
001820 77  WS-IXS3	   PIC	9(04)	 COMP-5.
001830 77  WS-IXS4	   PIC	9(04)	 COMP-5.
       77  WS-SM	   PIC	9(02) COMP-0.
000930 77  WS-OPTION	   PIC	X(01).
001870 77  WS-DEPKEY	   PIC	9(06)	 COMP-5.
000700 77  WS-PARKEY	   PIC	9(04)	 COMP-5.
       77  WS-REPLY	   PIC	X(01).
       77  WS-ERROR	   PIC	9(01).
       77  WS-ACT	   PIC	X(01).
       77  WS-USE-ITM	   PIC	X(01).
       77  WS-EXT-STK	   PIC	X(01).
       77  WS-KEY-PRESSED  PIC	X(18).
       77  PRG-NAME	   PIC	X(12) VALUE "STP\STPLOOK".
       77  TODAY-DDMMYY	   PIC	9(08) COMP-5.
       77  WS-USUB	   PIC	9(04) COMP-5.
       77  WS-PLU	   PIC	9(03).
       77  WS-PLU-IND	   PIC	9(01).
       77  WS-NODEP	   PIC	X(30) VALUE
			   "NO SUCH   D E P A R T M E N T".

002420 01  WS-DB-LINE.
002430     03  WS-TOP-LNE.
002440         05  WS-TCHR PIC X(01) OCCURS 80.
           03  WS-T-LINE REDEFINES WS-TOP-LNE.
               05  FILLER  PIC X(01).
               05  WS-H-LINE
                           PIC X(78).
               05  FILLER  PIC X(01).
002430     03  WS-TOP-LNE2.
002440         05  WS-TCH  PIC X(01) OCCURS 80.
           03  WS-TP-LINE2 REDEFINES WS-TOP-LNE2.
               05  FILLER      PIC  X(01).
               05  WS-TOP-COMP PIC  X(40).
001430	       05  FILLER      PIC  X(23).
	       05  WS-WRKHD    PIC  X(11).
001430	       05  FILLER      PIC  X(01).
	       05  WS-WRKST    PIC  X(03).
001430	       05  FILLER      PIC  X(01).
002450	   03  WS-MID-LNE.
002460         05  WS-MCHR PIC X(01) OCCURS 80.
	   03  WS-MST-LNE REDEFINES WS-MID-LNE.
	       05  WS-MST1     PIC  X(01).
	       05  WS-MST78    PIC  X(78).
	       05  WS-MST80    PIC  X(01).
003020	   03  WS-MID-LNE2.
	       05  FILLER      PIC  X(01) VALUE "³".
	       05  WS-BLNK78   PIC  X(78) VALUE ALL "°".
	       05  FILLER      PIC  X(01) VALUE "³".
003040	   03  WS-BOT-LINE.
002480         05  WS-BCHR PIC X(01) OCCURS 80.
003060	   03  WS-BOT-LNE2.
002480         05  WS-BCH  PIC X(01) OCCURS 80.
003240	   03  WS-B-LINE REDEFINES WS-BOT-LNE2.
003250         05  FILLER  PIC X(01).
               05  WS-MEM-LINE.
003260            07  WS-SRT-LINE
003270                     PIC X(50).
                  07  FILLER
                           PIC X(10).
003280         05  FILLER  PIC X(19).
	   03  WS-MM-LINE.
               05  FILLER  PIC  X(01) VALUE X"B3".
               05  FILLER  PIC  X(60) VALUE SPACES.
               05  FILLER  PIC  X(01) VALUE X"B3".
           03  WS-HME-LINE PIC  X(60) VALUE ALL X"CD".

       COPY WS.WS.

       01  WS-HELP.
	   03  WS-MODULE       PIC  X(03) VALUE "POS".
	   03  WS-PROG	       PIC  X(03) VALUE "004".

       COPY FUNCTION.WS.

000290 01  WS-PARID.
000020	   03  WS-SYS-ID       PIC  X(03).

001280 01  W02-FID.

       COPY APACFIDS.ID.

000370 COPY DEPART.ID.

       COPY PARAM.ID.

000450 COPY POSPLU.ID.

000390 COPY STOCK.ID.

       COPY W05.VAT.

       COPY W10.STK.

       COPY W12.WS.

       COPY W11.STK.

       COPY W40.WS.

003800 COPY W50.WS.

       COPY W75.STK.

       01  W90-MENUS.
	   03  W90-MENU        PIC  X(14) OCCURS 10.

004120 01  W95-COMP            PIC X(40).

005120 01  W100-EDIT.
003970     03  W100-V2.
003980         05  W100-S6V2   PIC Z(05)9.99-.
           03  W100-V3 REDEFINES W100-V2.
               05  W100-PRICE  PIC X(09).
               05  FILLER      PIC X(01).
           03  W100-V5 REDEFINES W100-V2.
               05  W100-QNT    PIC Z(05)9.99-.

       01  W200-MEMO.
           03  W200-MEM-FLDS. 
               05  W200-MEM1   PIC  X(60).
               05  W200-MEM2   PIC  X(60).
               05  W200-MEM3   PIC  X(60).
               05  W200-MEM4   PIC  X(60).
               05  W200-MEM5   PIC  X(60).
               05  W200-MEM6   PIC  X(60).
               05  W200-MEM7   PIC  X(60).
               05  W200-MEM8   PIC  X(60).
               05  W200-MEM9   PIC  X(60).
               05  W200-MEM10  PIC  X(60).
               05  W200-MEM11  PIC  X(60).
               05  W200-MEM12  PIC  X(60).
           03  W200-MEM-FOC REDEFINES W200-MEM-FLDS.
               05  W200-MEM    PIC  X(60) OCCURS 12.

       LINKAGE SECTION.

       COPY CHAIN.LS.

      /
003780 SCREEN SECTION.

       COPY BLANK.CRT.

       01  MENU-INSTRUCT.
	   03  LINE 25 COLUMN  2 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 1
				 VALUE "Use ".
	   03	       COLUMN  6 HIGHLIGHT
				 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 6
				 VALUE "".
	   03	       COLUMN  7 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 1
				 VALUE " or ".
	   03	       COLUMN 11 HIGHLIGHT
				 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 6
				 VALUE "".
	   03	       COLUMN 12 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 1
				 VALUE " to point to an item, and ".
	   03	       COLUMN 38 HIGHLIGHT
				 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 6
				 VALUE "<Enter>".
	   03	       COLUMN 45 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 1
				 VALUE " to Select ".
	   03	       COLUMN 56 HIGHLIGHT
				 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 6
				 VALUE "<Esc>".
	   03	       COLUMN 61 BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 1
				 VALUE " to Exit".

000850 01  S-PROG.
000860	   03  LINE  2 COLUMN 33 FOREGROUND-COLOR 7
				 HIGHLIGHT
				 VALUE "PROGRAMMING KEYS".

       01  S-MENU.
	   03  LINE  4 COLUMN 28 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 2 HIGHLIGHT
				 VALUE "ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ".
	   03	       COLUMN 53 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 0
				 VALUE "¿".
	   03  LINE  5 COLUMN 28 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 2 HIGHLIGHT
				 VALUE "³  ".
	   03	       COLUMN 31 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 7
				 HIGHLIGHT
				 VALUE "PROGRAMMING OPTIONS".
	   03	       COLUMN 50 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 0
				 VALUE "   ³".
	   03  LINE  6 COLUMN 28 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 2 HIGHLIGHT
				 VALUE "³ ".
	   03	       COLUMN 30 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 7
				 HIGHLIGHT
				 VALUE "1".
	   03	       COLUMN 31 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 0
				 VALUE " Programme keys       ³".
	   03  LINE  7 COLUMN 28 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 2 HIGHLIGHT
				 VALUE "³ ".
	   03	       COLUMN 30 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 7
				 HIGHLIGHT
				 VALUE "2".
	   03	       COLUMN 31 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 0
				 VALUE " Test the Keys        ³".
001470	   03  LINE  8 COLUMN 28 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 2 HIGHLIGHT
				 VALUE "³ ".
	   03	       COLUMN 30 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 7
				 HIGHLIGHT
				 VALUE "3".
	   03	       COLUMN 31 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 0
				 VALUE " List Keyboard Layout ³".
001470	   03  LINE  9 COLUMN 28 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 2 HIGHLIGHT
				 VALUE "³ ".
	   03	       COLUMN 30 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 7
				 HIGHLIGHT
				 VALUE "4".
	   03	       COLUMN 31 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 0
				 VALUE " View Keyboard Layout ³".
001470	   03  LINE 10 COLUMN 28 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 2 HIGHLIGHT
				 VALUE "³ ".
	   03	       COLUMN 30 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 7
				 HIGHLIGHT
				 VALUE "0".
	   03	       COLUMN 31 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 0
				 VALUE " Exit                 ³".
	   03  LINE 11 COLUMN 28 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 2 HIGHLIGHT
				 VALUE "À".
	   03	       COLUMN 29 BACKGROUND-COLOR 2
				 FOREGROUND-COLOR 0
				 VALUE "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ".

       COPY S99.CRT.

       COPY ERROR.CRT.

       COPY OPT.CRT.

001230 PROCEDURE DIVISION
		 USING LS-PARID LS-USER-ID LS0-PROGRAMS LS0-SECURITY.
004790 AA000		  SECTION.
006580 AA00.
003240	   IF LS0-PALEV < 3 AND LS0-SALEV < 9
	       MOVE "Not Authorised"
				 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
	       GO TO AY005.
006590	     PERFORM ZA00-INIT.
	   IF WS-ERROR = 9
	       PERFORM FA000.

006620 AA01.
	   IF MOUSE-ATTACHED = "Y"
	       MOVE 66		 TO MOUSE-FUNC
	       MOVE 1		 TO MOUSE-PARAM
	       CALL X"AF" USING MOUSE-FUNC
				MOUSE-PARAM.
006630       DISPLAY CLR-SCREEN.
	     DISPLAY S-PROG.
	     MOVE 5		 TO SHADE-ROW.
	     MOVE 30		 TO SHADE-COL.
	     MOVE 24		 TO SHADE-WIDTH.
	     MOVE 7		 TO SHADE-LINES.
	     DISPLAY S-MENU.
	     DISPLAY MENU-INSTRUCT.
	     PERFORM SCREEN-SHADOW.
       AA02.
	     MOVE 5		 TO TOP-ROW.
	     MOVE 9		 TO BOTTOM-ROW.
	     MOVE 4		 TO SCREEN-LIN.
	     MOVE 30		 TO SCREEN-COL.
	     MOVE 22		 TO STRING-LENGTH.
	     PERFORM SAVE-ATTR.

       AA05.
	     CALL X"AF" USING GET-SINGLE-CHAR, KEY-STATUS.

006660 AA10.
	   IF ADIS-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN UP-KEY	 PERFORM MOVE-BLOCK-UP
		 WHEN DOWN-KEY	 PERFORM MOVE-BLOCK-DOWN
		 WHEN MOUSE-KEY  PERFORM POSITION-MOUSE
				 IF MOUSE-ENTER = "Y"
				     MOVE "N"	 TO MOUSE-ENTER
				     GO TO AA15
				 END-IF
				 IF MOUSE-Y = 24
				     IF MOUSE-X = 5
					 MOVE 5  TO KEY-CODE-1
					 GO TO AA10
				     ELSE
				     IF MOUSE-X = 10
					 MOVE 6  TO KEY-CODE-1
					 GO TO AA10
				     ELSE
				     IF MOUSE-X > 36 AND < 44
					 MOVE 0  TO KEY-CODE-1
					 GO TO AA10
				     ELSE
				     IF MOUSE-X > 54 AND < 60
					 MOVE 0  TO KEY-CODE-1
					 MOVE 1  TO KEY-TYPE
					 GO TO AA10
				     END-IF
				 END-IF
		 WHEN ENTER-KEY  GO TO AA15
		 WHEN OTHER	 CALL X"E5"
	       END-EVALUATE
	       GO TO AA05
	   ELSE
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		     MOVE "0"	 TO WS-OPTION
		     GO TO AA18
		 WHEN OTHER	 CALL X"E5"
	       END-EVALUATE
	       GO TO AA05
	   ELSE
	   IF DATA-8BIT
	       MOVE KEY-CODE-1X  TO WS-OPTION
	       CALL "CBL_TOUPPER" USING WS-OPTION
				  BY VALUE WS-LENGTH
				  RETURNING WS-STATUS
	       IF (WS-OPTION < "0" OR > "4") AND
		  (WS-OPTION NOT = "?")
		   CALL X"E5"
		   GO TO AA05
	       END-IF
	       GO TO AA16
	   ELSE
	       CALL X"E5"
	       GO TO AA05.

       AA15.
	   IF SCREEN-LIN < 5
	       CALL X"E5"
	       GO TO AA05
	   ELSE
	   IF SCREEN-LIN = 5
	       MOVE "1"		 TO WS-OPTION
	   ELSE
	   IF SCREEN-LIN = 6
	       MOVE "2"		 TO WS-OPTION
	   ELSE
	   IF SCREEN-LIN = 7
	       MOVE "3"		 TO WS-OPTION
	   ELSE
	   IF SCREEN-LIN = 8
	       MOVE "4"		 TO WS-OPTION
	   ELSE
	   IF SCREEN-LIN = 9
	       MOVE "0"		 TO WS-OPTION.
	   GO TO AA18.

       AA16.
	     PERFORM CLEAR-BLOCK.
	   IF WS-OPTION = "0" OR "?"
	       MOVE 9		 TO SCREEN-LIN
	   ELSE
	   IF WS-OPTION = "1"
	       MOVE 5		 TO SCREEN-LIN
	   ELSE
	   IF WS-OPTION = "2"
	       MOVE 6		 TO SCREEN-LIN
	   ELSE
	   IF WS-OPTION = "3"
	       MOVE 7		 TO SCREEN-LIN
	   ELSE
	   IF WS-OPTION = "4"
	       MOVE 8		 TO SCREEN-LIN.
	     PERFORM SAVE-ATTR.
	     PERFORM MARK-BLOCK.

       AA18.
	   IF MOUSE-ATTACHED = "Y"
	       MOVE 66		 TO MOUSE-FUNC
	       MOVE 0		 TO MOUSE-PARAM
	       CALL X"AF" USING MOUSE-FUNC
				MOUSE-PARAM.
006730	   IF WS-OPTION = "0"
006740         GO TO AY000-EOJ.
006750     IF WS-OPTION = "1"
006760	       PERFORM BA000
006770     ELSE
006780     IF WS-OPTION = "2"
006790	       PERFORM BB000
006800     ELSE
006810     IF WS-OPTION = "3"
006820	       PERFORM DA000
006830     ELSE
006840     IF WS-OPTION = "4"
006850	       PERFORM EA000
	   ELSE
	   IF WS-OPTION = "?"
	       PERFORM FA000.
007060	     GO TO AA01.

       COPY AA50.LUP.

      *
      *    ****   D I S P L A Y   L O O K U P   O P T I O N S 
      *
011010 AA300              SECTION.
011020 AA301.
011010	     DISPLAY "F1" AT 2502
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "=Help,"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "F2" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011020		     "=Item/"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011030		     "F3" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011040		     "=Alt/"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011050		     "F4" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011060		     "=Desc/"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011050		     "F5" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011060		     "=Desc2/"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011070		     "F6" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011080		     "=X/Ref Find,"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011030		     "F8" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "=Prompt,"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011070		     "Esc" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "ape"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
011110 AA305.
011120       EXIT.
      *
      *    ****    D I S P L A Y   D E P A R T M E N T	 N A M E
      *
       AA400              SECTION.
       AA401.
             MOVE SPACES         TO W10-DEPT.
           IF W10-LEDG > 0 AND < 297
               MOVE W10-LEDG     TO WS-DEPKEY
               PERFORM READ-DEPART THRU READ-DEPART-EXIT
               MOVE DPT-DESC     TO W10-DEPT.
           IF W10-DEPT = SPACES
               MOVE WS-NODEP     TO W10-DEPT.
	     DISPLAY W10-DEPT AT 0322
		     WITH FOREGROUND-COLOR 6 HIGHLIGHT
			  BACKGROUND-COLOR 5.
       AA405.
             EXIT.

      /
008260 AY000-END              SECTION.
008270 AY000-EOJ.
008280	     CLOSE POSPLU
		   POSKBD.

       AY005.
             EXIT PROGRAM.

       COPY CA000.STK.

       COPY CA100.STK.

       COPY CA200.STK.

       COPY CA500.STK.

       COPY LOCKED.REC.

       COPY FUNCTION.CRT.

       COPY OPTION.CRT.

       COPY CLEAR.CRT.

       COPY ABORT.PRN.

       COPY APAC.HLP.

      /
007310 AN00-READ               SECTION.

       COPY DEPART.RD.

       COPY PARAM.RD.

       COPY POSKBD.RD.

       COPY POSPLU.RD.

       COPY STOCK.RD.

      /
007770 AO00-WRITE              SECTION.

       COPY PARAM.WR.

       COPY POSKBD.WR.

       COPY POSPLU.WR.

       BA000	       SECTION 50.
       BA0.
	     MOVE ZERO		 TO PLU-SUB0 PLU-SUB1 PLU-SUB2
				    PLU-SUB3 PLU-SUB4 PLU-SUB5
				    PLU-SUB6 PLU-SUB7 PLU-SUB8
				    PLU-SUB9.
	     MOVE SPACES	 TO PLU-TYPE PLU-VALUE.
	     MOVE 0		 TO WS-SM.

       BA00.
	     DISPLAY CLR-SCREEN.
	     DISPLAY "PROGRAMME P.O.S. KEYS" AT 0230
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.

       BA00A.
	   IF WS-SM = 0
	       GO TO BA00B
	   ELSE
	       MOVE 1		 TO WS-S1.
	     MOVE 0411		 TO CPOS.

       BA00AB.
	   IF WS-S1 = WS-SM
	       DISPLAY W90-MENU (WS-S1) AT CPOS
		       WITH FOREGROUND-COLOR 7 HIGHLIGHT
			    BACKGROUND-COLOR 5
	   ELSE
	       DISPLAY W90-MENU (WS-S1) AT CPOS
		       WITH BACKGROUND-COLOR 5.
	    IF WS-S1 < WS-SM
		ADD 1		 TO WS-S1
		IF CCOL < 60
		    ADD 15	 TO CCOL
		ELSE
		    ADD 1	 TO CLIN
		    MOVE 11	 TO CCOL
		END-IF
		GO TO BA00AB.

       BA00B.
	     DISPLAY "Press the required key" AT 1012
		      WITH FOREGROUND-COLOR 6 HIGHLIGHT.
	     DISPLAY "Press " AT 1212
		     "Esc" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "ape key to exit,"
		     "Home" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     " to start at first screen".
	     DISPLAY "Key to programme:" AT 0812.
	     CALL X"AF" USING GET-SINGLE-CHAR, KEY-STATUS.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		     GO TO BA100
		 WHEN F1-KEY
		 WHEN F2-KEY
		 WHEN F3-KEY
		 WHEN F4-KEY
		 WHEN F5-KEY
		 WHEN F6-KEY
		 WHEN F7-KEY
		 WHEN F8-KEY
		 WHEN F9-KEY
		 WHEN F10-KEY
		 WHEN F11-KEY
		 WHEN F12-KEY
		 WHEN SF1-KEY
		 WHEN SF2-KEY
		 WHEN SF3-KEY
		 WHEN SF4-KEY
		 WHEN SF5-KEY
		 WHEN SF6-KEY
		 WHEN SF7-KEY
		 WHEN SF8-KEY
		 WHEN SF9-KEY
		 WHEN SF10-KEY
		 WHEN SF11-KEY
		 WHEN SF12-KEY
		 WHEN CF1-KEY
		 WHEN CF2-KEY
		 WHEN CF3-KEY
		 WHEN CF4-KEY
		 WHEN CF5-KEY
		 WHEN CF6-KEY
		 WHEN CF7-KEY
		 WHEN CF8-KEY
		 WHEN CF9-KEY
		 WHEN CF10-KEY
		 WHEN CF11-KEY
		 WHEN CF12-KEY
		 WHEN AF1-KEY
		 WHEN AF2-KEY
		 WHEN AF3-KEY
		 WHEN AF4-KEY
		 WHEN AF5-KEY
		 WHEN AF6-KEY
		 WHEN AF7-KEY
		 WHEN AF8-KEY
		 WHEN AF9-KEY
		 WHEN AF10-KEY
		 WHEN AF11-KEY
		 WHEN AF12-KEY
		 WHEN ALT-1
		 WHEN ALT-2
		 WHEN ALT-3
		 WHEN ALT-4
		 WHEN ALT-5
		 WHEN ALT-6
		 WHEN ALT-7
		 WHEN ALT-8
		 WHEN ALT-9
		 WHEN ALT-0
		 WHEN ALT-HYPH
		 WHEN ALT-EQUAL
		 WHEN ALT-A
		 WHEN ALT-B
		 WHEN ALT-C
		 WHEN ALT-D
		 WHEN ALT-E
		 WHEN ALT-F
		 WHEN ALT-G
		 WHEN ALT-H
		 WHEN ALT-I
		 WHEN ALT-J
		 WHEN ALT-K
		 WHEN ALT-L
		 WHEN ALT-M
		 WHEN ALT-N
		 WHEN ALT-O
		 WHEN ALT-P
		 WHEN ALT-Q
		 WHEN ALT-R
		 WHEN ALT-S
		 WHEN ALT-T
		 WHEN ALT-U
		 WHEN ALT-V
		 WHEN ALT-W
		 WHEN ALT-X
		 WHEN ALT-Y
		 WHEN ALT-Z
		     GO TO BA05
		 WHEN OTHER
		     GO TO BA20
	       END-EVALUATE
	   ELSE
	   IF ADIS-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN HOME-KEY
		     GO TO BA0
		 WHEN LEFT-KEY
		 WHEN RIGHT-KEY
		 WHEN UP-KEY
		 WHEN DOWN-KEY
		 WHEN HOME-KEY
		 WHEN END-KEY
		 WHEN BACK-SPACE
		 WHEN DEL-KEY
		 WHEN INS-KEY
		     GO TO BA05
		 WHEN OTHER
		     GO TO BA20
	       END-EVALUATE
	   ELSE
	   IF DATA-8BIT
	       CALL "CBL_TOUPPER" USING KEY-CODE-1X
				  BY VALUE WS-LENGTH
				  RETURNING WS-STATUS
	   ELSE
	       GO TO BA20.

       BA05.
	     MOVE KEY-TYPE	 TO POS-ACT.
	     MOVE KEY-CODE-1X	 TO POS-CODE.
	     PERFORM READ-POSKBD THRU READ-POSKBD-EXIT.
	   IF WS-F-ERROR = 48
	       MOVE "PLU/PK has not been Setup"
				 TO WS-ERR-STRING
025040	       PERFORM ERROR-MESSAGE
	       GO TO BA00.
	     DISPLAY "PLU/PK " AT 1412 WITH HIGHLIGHT
		      POS-NO WITH FOREGROUND-COLOR 6 HIGHLIGHT.
	     MOVE KEY-TYPE	 TO PLU-ACT.
	     MOVE KEY-CODE-1X	 TO PLU-CODE.
	     MOVE SPACES	 TO PLU-TYPE PLU-VALUE.
	     PERFORM READ-POSPLU-LOCK THRU READ-POSPLU-EXIT.
	   IF WS-F-ERROR = 49
	       MOVE 1		 TO WS-PLU-IND
	   ELSE
	       MOVE ZERO	 TO WS-PLU-IND.
	     MOVE POS-NO	 TO PLU-NO.
	     DISPLAY "Action:" AT 1612.
	     DISPLAY "I" AT 1622 WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "tem code," "F" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "unction, " "M" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "enu or " "P" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "ayment method".
	     DISPLAY "Description/Value:" AT 1812.
	     MOVE PLU-TYPE	 TO WS-ACT.
	     MOVE PLU-VALUE	 TO WS-KEY-PRESSED.

       BA10.
	     ACCEPT WS-ACT AT 1620
		    WITH FOREGROUND-COLOR 7 HIGHLIGHT
			 BACKGROUND-COLOR 5 UPDATE AUTO.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		     GO TO BA00
	       END-EVALUATE.
	     CALL "CBL_TOUPPER" USING WS-ACT
				BY VALUE WS-LENGTH
				RETURNING WS-STATUS.
	   IF NOT (WS-ACT = "F" OR "I" OR "M" OR "P")
	       GO TO BA10.
	     DISPLAY WS-ACT AT 1620
		     WITH FOREGROUND-COLOR 7 HIGHLIGHT
			  BACKGROUND-COLOR 5.

	   IF WS-ACT = "F"
	       MOVE 7		 TO SHADE-ROW
	       MOVE 69		 TO SHADE-COL
	       MOVE 8		 TO SHADE-WIDTH
	       MOVE 16		 TO SHADE-LINES
	       DISPLAY "ÚÄÄÄÄÄÄÄÄ" AT 0667
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "¿" WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³"  AT 0767
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "CANCEL	³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 0867
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "CASHUP  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 0967
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "HOLD    ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1067
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "LOOKUP  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1167
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "PLU     ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1267
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "PRICE   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1367
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "PRINT   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1467
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "QUANTITY³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1567
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "REFUND  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1667
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "SCAN/KEY³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1767
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "TOTAL   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1867
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "VOID    ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1967
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "LOGON   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 2067
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "LOGOFF  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 2167
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "STAFF   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "À" AT 2267
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "ÄÄÄÄÄÄÄÄÙ"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       PERFORM SCREEN-SHADOW.
	   IF WS-ACT = "P"
	       MOVE 8		 TO SHADE-ROW
	       MOVE 65		 TO SHADE-COL
	       MOVE 12		 TO SHADE-WIDTH
	       MOVE 10		 TO SHADE-LINES
	       DISPLAY "Ú" AT 0763
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "ÄÄÄÄÄÄÄÄÄÄÄÄ¿"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 0863
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "CASH        ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 0963
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "CHEQUE      ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1063
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "CREDIT CARD ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1163
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "SPEEDPOINT  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1263
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "GIFT VOUCHER³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1363
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "COUPON      ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1463
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "TRAV. CHEQUE³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1563
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "BUY AID     ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1663
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "ACCOUNT     ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "À" AT 1763
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "ÄÄÄÄÄÄÄÄÄÄÄÄÙ"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       PERFORM SCREEN-SHADOW.
       BA15.
	   IF WS-ACT = "I"
	       PERFORM AA300.
	     ACCEPT WS-KEY-PRESSED AT 1831
		    WITH FOREGROUND-COLOR 7 HIGHLIGHT
			 BACKGROUND-COLOR 5 UPDATE AUTO.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		     GO TO BA10
	       END-EVALUATE.
	   IF WS-ACT = "I"
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN F1-KEY
		     PERFORM HELP-ROUTINE
		     GO TO BA15
		 WHEN F2-KEY
		     MOVE "I"	 TO W10-ETYPE
		 WHEN F3-KEY
		     MOVE "A"	 TO W10-ETYPE
		 WHEN F4-KEY
		     MOVE "D"	 TO W10-ETYPE
		 WHEN F5-KEY
		     MOVE "2"	 TO W10-ETYPE
		 WHEN F6-KEY
		     MOVE "X"	 TO W10-ETYPE
                 WHEN OTHER
                     CALL X"E5"
		     GO TO BA15
               END-EVALUATE
	       PERFORM AA50-LOOKUP
	       MOVE W10-EXT-ITEM TO WS-KEY-PRESSED.
	   IF WS-KEY-PRESSED = SPACES
	       GO TO BA15.
	     MOVE 18		 TO WS-LENGTH.
	     CALL "CBL_TOUPPER" USING WS-KEY-PRESSED
				BY VALUE WS-LENGTH
				RETURNING WS-STATUS.
	     MOVE 1		 TO WS-LENGTH.
	     DISPLAY WS-KEY-PRESSED AT 1831
		     WITH FOREGROUND-COLOR 7 HIGHLIGHT
			  BACKGROUND-COLOR 5.
	   IF WS-ACT = "F"
	       IF NOT (WS-KEY-PRESSED = "VOID" OR "HOLD" OR "CANCEL"
		       OR "REFUND" OR "TOTAL" OR "CASHUP" OR "LOOKUP"
		       OR "SUB TOTAL" OR "SCAN/KEY" OR "X" OR "LOGON"
		       OR "QUANTITY" OR "PLU" OR "PRICE" OR "LOGOFF"
		       OR "PRINT" OR "STAFF")
		   MOVE "Function Description"
				 TO WS-ERR-STRING
003260		   PERFORM ERROR-MESSAGE
		   GO TO BA15.
	   IF WS-ACT = "P"
	       IF NOT (WS-KEY-PRESSED = "CASH" OR "CHEQUE"
		       OR "CREDIT CARD" OR "SPEEDPOINT"
		       OR "GIFT VOUCHER" OR "VOUCHER"
		       OR "COUPON" OR "TRAV. CHEQUE"
		       OR "BUY AID" OR "ACCOUNT")
		   MOVE "Payment Type"
				 TO WS-ERR-STRING
003260		   PERFORM ERROR-MESSAGE
		   GO TO BA15.
	     MOVE 19		 TO SLIN.
	     PERFORM CHECK-SETUP THRU CHECK-EXIT.
020250	   IF WS-OPTION = "N"
	       GO TO BA10.
	     MOVE WS-ACT	 TO PLU-TYPE.
	     MOVE WS-KEY-PRESSED TO PLU-VALUE.
	   IF WS-PLU-IND = 1
	       PERFORM WRITE-POSPLU THRU WRITE-POSPLU-EXIT
	   ELSE
	       PERFORM REWRITE-POSPLU THRU WRITE-POSPLU-EXIT.
	   IF WS-ACT = "M"
	       ADD 1		 TO WS-SM
	       MOVE PLU-HEX	 TO PLU-MENU-LEVEL (WS-SM)
	       MOVE WS-KEY-PRESSED
				 TO W90-MENU (WS-SM).
	     GO TO BA00.

       BA20.
	     MOVE "Not a programmable key"
				 TO WS-ERR-STRING.
003260	     PERFORM ERROR-MESSAGE.
	     GO TO BA00.

       BA100.
	   IF WS-SM = ZERO
	       GO TO BA999.
	     MOVE SPACES	 TO W90-MENU (WS-SM).
	     MOVE ZERO		 TO PLU-MENU-LEVEL (WS-SM).
	     SUBTRACT 1 	 FROM WS-SM.
	     GO TO BA00.

       BA999.
	     EXIT.

       BB000	       SECTION 51.
       BB0.
	     MOVE ZERO		 TO PLU-SUB0 PLU-SUB1 PLU-SUB2
				    PLU-SUB3 PLU-SUB4 PLU-SUB5
				    PLU-SUB6 PLU-SUB7 PLU-SUB8
				    PLU-SUB9.
	     MOVE SPACES	 TO PLU-TYPE PLU-VALUE.
	     MOVE 0		 TO WS-SM.

       BB00.
	     DISPLAY CLR-SCREEN.
	     DISPLAY "TEST PROGRAMMED P.O.S. KEYS" AT 0227
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.

       BB00A.
	   IF WS-SM = 0
	       GO TO BB00B
	   ELSE
	       MOVE 1		 TO WS-S1.
	     MOVE 0411		 TO CPOS.

       BB00AB.
	   IF WS-S1 = WS-SM
	       DISPLAY W90-MENU (WS-S1) AT CPOS
		       WITH FOREGROUND-COLOR 7 HIGHLIGHT
			    BACKGROUND-COLOR 5
	   ELSE
	       DISPLAY W90-MENU (WS-S1) AT CPOS
		       WITH BACKGROUND-COLOR 5.
	    IF WS-S1 < WS-SM
		ADD 1		 TO WS-S1
		IF CCOL < 60
		    ADD 15	 TO CCOL
		ELSE
		    ADD 1	 TO CLIN
		    MOVE 11	 TO CCOL
		END-IF
		GO TO BB00AB.

       BB00B.
	     DISPLAY "Press the required key" AT 1012
		      WITH FOREGROUND-COLOR 6 HIGHLIGHT.
	     DISPLAY "Press " AT 1212
		     "Esc" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "ape key to exit,"
		     "Home" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     " to start at first screen".
	     DISPLAY "Key to test: " AT 0812.
	     CALL X"AF" USING GET-SINGLE-CHAR, KEY-STATUS.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		     GO TO BB100
		 WHEN F1-KEY
		 WHEN F2-KEY
		 WHEN F3-KEY
		 WHEN F4-KEY
		 WHEN F5-KEY
		 WHEN F6-KEY
		 WHEN F7-KEY
		 WHEN F8-KEY
		 WHEN F9-KEY
		 WHEN F10-KEY
		 WHEN F11-KEY
		 WHEN F12-KEY
		 WHEN SF1-KEY
		 WHEN SF2-KEY
		 WHEN SF3-KEY
		 WHEN SF4-KEY
		 WHEN SF5-KEY
		 WHEN SF6-KEY
		 WHEN SF7-KEY
		 WHEN SF8-KEY
		 WHEN SF9-KEY
		 WHEN SF10-KEY
		 WHEN SF11-KEY
		 WHEN SF12-KEY
		 WHEN CF1-KEY
		 WHEN CF2-KEY
		 WHEN CF3-KEY
		 WHEN CF4-KEY
		 WHEN CF5-KEY
		 WHEN CF6-KEY
		 WHEN CF7-KEY
		 WHEN CF8-KEY
		 WHEN CF9-KEY
		 WHEN CF10-KEY
		 WHEN CF11-KEY
		 WHEN CF12-KEY
		 WHEN AF1-KEY
		 WHEN AF2-KEY
		 WHEN AF3-KEY
		 WHEN AF4-KEY
		 WHEN AF5-KEY
		 WHEN AF6-KEY
		 WHEN AF7-KEY
		 WHEN AF8-KEY
		 WHEN AF9-KEY
		 WHEN AF10-KEY
		 WHEN AF11-KEY
		 WHEN AF12-KEY
		 WHEN ALT-1
		 WHEN ALT-2
		 WHEN ALT-3
		 WHEN ALT-4
		 WHEN ALT-5
		 WHEN ALT-6
		 WHEN ALT-7
		 WHEN ALT-8
		 WHEN ALT-9
		 WHEN ALT-0
		 WHEN ALT-HYPH
		 WHEN ALT-EQUAL
		 WHEN ALT-A
		 WHEN ALT-B
		 WHEN ALT-C
		 WHEN ALT-D
		 WHEN ALT-E
		 WHEN ALT-F
		 WHEN ALT-G
		 WHEN ALT-H
		 WHEN ALT-I
		 WHEN ALT-J
		 WHEN ALT-K
		 WHEN ALT-L
		 WHEN ALT-M
		 WHEN ALT-N
		 WHEN ALT-O
		 WHEN ALT-P
		 WHEN ALT-Q
		 WHEN ALT-R
		 WHEN ALT-S
		 WHEN ALT-T
		 WHEN ALT-U
		 WHEN ALT-V
		 WHEN ALT-W
		 WHEN ALT-X
		 WHEN ALT-Y
		 WHEN ALT-Z
		     GO TO BB05
		 WHEN OTHER
		     GO TO BB20
	       END-EVALUATE
	   ELSE
	   IF ADIS-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN HOME-KEY
		     GO TO BB0
		 WHEN LEFT-KEY
		 WHEN RIGHT-KEY
		 WHEN UP-KEY
		 WHEN DOWN-KEY
		 WHEN HOME-KEY
		 WHEN END-KEY
		 WHEN BACK-SPACE
		 WHEN DEL-KEY
		 WHEN INS-KEY
		     GO TO BB05
		 WHEN OTHER
		     GO TO BB20
	       END-EVALUATE
	   ELSE
	   IF DATA-8BIT
	       CALL "CBL_TOUPPER" USING KEY-CODE-1X
				  BY VALUE WS-LENGTH
				  RETURNING WS-STATUS
	   ELSE
	       GO TO BB20.

       BB05.
	     MOVE KEY-TYPE	 TO POS-ACT.
	     MOVE KEY-CODE-1X	 TO POS-CODE.
	     PERFORM READ-POSKBD THRU READ-POSKBD-EXIT.
	   IF WS-F-ERROR = 48
	       MOVE "PLU/PK has not been Setup"
				 TO WS-ERR-STRING
025040	       PERFORM ERROR-MESSAGE
	       GO TO BB00.
	     DISPLAY "PLU/PK " AT 1412 WITH HIGHLIGHT
		      POS-NO WITH FOREGROUND-COLOR 6 HIGHLIGHT.
	     MOVE KEY-TYPE	 TO PLU-ACT.
	     MOVE KEY-CODE-1X	 TO PLU-CODE.
	     MOVE SPACES	 TO PLU-TYPE PLU-VALUE.
	     PERFORM READ-POSPLU-LOCK THRU READ-POSPLU-EXIT.
	   IF WS-F-ERROR = 49
	       MOVE 1		 TO WS-PLU-IND
	   ELSE
	       MOVE ZERO	 TO WS-PLU-IND.
	     MOVE POS-NO	 TO PLU-NO.
	     DISPLAY "Action:" AT 1612.
	     DISPLAY "I" AT 1622 WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "tem code," "F" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "unction or " "M" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "enu".
	     DISPLAY "Description/Value:" AT 1812.
	     MOVE PLU-TYPE	 TO WS-ACT.
	     MOVE PLU-VALUE	 TO WS-KEY-PRESSED.

       BB10.
	     DISPLAY WS-ACT AT 1620
		    WITH FOREGROUND-COLOR 7 HIGHLIGHT
			 BACKGROUND-COLOR 5 UPDATE AUTO.
	   IF WS-ACT = "F"
	       MOVE 8		 TO SHADE-ROW
	       MOVE 69		 TO SHADE-COL
	       MOVE 8		 TO SHADE-WIDTH
	       MOVE 15		 TO SHADE-LINES
	       DISPLAY "ÚÄÄÄÄÄÄÄÄ" AT 0667
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "¿" WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³"  AT 0767
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "CANCEL	³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 0867
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "CASHUP  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 0967
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "HOLD    ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1067
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "LOOKUP  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1167
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "PLU     ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1267
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "PRICE   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1367
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "PRINT   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1467
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "QUANTITY³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1567
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "REFUND  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1667
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "SCAN/KEY³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1767
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "TOTAL   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1867
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "VOID    ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 1967
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "LOGON   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 2067
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "LOGOFF  ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "³" AT 2167
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "STAFF   ³"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       DISPLAY "À" AT 2267
			WITH FOREGROUND-COLOR 7 HIGHLIGHT
			     BACKGROUND-COLOR 7
		       "ÄÄÄÄÄÄÄÄÙ"
			WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
	       PERFORM SCREEN-SHADOW.
       BB15.
	     DISPLAY WS-KEY-PRESSED AT 1831
		    WITH FOREGROUND-COLOR 7 HIGHLIGHT
			 BACKGROUND-COLOR 5 UPDATE AUTO.
	     MOVE WS-ACT	 TO PLU-TYPE.
	     MOVE WS-KEY-PRESSED TO PLU-VALUE.
	     MOVE 19		 TO SLIN.
	     MOVE "Press ANY key to continue"
				 TO WS-ERR-MES.
	     PERFORM OPT-SETUP THRU OPT-EXIT.
	   IF WS-ACT = "M"
	       ADD 1		 TO WS-SM
	       MOVE PLU-HEX	 TO PLU-MENU-LEVEL (WS-SM)
	       MOVE WS-KEY-PRESSED
				 TO W90-MENU (WS-SM).
	     GO TO BB00.

       BB20.
	     MOVE "Not a programmable key"
				 TO WS-ERR-STRING.
003260	     PERFORM ERROR-MESSAGE.
	     GO TO BB00.

       BB100.
	   IF WS-SM = ZERO
	       GO TO BB999.
	     MOVE SPACES	 TO W90-MENU (WS-SM).
	     MOVE ZERO		 TO PLU-MENU-LEVEL (WS-SM).
	     SUBTRACT 1 	 FROM WS-SM.
	     GO TO BB00.

       BB999.
	     EXIT.

       DA000	       SECTION 52.
       DA00.
	     DISPLAY CLR-SCREEN.
	     DISPLAY "LIST PROGRAMMED KEYS" AT 0231
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     MOVE 1		 TO WS-PLU.

       DA05.
	     MOVE SPACE 	 TO POS-ACT.
	     MOVE ZERO		 TO POS-HEX  POS-NO.


       DA999.
	     EXIT.

       EA000	       SECTION 53.
       EA00.
	     DISPLAY CLR-SCREEN.
	     DISPLAY "VIEW PROGRAMMED P.O.S. KEYS" AT 0230
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     MOVE 1		 TO WS-PLU.

       EA05.
	     MOVE SPACE 	 TO POS-ACT.
	     MOVE ZERO		 TO POS-HEX  POS-NO.

       EA999.
	     EXIT.

       FA000	       SECTION 54.
       FA00.
	     DISPLAY CLR-SCREEN.
	     DISPLAY "SETUP THE K.B. LAYOUT" AT 0230
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     MOVE 1		 TO WS-PLU.

       FA05.
	     MOVE SPACE 	 TO POS-ACT.
	     MOVE ZERO		 TO POS-HEX  POS-NO.

       FA10.
	     DISPLAY "Press the key that will represent: " AT 0406
		     "PLU/PK " WITH HIGHLIGHT
		      WS-PLU WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     " Press " "Esc" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "ape to END".
	     CALL X"AF" USING GET-SINGLE-CHAR, KEY-STATUS.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		     GO TO FA25
		 WHEN F1-KEY
		     MOVE "F1"	     TO WS-KEY-PRESSED
		 WHEN F2-KEY
		     MOVE "F2"	     TO WS-KEY-PRESSED
		 WHEN F3-KEY
		     MOVE "F3"	     TO WS-KEY-PRESSED
		 WHEN F4-KEY
		     MOVE "F4"	     TO WS-KEY-PRESSED
		 WHEN F5-KEY
		     MOVE "F5"	     TO WS-KEY-PRESSED
		 WHEN F6-KEY
		     MOVE "F6"	     TO WS-KEY-PRESSED
		 WHEN F7-KEY
		     MOVE "F7"	     TO WS-KEY-PRESSED
		 WHEN F8-KEY
		     MOVE "F8"	     TO WS-KEY-PRESSED
		 WHEN F9-KEY
		     MOVE "F9"	     TO WS-KEY-PRESSED
		 WHEN F10-KEY
		     MOVE "F10"	     TO WS-KEY-PRESSED
		 WHEN F11-KEY
		     MOVE "F11"	     TO WS-KEY-PRESSED
		 WHEN F12-KEY
		     MOVE "F12"	     TO WS-KEY-PRESSED
		 WHEN SF1-KEY
		     MOVE "Shft+F1"  TO WS-KEY-PRESSED
		 WHEN SF2-KEY
		     MOVE "Shft+F2"  TO WS-KEY-PRESSED
		 WHEN SF3-KEY
		     MOVE "Shft+F3"  TO WS-KEY-PRESSED
		 WHEN SF4-KEY
		     MOVE "Shft+F4"  TO WS-KEY-PRESSED
		 WHEN SF5-KEY
		     MOVE "Shft+F5"  TO WS-KEY-PRESSED
		 WHEN SF6-KEY
		     MOVE "Shft+F6"  TO WS-KEY-PRESSED
		 WHEN SF7-KEY
		     MOVE "Shft+F7"  TO WS-KEY-PRESSED
		 WHEN SF8-KEY
		     MOVE "Shft+F8"  TO WS-KEY-PRESSED
		 WHEN SF9-KEY
		     MOVE "Shft+F9"  TO WS-KEY-PRESSED
		 WHEN SF10-KEY
		     MOVE "Shft+F10" TO WS-KEY-PRESSED
		 WHEN SF11-KEY
		     MOVE "Shft+F11" TO WS-KEY-PRESSED
		 WHEN SF12-KEY
		     MOVE "Shft+F12" TO WS-KEY-PRESSED
		 WHEN CF1-KEY
		     MOVE "Ctrl+F1"  TO WS-KEY-PRESSED
		 WHEN CF2-KEY
		     MOVE "Ctrl+F2"  TO WS-KEY-PRESSED
		 WHEN CF3-KEY
		     MOVE "Ctrl+F3"  TO WS-KEY-PRESSED
		 WHEN CF4-KEY
		     MOVE "Ctrl+F4"  TO WS-KEY-PRESSED
		 WHEN CF5-KEY
		     MOVE "Ctrl+F5"  TO WS-KEY-PRESSED
		 WHEN CF6-KEY
		     MOVE "Ctrl+F6"  TO WS-KEY-PRESSED
		 WHEN CF7-KEY
		     MOVE "Ctrl+F7"  TO WS-KEY-PRESSED
		 WHEN CF8-KEY
		     MOVE "Ctrl+F8"  TO WS-KEY-PRESSED
		 WHEN CF9-KEY
		     MOVE "Ctrl+F9"  TO WS-KEY-PRESSED
		 WHEN CF10-KEY
		     MOVE "Ctrl+F10" TO WS-KEY-PRESSED
		 WHEN CF11-KEY
		     MOVE "Ctrl+F11" TO WS-KEY-PRESSED
		 WHEN CF12-KEY
		     MOVE "Ctrl+F12" TO WS-KEY-PRESSED
		 WHEN AF1-KEY
		     MOVE "Alt+F1"   TO WS-KEY-PRESSED
		 WHEN AF2-KEY
		     MOVE "Alt+F2"   TO WS-KEY-PRESSED
		 WHEN AF3-KEY
		     MOVE "Alt+F3"   TO WS-KEY-PRESSED
		 WHEN AF4-KEY
		     MOVE "Alt+F4"   TO WS-KEY-PRESSED
		 WHEN AF5-KEY
		     MOVE "Alt+F5"   TO WS-KEY-PRESSED
		 WHEN AF6-KEY
		     MOVE "Alt+F6"   TO WS-KEY-PRESSED
		 WHEN AF7-KEY
		     MOVE "Alt+F7"   TO WS-KEY-PRESSED
		 WHEN AF8-KEY
		     MOVE "Alt+F8"   TO WS-KEY-PRESSED
		 WHEN AF9-KEY
		     MOVE "Alt+F9"   TO WS-KEY-PRESSED
		 WHEN AF10-KEY
		     MOVE "Alt+F10"  TO WS-KEY-PRESSED
		 WHEN AF11-KEY
		     MOVE "Alt+F11"  TO WS-KEY-PRESSED
		 WHEN AF12-KEY
		     MOVE "Alt+F12"  TO WS-KEY-PRESSED
		 WHEN ALT-1
		     MOVE "Alt+1"    TO WS-KEY-PRESSED
		 WHEN ALT-2
		     MOVE "Alt+2"    TO WS-KEY-PRESSED
		 WHEN ALT-3
		     MOVE "Alt+3"    TO WS-KEY-PRESSED
		 WHEN ALT-4
		     MOVE "Alt+4"    TO WS-KEY-PRESSED
		 WHEN ALT-5
		     MOVE "Alt+5"    TO WS-KEY-PRESSED
		 WHEN ALT-6
		     MOVE "Alt+6"    TO WS-KEY-PRESSED
		 WHEN ALT-7
		     MOVE "Alt+7"    TO WS-KEY-PRESSED
		 WHEN ALT-8
		     MOVE "Alt+8"    TO WS-KEY-PRESSED
		 WHEN ALT-9
		     MOVE "Alt+9"    TO WS-KEY-PRESSED
		 WHEN ALT-0
		     MOVE "Alt+0"    TO WS-KEY-PRESSED
		 WHEN ALT-HYPH
		     MOVE "Alt+HYPH" TO WS-KEY-PRESSED
		 WHEN ALT-EQUAL
		     MOVE "Alt+EQUAL"
				     TO WS-KEY-PRESSED
		 WHEN ALT-A
		     MOVE "Alt+A"    TO WS-KEY-PRESSED
		 WHEN ALT-B
		     MOVE "Alt+B"    TO WS-KEY-PRESSED
		 WHEN ALT-C
		     MOVE "Alt+C"    TO WS-KEY-PRESSED
		 WHEN ALT-D
		     MOVE "Alt+D"    TO WS-KEY-PRESSED
		 WHEN ALT-E
		     MOVE "Alt+E"    TO WS-KEY-PRESSED
		 WHEN ALT-F
		     MOVE "Alt+F"    TO WS-KEY-PRESSED
		 WHEN ALT-G
		     MOVE "Alt+G"    TO WS-KEY-PRESSED
		 WHEN ALT-H
		     MOVE "Alt+H"    TO WS-KEY-PRESSED
		 WHEN ALT-I
		     MOVE "Alt+I"    TO WS-KEY-PRESSED
		 WHEN ALT-J
		     MOVE "Alt+J"    TO WS-KEY-PRESSED
		 WHEN ALT-K
		     MOVE "Alt+K"    TO WS-KEY-PRESSED
		 WHEN ALT-L
		     MOVE "Alt+L"    TO WS-KEY-PRESSED
		 WHEN ALT-M
		     MOVE "Alt+M"    TO WS-KEY-PRESSED
		 WHEN ALT-N
		     MOVE "Alt+N"    TO WS-KEY-PRESSED
		 WHEN ALT-O
		     MOVE "Alt+O"    TO WS-KEY-PRESSED
		 WHEN ALT-P
		     MOVE "Alt+P"    TO WS-KEY-PRESSED
		 WHEN ALT-Q
		     MOVE "Alt+Q"    TO WS-KEY-PRESSED
		 WHEN ALT-R
		     MOVE "Alt+R"    TO WS-KEY-PRESSED
		 WHEN ALT-S
		     MOVE "Alt+S"    TO WS-KEY-PRESSED
		 WHEN ALT-T
		     MOVE "Alt+T"    TO WS-KEY-PRESSED
		 WHEN ALT-U
		     MOVE "Alt+U"    TO WS-KEY-PRESSED
		 WHEN ALT-V
		     MOVE "Alt+V"    TO WS-KEY-PRESSED
		 WHEN ALT-W
		     MOVE "Alt+W"    TO WS-KEY-PRESSED
		 WHEN ALT-X
		     MOVE "Alt+X"    TO WS-KEY-PRESSED
		 WHEN ALT-Y
		     MOVE "Alt+Y"    TO WS-KEY-PRESSED
		 WHEN ALT-Z
		     MOVE "Alt+Z"    TO WS-KEY-PRESSED
		 WHEN OTHER
		     GO TO FA30
	       END-EVALUATE
	   ELSE
	   IF ADIS-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN LEFT-KEY
		     MOVE "Left Arrow"	TO WS-KEY-PRESSED
		 WHEN RIGHT-KEY
		     MOVE "Right Arrow"	TO WS-KEY-PRESSED
		 WHEN UP-KEY
		     MOVE "Up Arrow"	TO WS-KEY-PRESSED
		 WHEN DOWN-KEY
		     MOVE "Down Arrow"	TO WS-KEY-PRESSED
		 WHEN HOME-KEY
		     MOVE "Home"	TO WS-KEY-PRESSED
		 WHEN END-KEY
		     MOVE "End"		TO WS-KEY-PRESSED
		 WHEN BACK-SPACE
		     MOVE "Back Space"	TO WS-KEY-PRESSED
		 WHEN DEL-KEY
		     MOVE "Del"		TO WS-KEY-PRESSED
		 WHEN INS-KEY
		     MOVE "Ins"		TO WS-KEY-PRESSED
		 WHEN OTHER
		     GO TO FA30
	       END-EVALUATE
	   ELSE
	   IF DATA-8BIT
	       CALL "CBL_TOUPPER" USING KEY-CODE-1X
				  BY VALUE WS-LENGTH
				  RETURNING WS-STATUS
	       MOVE KEY-CODE-1X  TO WS-KEY-PRESSED
	   ELSE
	       GO TO FA30.
	     MOVE KEY-TYPE	 TO POS-ACT.
	     MOVE KEY-CODE-1X	 TO POS-CODE.
	     PERFORM READ-POSKBD THRU READ-POSKBD-EXIT.
	   IF WS-F-ERROR = 48
	       MOVE 1		 TO WS-PLU-IND
	       GO TO FA20.
	     MOVE ZERO		 TO WS-PLU-IND.
	   IF POS-NO = WS-PLU
	       GO TO FA20.
	     DISPLAY "Key pressed: " AT 0812
		      WS-KEY-PRESSED WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     " is assigned to "
		      POS-NO WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     DISPLAY "Replace " AT 1012
		     "Y" WITH FOREGROUND-COLOR 6 HIGHLIGHT "/"
		     "N" WITH FOREGROUND-COLOR 6 HIGHLIGHT.
	     MOVE SPACE 	 TO WS-OPTION.

       FA15.
	     ACCEPT WS-OPTION AT 1024
		    WITH FOREGROUND-COLOR 7 HIGHLIGHT
			 BACKGROUND-COLOR 5 UPDATE AUTO.
	     CALL "CBL_TOUPPER" USING WS-OPTION
				BY VALUE WS-LENGTH
				RETURNING WS-STATUS.
	   IF NOT (WS-OPTION = "Y" OR "N")
	       GO TO FA15.
	   IF WS-OPTION = "N"
	       MOVE 0801	 TO CPOS
	       PERFORM ERASE-SCREEN-LOOP UNTIL CLIN > 10
	       GO TO FA10.

       FA20.
	     MOVE WS-PLU	 TO POS-NO.
	     DISPLAY "Key pressed: " AT 0812
		      WS-KEY-PRESSED WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     " assigned to "
		      POS-NO WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     PERFORM CHECK-CORRECT.
020250	   IF WS-OPTION = "N"
	       GO TO FA10.
	   IF WS-PLU-IND = 1
	       PERFORM WRITE-POSKBD THRU WRITE-POSKBD-EXIT
	   ELSE
	       PERFORM REWRITE-POSKBD THRU WRITE-POSKBD-EXIT.
	   IF WS-PLU < 255
	       ADD 1		 TO WS-PLU
	       GO TO FA10.

       FA25.
	     MOVE "Review Keyboard Layout  [ ]"
				 TO WS-ERR-MES
	     PERFORM OPT-MESSAGE.
	   IF NOT (WS-OPTION = "Y" OR "N")
	       GO TO FA25.
	   IF WS-OPTION = "N"
	       GO TO FA35.
	     GO TO FA00.

       FA30.
	     MOVE "Not a programmable key"
				 TO WS-ERR-STRING.
025040	     PERFORM ERROR-MESSAGE.
	     GO TO FA10.

       FA35.
	     MOVE SPACE 	 TO POS-ACT.
	     MOVE 0		 TO POS-HEX.
000030	     START POSKBD
	       KEY >= POS-KEY.
	     MOVE ZERO		 TO PLU-SUB0 PLU-SUB1 PLU-SUB2
				    PLU-SUB3 PLU-SUB4 PLU-SUB5
				    PLU-SUB6 PLU-SUB7 PLU-SUB8
				    PLU-SUB9.
	     MOVE SPACES	 TO PLU-TYPE PLU-VALUE.

       FA40.
000320	     PERFORM READ-POSKBD-NEXT THRU READ-POSKBD-EXIT.
000350	   IF WS-F-ERROR = 48
	       GO TO FA999.
	     MOVE POS-ACT	 TO PLU-ACT.
	     MOVE POS-CODE	 TO PLU-CODE.
	     PERFORM READ-POSPLU THRU READ-POSPLU-EXIT.
	   IF WS-F-ERROR = 49
	       MOVE 1		 TO WS-PLU-IND
	   ELSE
	       MOVE ZERO	 TO WS-PLU-IND.
	     MOVE POS-NO	 TO PLU-NO.
	   IF WS-PLU-IND = 1
	       PERFORM WRITE-POSPLU THRU WRITE-POSPLU-EXIT
	   ELSE
	       PERFORM REWRITE-POSPLU THRU WRITE-POSPLU-EXIT.
	     GO TO FA40.

       FA999.
	     EXIT.
      /
      *    ****    INITIALIZE ROUTINE    ****
      *
029020 ZA00-INIT              SECTION 89.
       ZA00.
	     PERFORM ZA55 THRU ZA60.
	     MOVE LS-PARID	 TO WS-PARID.
	     MOVE LS-L-OR-N	 TO W02-L-OR-N.
	     MOVE WS-SYS-ID	 TO W02-SYSID.
	     MOVE LS-TODAY-DDMMYY
				 TO TODAY-DDMMYY.
	     MOVE LS-USUB	 TO WS-USUB.
042000	     DISPLAY CLR-SCREEN.
      *
      *    ****    S E T   U P   T H E   F U N C T I O N   K E Y S
      *
	     MOVE 1		 TO USER-ACTION
				    USER-SETTING.
      *
      *    ESC, F1 to F10, Shift + F1 to F10, Ctrl + F1 to F10,
      *    Alt + F1 to F10, Alt + 1 to 0, Alt + - & =,
      *    PAGE-UP AND PAGE-DOWN KEYS
      *
	     MOVE ZERO		 TO USER-NUMBER.
	     MOVE 55		 TO USER-KEYS.
	     CALL X"AF" USING SET-BIT-PAIRS, USER-KEY-CONTROL.
      *
      *    Alt + A to Z KEYS
      *    F11 & F10, Shift + F11 & F12, Ctrl + F11 & F12,
      *    Alt + F11 & F12 keys
      *
	     MOVE 65		 TO USER-NUMBER.
	     MOVE 34		 TO USER-KEYS.
	     CALL X"AF" USING SET-BIT-PAIRS, USER-KEY-CONTROL.
      *
      *    ****    A C T I V A T E   M O U S E
      *
	     MOVE 64		 TO MOUSE-FUNC.
	     MOVE 1		 TO MOUSE-PARAM.
	     CALL X"AF" USING MOUSE-FUNC
			      MOUSE-PARAM.
	   IF MOUSE-FUNC NOT = 255
	       MOVE "Y"		 TO MOUSE-ATTACHED
	       MOVE 66		 TO MOUSE-FUNC
	       MOVE 0		 TO MOUSE-PARAM
	       CALL X"AF" USING MOUSE-FUNC
				MOUSE-PARAM
	   ELSE
	       GO TO ZA00A.
      *
      *    ****    S E T   M O U S E   K E Y   T O   A C T
      * 	   A S	 F U N C T I O N   K E Y
      *
	     MOVE 3		 TO USER-ACTION.
	     MOVE 27		 TO USER-NUMBER.
	     MOVE 2		 TO USER-KEYS.
	     CALL X"AF" USING SET-BIT-PAIRS, USER-KEY-CONTROL.
      *
      *    ****    P A R A M E T E R   F I L E
      *
       ZA00A.
	     MOVE "PARAM"	 TO AFID-KEY.

       ZA00-READ-APACFIDS.
000030	     READ APACFIDS WITH IGNORE LOCK
	       KEY IS AFID-KEY.
	   IF WS-STATUS = "00"
	       GO TO ZA00-READ-APACFIDS-EXIT.
006260	     STRING "Missing " DELIMITED SIZE
		     AFID-KEY DELIMITED BY " "
		     " file ID - Status " DELIMITED SIZE
		     WS-STATUS DELIMITED SIZE
		     INTO WS-ERR-MES.
	     PERFORM ERROR-LENGTH THRU ERROR-EXIT.
006370	     STOP RUN.

       ZA00-READ-APACFIDS-EXIT.
	     EXIT.

       ZA00A-CONTINUE.
	     MOVE AFID-PATH	 TO W02-PARAM.
	     MOVE "DEPART"	 TO AFID-KEY.
	     PERFORM ZA00-READ-APACFIDS THRU ZA00-READ-APACFIDS-EXIT.
	     MOVE AFID-PATH	 TO W02-DEPART.
	     MOVE "POSPLU"	 TO AFID-KEY.
	     PERFORM ZA00-READ-APACFIDS THRU ZA00-READ-APACFIDS-EXIT.
	     MOVE AFID-PATH	 TO W02-POSPLU.
	     MOVE "STOCKF"	 TO AFID-KEY.
	     PERFORM ZA00-READ-APACFIDS THRU ZA00-READ-APACFIDS-EXIT.
	     MOVE AFID-PATH	 TO W02-STOCKF.
020890	     MOVE 3		 TO WS-PARKEY.
020900       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
	     MOVE PAR-USE-ITM	 TO WS-USE-ITM.
	     MOVE PAR-EXT-STK	 TO WS-EXT-STK.
042720	     MOVE 1		 TO WS-PARKEY.
042730       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
042740       MOVE PAR-COMPANY    TO W95-COMP.
042750       MOVE PAR-DMY        TO W12-TODAY.
042760       MOVE PAR-YMD        TO W12-T-YMD.
	     MOVE ZERO		 TO WS-ERROR.
042520	     MOVE 5		 TO WS-PARKEY.
042550       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
	     MOVE 1		 TO W05-V-RATE.

       ZA05-VAT.
	     MOVE W05-VAT-CODE	 TO DPT-CODE.
	     PERFORM READ-DEPART THRU READ-DEPART-EXIT.
	     MOVE DPT-R-DATE	 TO WS-VAT-DATE(W05-V-RATE).
	     MOVE DPT-RATE	 TO W05-VAT(W05-V-RATE).
	     ADD 6 W05-V-RATE	 GIVING WS-S1.
	     MOVE DPT-P-RATE	 TO W05-VAT(WS-S1).
	   IF W05-V-RATE < 6
	       ADD 1		 TO W05-V-RATE
	       GO TO ZA05-VAT.
	     OPEN I-O POSPLU.
	   IF WS-STATUS = "05"
	       CLOSE POSPLU
	       OPEN OUTPUT POSPLU
	       CLOSE POSPLU
	       OPEN I-O POSPLU
	       PERFORM ZA500 THRU ZA510.
	   IF WS-ERROR = ZERO
	       OPEN I-O POSKBD.
044780	     GO TO ZA999-EXIT.
       ZA55.
041220       MOVE 1              TO WS-S1.
021870	     MOVE SPACES	 TO WS-MID-LNE.
041240 ZA60.
041250       MOVE WS-G1          TO WS-TCHR (WS-S1) WS-BCHR (WS-S1).
             MOVE WS-G8          TO WS-TCH  (WS-S1) WS-BCH  (WS-S1).
041260     IF WS-S1 < 80
041270         ADD 1             TO WS-S1
041280         GO TO ZA60.
             MOVE WS-G9          TO WS-TCH  (1).
             MOVE WS-G10         TO WS-TCH  (80).
             MOVE WS-G11         TO WS-BCH  (1).
             MOVE WS-G12         TO WS-BCH  (80).
             MOVE WS-G14         TO WS-TCHR (1)  WS-BCHR (1).
             MOVE WS-G13         TO WS-TCHR (80) WS-BCHR (80).
021930	     MOVE WS-G2 	 TO WS-TCHR (18) WS-TCHR (49)
021940                              WS-TCHR (60) WS-TCHR (70).
021950       MOVE WS-G3          TO WS-MCHR (18) WS-MCHR (49)
021960                              WS-MCHR (60) WS-MCHR (70)
				    WS-MCHR (1)  WS-MCHR (80).
021970       MOVE WS-G4          TO WS-BCHR (18) WS-BCHR (49)
021980                              WS-BCHR (60) WS-BCHR (70).
	     MOVE LS-COMPANY	 TO WS-TOP-COMP.
	   IF LS-USER = LS-SYS-ID
	       MOVE "SupervisorÄ"  TO WS-WRKHD
	   ELSE
	       MOVE "Workstation"  TO WS-WRKHD
	       MOVE LS-USER	   TO WS-WRKST.

       ZA500.
	     OPEN I-O POSKBD.
	  IF NOT (WS-STATUS = "00")
	      MOVE 9		 TO WS-ERROR
	      GO TO ZA510.
	     MOVE SPACE 	 TO POS-ACT.
	     MOVE 0		 TO POS-HEX.
000030	     START POSKBD
	       KEY >= POS-KEY.
           IF WS-STATUS = "23"
	      MOVE 9		 TO WS-ERROR
	      GO TO ZA510.
	     MOVE ZERO		 TO PLU-SUB0 PLU-SUB1 PLU-SUB2
				    PLU-SUB3 PLU-SUB4 PLU-SUB5
				    PLU-SUB6 PLU-SUB7 PLU-SUB8
				    PLU-SUB9.
	     MOVE SPACES	 TO PLU-TYPE PLU-VALUE.

       ZA505.
000320	     READ POSKBD NEXT WITH IGNORE LOCK.
000350	   IF NOT (WS-STATUS = "00")
	       CLOSE POSKBD
	       GO TO ZA510.
	     MOVE POS-ACT	 TO PLU-ACT.
	     MOVE POS-CODE	 TO PLU-CODE.
	     MOVE POS-NO	 TO PLU-NO.
	     PERFORM WRITE-POSPLU.
	     GO TO ZA505.

       ZA510.
	     EXIT.

042880 ZA999-EXIT.
042890       EXIT.
      /
      *    ****    I / O   E R R O R   M E S S A G E S
      *   
042900 ZB000-ERROR	     SECTION 81.
      
041480 OPEN-ERROR.
041490       DISPLAY CLR-SCREEN.
041500       DISPLAY "Open error" AT 0812 WITH FOREGROUND-COLOR 14.
041510       GO TO DISPLAY-FILE-NAME.
      
041480 READ-ERROR.
041490       DISPLAY CLR-SCREEN.
041500       DISPLAY "Read error" AT 0812 WITH FOREGROUND-COLOR 14.
041510       GO TO DISPLAY-FILE-NAME.
      
041520 WRITE-ERROR.
041530       DISPLAY CLR-SCREEN.
041540       DISPLAY "Write error" AT 0812 WITH FOREGROUND-COLOR 14.
041510       GO TO DISPLAY-FILE-NAME.
       I-O-ERROR-EXIT.
             EXIT.

041560 DISPLAY-FILE-NAME.
041810	   IF WS-F-ERROR = 7
041820         MOVE W02-DEPART   TO WS-FILE
041830         MOVE WS-DEPKEY    TO WS-KEY
041840     ELSE
041850	   IF WS-F-ERROR = 15
041860	       MOVE WS-PARID	 TO WS-FILE
041870	       MOVE WS-PARKEY	 TO WS-KEY
041840	   ELSE
041850     IF WS-F-ERROR = 22
041860         MOVE W02-STOCKF   TO WS-FILE
041870         MOVE ZERO         TO WS-KEY
               MOVE STK-CODE     TO WS-KEYX
041840	   ELSE
041850	   IF WS-F-ERROR = 49
041860	       MOVE W02-POSPLU	 TO WS-FILE
041870	       MOVE ZERO	 TO WS-KEY
	       MOVE PLU-KEY	 TO WS-KEYX.
041880     IF WS-STATUS = "10"
041890         MOVE "End of FILE" TO WS-STAT-MESSAGE
041900     ELSE
041910     IF WS-STATUS = "22"
041920         MOVE "Duplicate record number" TO WS-STAT-MESSAGE
041930     ELSE
041940     IF WS-STATUS = "23"
041950         MOVE "Invalid record number" TO WS-STAT-MESSAGE
041960     ELSE
041970     IF WS-STATUS = "24"
041980         MOVE "DISK full" TO WS-STAT-MESSAGE
041990     ELSE
042000     IF WS-STATUS = "30"
042010         MOVE "DISK error" TO WS-STAT-MESSAGE
042020     ELSE
042030     IF WS-STATUS = "94"
042040         MOVE "FILE locked" TO WS-STAT-MESSAGE.
045380       DISPLAY "File - " AT 1012 WS-FILE WITH FOREGROUND-COLOR 11.
045390       DISPLAY "Status " AT 1212 
                      WS-STATUS WITH FOREGROUND-COLOR 11
                     ": " WS-STAT-MESSAGE WITH FOREGROUND-COLOR 14.
045400     IF WS-STATUS NOT = "94" 
045410         DISPLAY "Key    " AT 1412 
                        WS-KEY WITH FOREGROUND-COLOR 11
                        " " WS-KEYX WITH FOREGROUND-COLOR 11
045420         DISPLAY "Reverse backup or contact program Support"
                        AT 1612.
045440         DISPLAY "Please make a note of these details" AT 1812.
042170       STOP RUN.
