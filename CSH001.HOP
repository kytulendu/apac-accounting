      ******************************************************************
      *                                                                *
      *   ******     ******    **    **     ****       ****      **    *
      *  **    **   **    **   **    **    **  **     **  **    ***    *
      *  **         **         **    **   **    **   **    **    **    *
      *  **          ******    ********   **    **   **    **    **    *
      *  **               **   **    **   **    **   **    **    **    *
      *  **    **   **    **   **    **    **  **     **  **     **    *
      *   ******     ******    **    **     ****       ****     ****   *
      *                                                                *
      *     ENGLISH                                                    *
      *                                                                *
      *     ( A P A C )   C A S H   D R A W   -   P R O G R A M        *
      *                                                                *
      *     VERSION 6.3 - APRIL 1993				       *
      *                                                                *
      ******************************************************************
      *
      *  DEBTOR LOOKUP (IN AN INVOICE OR CREDIT NOTE) 17-2-91
      *
000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID.     CSH001.
000030 AUTHOR.         J W LEMMON  (APAC).
000040 DATE-WRITTEN.   JUNE 1990.
000050 ENVIRONMENT DIVISION.
000060 CONFIGURATION SECTION.
000070 SPECIAL-NAMES.  
                       CURSOR IS CSTART
000080                 CONSOLE IS CRT.
000090 INPUT-OUTPUT SECTION.
000100 FILE-CONTROL.

000220 COPY AUDIT.SL.

       COPY CHEQUE.SL.

       COPY CONTROL.SL.

000140 COPY DEPART.SL.

       COPY LEDTRF.SL.

000120 COPY PARAM.SL.

000240 COPY RECOVER.SL.

000200 COPY SALE.SL.

000180 COPY STOCK.SL.

000140 COPY STKMEM.SL.

000180 COPY TXPTRN.SL.

000180 COPY TXTRAN.SL.

000280     SELECT CSHDRW  ASSIGN W02-CSHDRW
000290                    ORGANIZATION SEQUENTIAL
000300                    ACCESS SEQUENTIAL.
000290     SELECT CSHSLE  ASSIGN DISK
000300                    ORGANIZATION LINE SEQUENTIAL
000310                    ACCESS SEQUENTIAL.
      /
000320 DATA DIVISION.
000330 FILE SECTION.

000450 COPY AUDIT.IFD.

       COPY CHEQUE.FD.

       COPY CONTROL.IFD.

000370 COPY DEPART.GFD.

       COPY LEDTRF.FD.

000350 COPY PARAM.IFD.

000470 COPY RECOVER.GFD.

000410 COPY SALE.IFD.

000390 COPY STOCK.GFD.

000140 COPY STKMEM.FD.

000350 COPY TXPTRN.FD.

000180 COPY TXTRAN.IFD.

000530 FD  CSHDRW    LABEL RECORD OMITTED.
000550 01  CSH-REC.
000560     03  CSH-OPEN        PIC  X(06).
000530 FD  CSHSLE    LABEL RECORD STANDARD
000540               VALUE OF FILE-ID W02-PRINTER.
000550 01  CSH-L.
000560     03  CSH-DATA.
               05  CSH-LINE PIC  X(32).
               05  FILLER   PIC  X(48).
       01  CSH-L2.
               05  CSH-ESC  PIC  X(01).
               05  CSH-CONT PIC  X(01).
               05  CSH-DET  PIC  X(78).
      /
000570 WORKING-STORAGE SECTION.
000580 77  WS-DISC          PIC  9(02)V99 COMP-3.
000590 77  WS-TDISC         PIC  9(02)V99 COMP-3.
000600 77  WS-SUB           PIC  9(04)    COMP-5.
000600 77  WS-SUPER         PIC  9(02)    COMP-5.
000600 77  WS-S1            PIC  9(04)    COMP-5.
000610 77  WS-S2            PIC  9(04)    COMP-5.
000620 77  WS-S3            PIC  9(04)    COMP-5.
000630 77  WS-S4            PIC  9(04)    COMP-5.
000640 77  WS-S5            PIC  9(04)    COMP-5.
000650 77  WS-S6            PIC  9(04)    COMP-5.
000660 77  WS-S7            PIC  9(04)    COMP-5.
000670 77  WS-S8            PIC  9(04)    COMP-5.
000680 77  WS-S9            PIC  9(04)    COMP-5.
001790 77  WS-IXS           PIC  9(04)    COMP-5.
001800 77  WS-IXS1          PIC  9(04)    COMP-5.
001810 77  WS-IXS2          PIC  9(04)    COMP-5.
001820 77  WS-IXS3          PIC  9(04)    COMP-5.
001830 77  WS-IXS4          PIC  9(04)    COMP-5.
000690 77  WS-STKKEY        PIC  9(04)    COMP-5.
000700 77  WS-PARKEY        PIC  9(04)    COMP-5.
000710 77  WS-DEBKEY        PIC  9(04)    COMP-5.
000720 77  WS-NETKEY        PIC  9(04)    COMP-5.
000720 77  WS-DEPKEY        PIC  9(04)    COMP-5.
000730 77  WS-AUDKEY        PIC  9(04)    COMP-5.
000740 77  WS-SALSTR        PIC  9(04)    COMP-5.
000750 77  WS-SALKEY        PIC  9(04)    COMP-5.
000760 77  WS-RECKEY        PIC  9(04)    COMP-5.
000770 77  WS-RECOVER       PIC  9(04)    COMP-5.
000780 77  WS-TRANS         PIC  9(04)    COMP-5 VALUE 1.
000810 77  WS-KEY1          PIC  9(04)    COMP-5.
000820 77  WS-ITM           PIC  X(14).
000830 77  WS-ITM1          PIC  X(14).
000850 77  WS-START         PIC  9(08).
000860 77  WS-END           PIC  9(08).
000850 77  WS-TIME          PIC  9(08).
000860 77  WS-TME2          PIC  9(08).
       77  WS-PORT          PIC  9(05) VALUE 1004.
000600 77  WS-OPEN          PIC  X(01) VALUE X"01".
000600 77  WS-CLOSE         PIC  X(01) VALUE X"00".
000870 77  WS-PAR           PIC  9(01) VALUE 0.
000880 77  WS-INO           PIC  9(02) VALUE 0.
000890 77  WS-LINES         PIC  9(02) VALUE 0.
000900 77  WS-FIRST         PIC  9(02) VALUE 0.
000910 77  WS-LAST          PIC  9(02) VALUE 0.
000920 77  WS-PAGE          PIC  9(04)    COMP-5.
000930 77  WS-OPTION        PIC  X(01).
000930 77  WS-DUP           PIC  X(01).
000930 77  WS-PRNINV        PIC  X(01) VALUE "Y".
002600 77  WS-VAT-GST      PIC  X(01) VALUE "V".
002610 77  WS-SKIP         PIC  X(01) VALUE " ".
002610 77  WS-LOOK         PIC  X(01) VALUE "S".
002620 77  WS-ETYPE        PIC  X(01) VALUE "I".
000940 77  WS-LENGTH        PIC  9(04) VALUE 1.
002040 77  WS-WS            PIC X(01).
000950 77  WS-NUM           PIC  Z9.
000960 77  WS-ERROR         PIC  9(01).
000970 77  WS-SELECT        PIC  X(13)     VALUE "Select Option".
000980 77  WS-CHAR1         PIC  X(01).
000990 77  WS-CHAR2         PIC  X(01).
001000 77  WS-COMP          PIC  9(01).
001010 77  WS-INDI          PIC  9(01) VALUE ZERO.
001020 77  WS-UPDATE        PIC  9(01) VALUE ZERO.
001030 77  WS-CONREC        PIC  9(01) VALUE ZERO.
001040 77  WS-HEAD          PIC  X(01).
001050 77  WS-TYPE          PIC  X(01).
001060 77  WS-AGE           PIC  X(01).
001060 77  WS-PRC           PIC  X(01).
001070 77  WS-INDEX-STORE   PIC  X(04).
001080 77  WS-INDEX-NAME    PIC  X(04).
001090 77  WS-PAGE48        PIC  X(04).
001100 77  WS-PAGE66        PIC  X(04).
001110 77  WS-BATCH         PIC  9(05).
001120 77  WS-CHK           PIC  X(33)      VALUE
001130                    "ENTER if correct - N if incorrect".
001140 77  WS-A             PIC  X(19) VALUE "Any key to continue".
001150 77  WS-PER           PIC  Z(02)9.99.
001160 77  WS-CR            PIC  X(01).
001170 77  WS-GSTRES        PIC  S9(07)V9(08) COMP-3.
      /
002910 01  WS-DB-LINE.
002920     03  WS-TOP-LINE.
002930         05  WS-TCHAR PIC X(01) OCCURS 80.
002940     03  WS-TOP-LNE2.
002950         05  WS-TCR  PIC X(01) OCCURS 80.
002960     03  WS-TP-LINE2 REDEFINES WS-TOP-LNE2.
002970         05  FILLER      PIC  X(01).
002980         05  WS-TOP-COMP PIC  X(40).
002990         05  FILLER      PIC  X(39).
003000     03  WS-MID-LINE.
003010         05  WS-MCHAR PIC X(01) OCCURS 80.
	   03  WS-MINV-LINE REDEFINES WS-MID-LINE.
	       05  WS-MIV1     PIC  X(01).
	       05  WS-MIV78    PIC  X(78).
	       05  WS-MIV80    PIC  X(01).
003020	   03  WS-MID-LNE2.
003030         05  WS-MCR  PIC X(01) OCCURS 80.
	   03  WS-MID78 REDEFINES WS-MID-LNE2.
	       05  FILLER      PIC  X(01).
	       05  WS-BLNK78   PIC  X(78).
	       05  FILLER      PIC  X(01).
003040	   03  WS-BOT-LINE.
003050         05  WS-BCHAR PIC X(01) OCCURS 80.
003060     03  WS-BOT-LNE2.
003070         05  WS-BCR  PIC X(01) OCCURS 80.
003240     03  WS-B-LINE REDEFINES WS-BOT-LNE2.
003250         05  FILLER  PIC X(01).
               05  WS-MEM-LINE.
003260            07  WS-SRT-LINE
003270                     PIC X(50).
                  07  FILLER
                           PIC X(10).
003280         05  FILLER  PIC X(19).
003080     03  WS-TOP-LNE.
003090         05  WS-TCHR PIC X(01) OCCURS 80.
003100     03  WS-T-LINE REDEFINES WS-TOP-LNE.
003110         05  FILLER  PIC X(01).
003120         05  WS-H-LINE
003130                     PIC X(78).
003140         05  FILLER  PIC X(01).
003150     03  WS-MID-LNE.
003160         05  WS-MCHR PIC X(01) OCCURS 80.
	   03  WS-MST-LNE REDEFINES WS-MID-LNE.
	       05  WS-MST1     PIC  X(01).
	       05  WS-MST78    PIC  X(78).
	       05  WS-MST80    PIC  X(01).
003170	   03  WS-BOT-LNE.
003180         05  WS-BCHR PIC X(01) OCCURS 80.
003190     03  WS-TP-LNE.
003200         05  WS-TCH  PIC X(01) OCCURS 80.
003210     03  WS-MD-LNE.
003220         05  WS-MCH  PIC X(01) OCCURS 80.
	   03  WS-MDDT-LNE REDEFINES WS-MD-LNE.
	       05  WS-MDT1     PIC  X(01).
	       05  WS-MDT78    PIC  X(78).
	       05  WS-MDT80    PIC  X(01).
003230	   03  WS-BT-LNE.
003240         05  WS-BCH  PIC X(01) OCCURS 80.
           03  WS-MM-LINE.
               05  FILLER  PIC  X(01) VALUE X"B3".
               05  FILLER  PIC  X(60) VALUE SPACES.
               05  FILLER  PIC  X(01) VALUE X"B3".
           03  WS-HME-LINE PIC  X(60) VALUE ALL X"CD".

001260 COPY WS.WS.

001260 COPY CHAIN.WS.

       COPY LEDTRF.WS.

001280 01  W02-FID.

000450 COPY AUDIT.ID.

       COPY CHEQUE.ID.

       COPY CONTROL.ID.

000370 COPY DEPART.ID.

       COPY LEDTRF.ID.

000470 COPY RECOVER.ID.

000410 COPY SALE.ID.

000390 COPY STOCK.ID.

000140 COPY STKMEM.ID.

003880 COPY TXPTRN.ID.

000180 COPY TXTRAN.ID.

       01  W02-FILE-IDS.
           03  W02-PRINTER     PIC X(12) VALUE "LPT1".
           03  W02-CSHDRW     PIC X(04) VALUE "COM1".
003790 01  W05-TAX-RATES.
003800     03  W05-VAT-RATES.
003810         05  W05-VAT     PIC S9(03)V99 COMP-3 OCCURS 6.
003820     03  W05-TAX-RATES REDEFINES W05-VAT-RATES.
003830         05  W05-VAT-R1  PIC S9(03)V99 COMP-3.
003840         05  W05-VAT-R2  PIC S9(03)V99 COMP-3.
003850         05  W05-VAT-R3  PIC S9(03)V99 COMP-3.
003860         05  W05-VAT-R4  PIC S9(03)V99 COMP-3.
003870         05  W05-VAT-R5  PIC S9(03)V99 COMP-3.
003880         05  W05-VAT-R6  PIC S9(03)V99 COMP-3.
           03  W05-RATE        PIC S9(03)V99 COMP-3.
           03  W05-RTE REDEFINES W05-RATE
                               PIC S9V9(04)  COMP-3.
           03  W05-VATNO       PIC  X(14).
001550 01  W10-STOCK.
001560     03  W10-ITEM        PIC X(14).
001570     03  W10-DESC.
               05  W10-SDSC    PIC X(30).
001580     03  W10-IND         PIC X(01).
001590     03  W10-QUANT       PIC 9(05)V99  COMP-3.
001600     03  W10-REORD       PIC 9(05)V99  COMP-3.
001610     03  W10-COST        PIC 9(05)V99  COMP-3.
001620     03  W10-SELL        PIC 9(05)V99  COMP-3.
001630     03  W10-SPAPRC      PIC 9(05)V99  COMP-3.
001640     03  W10-LEDG        PIC 9(04)     COMP-5.
001650     03  W10-SMAN        PIC 9(02).
001660     03  W10-ORDER       PIC 9(05)V99  COMP-3.
001680     03  W10-AVRG        PIC 9(05)V99  COMP-3.
001690     03  W10-MARG        PIC 9(05)V99  COMP-3.
001700     03  W10-ACTIVE      PIC X(08).
002570     03  W10-CODE1      PIC X(14).
002580     03  W10-COD1 REDEFINES W10-CODE1.
002590         05  W10-CD1    PIC X(02).
002600         05  W10-CDE1   PIC X(12).
004210     03  W10-CODE2      PIC X(14).
004220     03  W10-COD2 REDEFINES W10-CODE2.
004230         05  W10-CD2    PIC X(02).
004240         05  W10-CDE2   PIC X(12).
004250     03  W10-ACODE      PIC X(10).
004260     03  W10-ACDE1 REDEFINES W10-ACODE.
004270         05  W10-ACRSE  PIC X(01).
004280         05  W10-ASFINE PIC X(02).
004290         05  FILLER     PIC X(07).
002850     03  W10-VSELL      PIC S9(07)V99  COMP-3.
002860     03  W10-VCASH      PIC S9(07)V99  COMP-3.
002860     03  W10-VWSALE     PIC S9(07)V99  COMP-3.
           03  W10-NAME       PIC  X(24).
           03  W10-TEL        PIC  X(14).
002510     03  W10-DATE       PIC  X(08).
002520     03  W10-EDTE REDEFINES W10-DATE PIC 99/99/99.
001710 01  W12-DATE.
001720     03  W12-TODAY       PIC 9(06).
001730     03  W12-DATE-DMY REDEFINES W12-TODAY.
001740         05  W12-DAY     PIC 9(02).
001750         05  W12-MONTH   PIC 9(02).
001760         05  W12-YEAR    PIC 9(02).
001770     03  W12-T-YMD       PIC 9(06).
001780     03  W12-DATE-YMD REDEFINES W12-T-YMD.
001790         05  W12-YY      PIC 9(02).
001800         05  W12-MM      PIC 9(02).
001810         05  W12-DD      PIC 9(02).
001820 01  W15-CASH-SLIP.
001830     03  W15-L1.
001840         05  W15-ESC1    PIC  X(01).
001850         05  W15-DBLE    PIC  X(01).
001860         05  W15-EXPP1   PIC  X(01).
001870         05  W15-COMP    PIC  X(32) VALUE SPACES.
001880         05  W15-ECAN1   PIC  X(01).
001890     03  W15-L1A.
001900         05  W15-ESC5    PIC  X(01).
001910         05  W15-DBLE3   PIC  X(01).
001920         05  W15-EXPP4   PIC  X(01).
001930         05  W15-DOCTYP  PIC  X(18) VALUE SPACES.
001940         05  W15-ECAN4   PIC  X(01).
001950     03  W15-L2.
001960         05  W15-ESC2    PIC  X(01).
001970         05  W15-DCAN    PIC  X(01).
001980         05  W15-ADD     PIC  X(32) VALUE SPACES.
001990     03  W15-L3.
002000         05  FILLER      PIC  X(14) VALUE "Tel. No./Nr.:".
002010         05  W15-TEL     PIC  X(18) VALUE SPACES.
           03  W15-L3A.
               05  FILLER      PIC  X(18) VALUE "VAT/BTW Reg. Nr.:".
               05  W15-GNO     PIC  X(14) VALUE SPACES.
002020     03  W15-L4.
002030         05  FILLER      PIC  X(12) VALUE "Date/Datum: ".
002040         05  W15-DATE    PIC  Z9/99/99.
	       05  FILLER      PIC  X(05).
	       05  W15-PRC     PIC  X(01).
002050     03  W15-L5.
002060         05  FILLER      PIC  X(08) VALUE "Assist:".
002070         05  W15-SMAN    PIC  X(24).
002080     03  W15-L6.
002090         05  FILLER      PIC  X(20) VALUE "Rec. No./Kwit. Nr.:".
002100         05  W15-RECNO   PIC  X(08).
002110     03  W15-L7.
002120         05  FILLER      PIC  X(20) VALUE "Inv. No./Fak. Nr. :".
002130         05  W15-INVNO   PIC  X(08).
002140     03  W15-L7A.
002150         05  FILLER      PIC  X(20) VALUE "Cr Note/Kt Nota   :".
002160         05  W15-CRNO    PIC  X(08).
002170     03  W15-L8.
002180         05  FILLER      PIC  X(21) VALUE "Acc. No./Rek. Nr. :".
002190         05  W15-ACCNO   PIC  X(06).
002200     03  W15-L9.
002210         05  W15-ESC3    PIC  X(01).
002220         05  W15-DBLE2   PIC  X(01).
002230         05  W15-EXPP2   PIC  X(01).
002240         05  FILLER      PIC  X(16) VALUE "THANK YOU/DANKIE".
002250         05  W15-ECAN2   PIC  X(01).
002260         05  W15-ESC4    PIC  X(01).
002270         05  W15-DCAN2   PIC  X(01).
002280     03  W15-L11.
002290         05  W15-COND1   PIC  X(01).
002300         05  W15-ITM     PIC  X(14).
002310         05  FILLER      PIC  X(01) VALUE SPACE.
002320         05  W15-QUANT   PIC  ZZZZ9.99.
002330         05  FILLER      PIC  X(01) VALUE SPACE.
002340         05  W15-DESC    PIC  X(20).
002350         05  FILLER      PIC  X(01) VALUE SPACE.
002360         05  W15-PRICE   PIC  Z(06)9.99-.
002370         05  W15-NORM1   PIC  X(01).
002380     03  W15-L12 REDEFINES W15-L11.
002390         05  FILLER      PIC  X(01).
002400         05  W15-DISCOUNT.
002410             07 FILLER   PIC  X(19).
002420             07  W15-DISC
002430                         PIC  X(19).
002440             07  W15-DSC PIC  Z9.99.
002450         05  FILLER      PIC  X(14).
002460     03  W15-L13.
002470         05  W15-REMK    PIC X(21).
002480         05  W15-VAL     PIC Z(06)9.99-.
002490 01  W20-DATE.
002500     03  W20-YY.
002510         05  W20-YEAR    PIC  9(02).
002520     03  W20-MM.
002530         05  W20-MONTH   PIC  9(02).
002540     03  W20-DD.
002550         05  W20-DAY     PIC  9(02).
002560 01  W20-DTE1 REDEFINES W20-DATE.
002570     03  W20-DTE         PIC  9(06).
       01  W21-DATES.
	   03  W21-DATE        PIC  9(06).
	   03  W22-DATE        PIC  9(06).
002730 01  W22-DATES.
002740     03  W22-DTE1        PIC 9(06).
002750     03  W22-DTE2        PIC 9(06).
002760     03  W22-DATE2 REDEFINES W22-DTE2.
002770         05  W22-YY2     PIC 9(02).
002780         05  W22-MM2     PIC 9(02).
002790         05  W22-DD2     PIC 9(02).
002800     03  W22-DTE3        PIC 9(06).
002810     03  W22-DATE3 REDEFINES W22-DTE3.
002820         05  W22-DD3     PIC 9(02).
002830         05  W22-MM3     PIC 9(02).
002840         05  W22-YY3     PIC 9(02).
002580 01  W25-CALCS.
002590     03  W25-RESULT      PIC  9(02)V99.
002600     03  W25-RESULT1 REDEFINES W25-RESULT.
002610         05  W25-WHOLE   PIC  9(02).
002620         05  W25-DECIMAL PIC  9(02).
002630     03  W25-TOTAL       PIC  9(07)V99 COMP-3.
002640     03  W25-VALUE       PIC S9(07)V99 COMP-3.
002650     03  W25-INSTAL      PIC S9(07)V99 COMP-3.
002660     03  W25-CREDIT      PIC S9(07)V99 COMP-3.
002670     03  W25-CUR         PIC S9(07)V99 COMP-3.
002680     03  W25-INSTL.
002690         05  W25-MTHS OCCURS 6
002700                         PIC S9(07)V99 COMP-3.
002710     03  W25-INSTALS REDEFINES W25-INSTL.
002720         05  W25-MTH1    PIC S9(07)V99 COMP-3.
002730         05  W25-MTH2    PIC S9(07)V99 COMP-3.
002740         05  W25-MTH3    PIC S9(07)V99 COMP-3.
002750         05  W25-MTH4    PIC S9(07)V99 COMP-3.
002760         05  W25-MTH5    PIC S9(07)V99 COMP-3.
002770         05  W25-MTH6    PIC S9(07)V99 COMP-3.
002780 01  W40-BINARY.
002790     03  W40-BIN.
002800         05  W40-DEC     PIC  9(02)    COMP-X.
002810     03  W40-HEX REDEFINES W40-BIN.
002820         05  W40-CHAR    PIC  X(01).
002830     03  W40-NAME.
002840         05  W40-NCH     PIC  X(01) OCCURS 32.
002850     03  W40-CSHPASS     PIC  X(06) VALUE SPACES.
       01  W41-SAVE.
           03  W41-LENGTH      PIC 9(04) COMP-X VALUE 2000.
           03  W41-START       PIC 9(04) COMP-X VALUE 1.
           03  W41-BUFFER      PIC 9(04) COMP-X VALUE 1.
       01  W42-ATTRIB.
           03  FILLER          PIC X(2000).
       01  W42-ATTRIB2.
           03  FILLER          PIC X(2000).
       01  W42-ATTRIB3.
           03  FILLER          PIC X(2000).
       01  W43-SCREEN.
           03  FILLER          PIC X(2000).
003570 01  W43-SCREEN2.
003580     03  FILLER.
               05  W43-LINE    OCCURS 25.
                   07  W43-DET PIC  X(80).
       01  W43-SCREEN3.
           03  FILLER          PIC X(2000).
       01  W44-FUNCTION        PIC 9(02)     COMP-X.

       COPY FUNCTION.KEY.

002870 COPY W50.WS.

002890 01  W60-ITEM.
002900     03  W60-ITM.
002910         05  W60-ICHAR OCCURS 14
002920                         PIC  X(01).
002930 01  W65-ENTRY.
002940     03  W65-FOUR.
002950         05  W65-CHAR OCCURS 2
002960                         PIC  X(01).
       COPY W70DEBT.IWS.

       01  W75-KEYS.
           03  W75-S          PIC 9(02) COMP-5.
           03  W75-S1         PIC 9(02) COMP-5.
           03  W75-S2         PIC 9(02) COMP-5.
           03  W75-SKEY       PIC 9(06) COMP-5 OCCURS 18.
           03  W75-ITEMS OCCURS 18.
               05  W75-CODE   PIC X(14).
               05  W75-SELL   PIC 9(07)V99 COMP-3.
               05  W75-VSELL  PIC 9(07)V99 COMP-3.
               05  W75-CASH   PIC 9(07)V99 COMP-3.
               05  W75-VCASH  PIC 9(07)V99 COMP-3.
               05  W75-WSALE  PIC 9(07)V99 COMP-3.
               05  W75-VWSALE PIC 9(07)V99 COMP-3.
005950 01  W85-RECORD151.
005960     03  W85-CSHDTE      PIC  9(06).
001760     03  W85-FLOAT       PIC S9(09)V99 COMP-3.
001770     03  W85-CASH        PIC S9(09)V99 COMP-3.
001780     03  W85-CHEQUES     PIC S9(09)V99 COMP-3.
001790     03  W85-CARDS       PIC S9(09)V99 COMP-3.
001800     03  W85-VATVAL      PIC S9(09)V99 COMP-3.
001810     03  W85-VOUCHERS    PIC S9(09)V99 COMP-3.
001820     03  W85-RECEIPTS    PIC S9(09)V99 COMP-3.
001830     03  W85-CSH         PIC S9(09)V99 COMP-3.
001840     03  W85-CSHMTD      PIC S9(09)V99 COMP-3.
001850     03  W85-CSHYTD      PIC S9(09)V99 COMP-3.
005970     03  W85-ESC         PIC  X(01).
005980     03  W85-DBL         PIC  X(01).
005990     03  W85-CDBL        PIC  X(01).
006000     03  W85-SI          PIC  X(01).
006010     03  W85-CSI         PIC  X(01).
006020     03  W85-SO          PIC  X(01).
006030     03  W85-CSO         PIC  X(01).
006040     03  W85-6LPI        PIC  X(01).
006050     03  W85-8LPI        PIC  X(01).
006060     03  W85-NUL         PIC  X(01).
006070     03  W85-ADVANCE     PIC  9(02) COMP-5.
006080     03  W85-CPRN        PIC  9(01).
           03  W85-ITMS        PIC S9(07)    COMP-3.
           03  W85-CUST        PIC S9(07)    COMP-3.
           03  W85-TAXVAL      PIC S9(09)V99 COMP-3.
           03  W85-ADVTAX      PIC S9(09)V99 COMP-3.
001980     03  FILLER          PIC  X(26).
           03  W85-PORT        PIC  9(01).
           03  W85-DRAWER      PIC  X(01).
003160 01  W85-PASS.
003180     03  W85-SUPER OCCURS 9
003190                         PIC  X(06).
003200     03  W85-ENTRY       PIC  9(02)    COMP-3.
003210     03  W85-MARG        PIC S9(02)V99.
003230 01  W90-TRAN.
003240     03  W90-DATE        PIC  X(08).
003250     03  W90-DTE REDEFINES W90-DATE
003260                         PIC  99/99/99.
003270     03  W90-CODE        PIC  9(02).
003280     03  W90-ORD         PIC  X(12).
003290     03  W90-REF         PIC  X(08).
003300     03  W90-REG         PIC  X(09).
003310     03  W90-DB          PIC  9(07)V99 COMP-3.
003320     03  W90-CR          PIC  9(07)V99 COMP-3.
003330     03  W90-BDT         PIC S9(07)V99 COMP-3.
003340     03  W90-BCR         PIC S9(07)V99 COMP-3.
003350     03  W90-DESC        PIC  X(12).
006300     03  W90-120         PIC S9(07)V99 COMP-3.
003360     03  W90-90          PIC S9(07)V99 COMP-3.
003370     03  W90-60          PIC S9(07)V99 COMP-3.
003380     03  W90-30          PIC S9(07)V99 COMP-3.
003390     03  W90-INT         PIC S9(07)V99 COMP-3.
003400     03  W90-DUE         PIC S9(07)V99 COMP-3.
003410     03  W90-CASH        PIC S9(07)V99 COMP-3.
003420     03  W90-CHQ         PIC S9(07)V99 COMP-3.
003430     03  W90-CARD        PIC S9(07)V99 COMP-3.
003440     03  W90-CHANGE      PIC S9(07)V99 COMP-3.
003450     03  W90-PMT         PIC S9(07)V99 COMP-3.
003460     03  W90-CUR         PIC S9(07)V99 COMP-3.
003470     03  W90-BAL         PIC S9(07)V99 COMP-3.
003480     03  W90-TAX         PIC  X(14).
003490     03  W90-DVAL        PIC  9(07)V99.
003500     03  W90-SALES       PIC S9(07)V99 COMP-3.
003510     03  W90-TDISC       PIC S9(07)V99 COMP-3.
003520     03  W90-TTAX        PIC S9(07)V99 COMP-3.
003530     03  W90-TCOST       PIC S9(07)V99 COMP-3.
003540     03  W90-TSELL       PIC S9(07)V99 COMP-3.
003550     03  W90-DISC        PIC S9(07)V99 COMP-3.
003560     03  W90-CRD         PIC S9(07)V99 COMP-3.
003570     03  W90-CDISC       PIC S9(07)V99 COMP-3.
003580     03  W90-LDISC       PIC S9(07)V99 COMP-3.
003590     03  W90-TAXVAL      PIC S9(07)V99 COMP-3.
006550     03  W90-EXCDIS      PIC S9(07)V99 COMP-3.
006550     03  W90-EXCTOT      PIC S9(07)V99 COMP-3.
003600     03  W90-NONTAX      PIC S9(07)V99 COMP-3.
003610     03  W90-VALUE       PIC S9(07)V99 COMP-3.
006570     03  W90-STOTAL      PIC S9(07)V99 COMP-3.
003620     03  W90-TOTAL       PIC S9(07)V9(06) COMP-3.
003630 01  W95-STM.
003640     03  W95-COMP        PIC  X(40).
003650     03  W95-ADD1        PIC  X(30).
003660     03  W95-ADD2        PIC  X(30).
003670     03  W95-ADD3        PIC  X(30).
003680     03  W95-ADD4        PIC  X(30).
003690     03  W95-POST        PIC  9(04).
003700     03  W95-TEL         PIC  X(08).
003710 01  W100-EDIT.
003720     03  W100-BAL        PIC  Z(06)9.99-.
003730     03  W100-CUR        PIC  Z(06)9.99-.
003740     03  W100-30         PIC  Z(06)9.99-.
003750     03  W100-60         PIC  Z(06)9.99-.
003760     03  W100-90         PIC  Z(06)9.99-.
003770     03  W100-INT        PIC  Z(06)9.99-.
003970     03  W100-V2.
003980         05  W100-S6V2   PIC Z(05)9.99-.
           03  W100-V3 REDEFINES W100-V2.
               05  W100-PRICE  PIC X(09).
               05  FILLER      PIC X(01).
           03  W100-V4 REDEFINES W100-V2.
               05  W100-EXT    PIC Z(06)9.99.
           03  W100-V5 REDEFINES W100-V2.
               05  W100-QNT    PIC Z(05)9.99-.
       01  W200-MEMO.
           03  W200-MEM-FLDS. 
               05  W200-MEM1   PIC  X(60).
               05  W200-MEM2   PIC  X(60).
               05  W200-MEM3   PIC  X(60).
               05  W200-MEM4   PIC  X(60).
               05  W200-MEM5   PIC  X(60).
               05  W200-MEM6   PIC  X(60).
               05  W200-MEM7   PIC  X(60).
               05  W200-MEM8   PIC  X(60).
               05  W200-MEM9   PIC  X(60).
               05  W200-MEM10  PIC  X(60).
               05  W200-MEM11  PIC  X(60).
               05  W200-MEM12  PIC  X(60).
           03  W200-MEM-FOC REDEFINES W200-MEM-FLDS.
               05  W200-MEM    PIC  X(60) OCCURS 12.
      /
003780 SCREEN SECTION.

       COPY BLANK.CRT.

003850 01  S001-OPTION-LINE.
003860     03  LINE 4  COLUMN 27 FOREGROUND-COLOR 15 VALUE "Option".
003870     03          COLUMN 41 FOREGROUND-COLOR 15 VALUE "Action".
003880 01  S05.
003890     03  LINE 12 COLUMN 12 VALUE "Enter Password >      <".
003900 01  S06.
003910     03  LINE 12 COLUMN 28 FOREGROUND-COLOR 15 PIC  X(06)
003920                           USING W40-CSHPASS AUTO SECURE.
003930 01  S07.
003940     03  LINE  2 COLUMN 35 FOREGROUND-COLOR 15 VALUE "CASH SALE".
003950     03  LINE  3 COLUMN  2 VALUE "Salesman".
003960     03  LINE  4 COLUMN  2 VALUE "Ref. No".
003970     03          COLUMN 21 VALUE "TAX No".
003980     03          COLUMN 67 VALUE "Date".
009390     03  LINE  5 COLUMN  2 REVERSE-VIDEO VALUE "No Item Code    ".
009400     03          COLUMN 17 REVERSE-VIDEO VALUE "   Description  ".
009410     03          COLUMN 33 REVERSE-VIDEO VALUE "                ".
009420     03          COLUMN 49 REVERSE-VIDEO VALUE "  Quantity ".
009430     03          COLUMN 60 REVERSE-VIDEO VALUE "Unit Price  ".
009440     03          COLUMN 72 REVERSE-VIDEO VALUE "Extended".
009160	   03  LINE  6 COLUMN  1 BACKGROUND-COLOR 0 VALUE "ฦ".
009160	   03	       COLUMN  2 VALUE "ออัออออออออออออออัออออออออออออออ
      -        "ออออออออออออออออัออออออออัอออออออออัออออออออออ".
	   03	       COLUMN 80 BACKGROUND-COLOR 0 VALUE "ต".
009160	   03  LINE 19 COLUMN  1 BACKGROUND-COLOR 0 VALUE "ฦ".
009170	   03	       COLUMN  2 VALUE "ออฯออออออออออออออฯออออออออออออออ
      -        "ออออออออออออออออฯออออออออฯอออออออออฯออออออออออ".
	   03	       COLUMN 80 BACKGROUND-COLOR 0 VALUE "ต".
004060	   03  LINE 20 COLUMN 3  VALUE "Sub Total".
004080     03          COLUMN 35 VALUE "Payment Received -".
004090     03          COLUMN 54 VALUE "Cash".
004100     03          COLUMN 66 VALUE ":".
004110     03  LINE 21 COLUMN 3  VALUE "Discount".
004130     03          COLUMN 54 VALUE "Cheque".
004140     03          COLUMN 66 VALUE ":".
004150     03  LINE 22 COLUMN 3  VALUE "T A X".
004170     03          COLUMN 54 VALUE "Credit Card".
004180     03          COLUMN 66 VALUE ":".
004190     03  LINE 23 COLUMN 3  VALUE "AMOUNT DUE".
004210     03          COLUMN 34 VALUE "-Balance".
004220     03          COLUMN 54 VALUE "CHANGE".
004230     03          COLUMN 66 VALUE ":".
004240 01  S08.
004250     03  LINE  1 COLUMN 36 VALUE "RECEIPT".
004260     03  LINE  3 COLUMN  1 VALUE "Rec. No".
004270     03          COLUMN 67 VALUE "Date".
004280     03  LINE  4 COLUMN  1 VALUE "A/C No".
004290     03          COLUMN 14 VALUE "Name".
004300 01  S09.
004310     03  LINE  1 COLUMN 50 VALUE "(".
004320     03          COLUMN 51 BLINK VALUE "REVERSAL".
004330     03          COLUMN 59 VALUE ")".
       01  S10.
           03  LINE 10 COLUMN 48 BACKGROUND-COLOR 7
                                 FOREGROUND-COLOR 14
                                 PIC  X(24) USING W10-NAME AUTO.
           03  LINE 11 COLUMN 48 BACKGROUND-COLOR 7
                                 FOREGROUND-COLOR 14
                                 PIC  X(14) USING W10-TEL AUTO.
           03  LINE 12 COLUMN 48 BACKGROUND-COLOR 7
                                 FOREGROUND-COLOR 14
                                 PIC  99/99/99 USING W22-DTE1 AUTO.

       COPY STKLUP.CRT.

004340 01  S26-QNT.
004350     03          COLUMN 51 FOREGROUND-COLOR 11
004360                           PIC Z(04)9.99 USING W10-QUANT AUTO.
004370 01  S26-PRC.
004380     03          COLUMN 60 FOREGROUND-COLOR 11
004390                           PIC Z(05)9.99 USING W10-SELL AUTO.
004400 01  S26-DSC.
004410     03          COLUMN 30 FOREGROUND-COLOR 11
004420                           PIC Z9.99 USING WS-DISC AUTO.
004430 01  S26-TDSC.
004440     03          COLUMN 15 FOREGROUND-COLOR 11
004450                           PIC Z9.99 USING WS-TDISC AUTO.
004460 01  S26-AVGE.
004470     03          COLUMN 28 FOREGROUND-COLOR 11
004480                           PIC Z(04)9.99 USING STK-AVGE AUTO.
004490 01  S26-CASH.
004500     03  LINE 20 COLUMN 68 FOREGROUND-COLOR 11
004510                           PIC Z(06)9.99- USING W90-CASH AUTO.
004520 01  S26-CHQ.
004530     03  LINE 21 COLUMN 68 FOREGROUND-COLOR 11
004540                           PIC Z(06)9.99- USING W90-CHQ AUTO.
004550 01  S26-CARD.
004560     03  LINE 22 COLUMN 68 FOREGROUND-COLOR 11
004570                           PIC Z(06)9.99- USING W90-CARD AUTO.
       01  S26-DATE.
	   03  LINE  3 COLUMN 72 FOREGROUND-COLOR 11
				 PIC  99/99/99 USING W21-DATE AUTO.
009920 01  S29.
009930     03  LINE 12 COLUMN 24 FOREGROUND-COLOR 15
009940                           PIC Z(06)9.99 USING PAR-FLOAT AUTO.
004580 01  S040-TRANS.
004590     03  LINE  6 COLUMN 29 FOREGROUND-COLOR 15 VALUE "1".
004600     03          COLUMN 41 VALUE "Cash Sales".
004610     03  LINE  7 COLUMN 29 FOREGROUND-COLOR 15 VALUE "2".
004620     03          COLUMN 41 VALUE "Open Cash Drawer".
004630     03  LINE  8 COLUMN 29 FOREGROUND-COLOR 15 VALUE "3".
004640     03          COLUMN 41 VALUE "Balancing Report".
004650     03  LINE  9 COLUMN 29 FOREGROUND-COLOR 15 VALUE "4".
004660     03          COLUMN 41 VALUE "Adjust Float".
004670     03  LINE 10 COLUMN 29 FOREGROUND-COLOR 15 VALUE "5".
004680     03          COLUMN 41 VALUE "Day/Month/Year-End".
004690     03  LINE 11 COLUMN 29 FOREGROUND-COLOR 15 VALUE "6".
004700     03          COLUMN 41 VALUE "Change Password".
004690     03  LINE 12 COLUMN 29 FOREGROUND-COLOR 15 VALUE "7".
004700     03          COLUMN 41 VALUE "Cash Refund".
004710     03  LINE 15 COLUMN 29 FOREGROUND-COLOR 15 VALUE "9".
004720     03          COLUMN 41 VALUE "End Program".
004730 01  S41.
004740     03  LINE 13 COLUMN 29 FOREGROUND-COLOR 15 VALUE "8".
004750     03          COLUMN 41 VALUE "Invoicing".
004760     03  LINE 15 COLUMN 29 FOREGROUND-COLOR 15 VALUE "0".
004770     03          COLUMN 41 VALUE "Program Control".
       01  S-MEM.
           03  LINE  6 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(01) USING WS-G9.
           03          COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING WS-MEM-LINE.
           03          COLUMN 78 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(01) USING WS-G10.
           03  LINE  7 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(01) USING WS-G3.
           03          COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7 VALUE 
           "   M E M O / R E M A R K S / S P E C I F I C A T I O N S    
      -    "".
           03          COLUMN 78 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(01) USING WS-G3.
           03  LINE  8 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(01) USING WS-G14.
           03          COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING WS-HME-LINE.
           03          COLUMN 78 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(01) USING WS-G13.
           03  LINE  9 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 10 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 11 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 12 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 13 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 14 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 15 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 16 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 17 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 18 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 19 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 20 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(62) USING WS-MM-LINE.
           03  LINE 21 COLUMN 17 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(01) USING WS-G11.
           03          COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING WS-MEM-LINE.
           03          COLUMN 78 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(01) USING WS-G12.
       01  SA-MEM.
           03  LINE  9 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM1 AUTO.
           03  LINE 10 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM2 AUTO.
           03  LINE 11 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM3 AUTO.
           03  LINE 12 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM4 AUTO.
           03  LINE 13 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM5 AUTO.
           03  LINE 14 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM6 AUTO.
           03  LINE 15 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM7 AUTO.
           03  LINE 16 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM8 AUTO.
           03  LINE 17 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM9 AUTO.
           03  LINE 18 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM10 AUTO.
           03  LINE 19 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM11 AUTO.
           03  LINE 20 COLUMN 18 FOREGROUND-COLOR 0
                                 BACKGROUND-COLOR 7
                                 PIC X(60) USING W200-MEM12 AUTO.
      /
004780 PROCEDURE DIVISION USING WS-PARID WS-USER-ID WS0-PROGRAMS.
004790 AA000              SECTION.
004800 AA000-INIT.
004810       PERFORM ZA000-INIT.
      *
      *    ****    S E T   U P   T H E   F U N C T I O N   K E Y S
      *
010280       MOVE 1              TO WS-S1.
010290       MOVE 59             TO WS-STAT2.
010300 AA02.
010310       MOVE 2              TO W50-LNGTH (WS-S1).
010320       MOVE WS-STAT2       TO W50-DEC (WS-S1).
010330     IF WS-S1 < 10
010340         ADD 1             TO WS-S1 WS-STAT2
010350         GO TO AA02.
010360       MOVE 133            TO WS-STAT2.
010370       MOVE 2              TO W50-LNGTH (11).
010380       MOVE WS-STAT2       TO W50-DEC (11).
010390       MOVE 134            TO WS-STAT2.
010400       MOVE 2              TO W50-LNGTH (12).
010410       MOVE WS-STAT2       TO W50-DEC (12).
010420       CALL X"B0" USING 0, W50-FUNCTIONS.
004820       GO TO BG00-TRAN.
      *
      *    ****    S C R E E N   C O N T E N T S
      *
      *            W44-FUNCTION = 0 - SAVE
      *                           1 - RESTORE
      *                           4 - CLEAR
      *
010440 AA12.
010450       CALL X"B7" USING W44-FUNCTION W41-SAVE W43-SCREEN.
      *
      *    ****    S C R E E N   A T T R I B U T E S
      *
      *            W44-FUNCTION = 2 - SAVE
      *                           3 - RESTORE
      *
010460 AA13.
010470       CALL X"B7" USING W44-FUNCTION W41-SAVE W42-ATTRIB.
       AA50.
010520     IF F1-KEY 
010530         MOVE "I" TO WS-ETYPE
010540     ELSE
010550     IF F2-KEY 
010560         MOVE "A" TO WS-ETYPE
010570     ELSE
010580     IF F3-KEY 
010590         MOVE "D" TO WS-ETYPE
010600     ELSE
010610     IF F4-KEY 
010620         MOVE "X" TO WS-ETYPE
             ELSE
             IF W50-KEY = 99
                 MOVE "Z"        TO WS-ETYPE.
010630       MOVE 0              TO W44-FUNCTION.
010640       PERFORM AA12.
010650       MOVE 2              TO W44-FUNCTION.
010660       PERFORM AA13.
010670       MOVE 4              TO W44-FUNCTION.
010680       PERFORM AA12.
010690       MOVE 72             TO WS-STAT2.
010700       MOVE 2              TO W50-LNGTH (11).
010710       MOVE WS-STAT2       TO W50-DEC (11).
010720       MOVE 80             TO WS-STAT2.
010730       MOVE 2              TO W50-LNGTH (12).
010740       MOVE WS-STAT2       TO W50-DEC (12).
010750       CALL X"B0" USING 0, W50-FUNCTIONS.
             PERFORM STOCK-LOOKUP.
010800       MOVE 133            TO WS-STAT2.
010810       MOVE 2              TO W50-LNGTH (11).
010820       MOVE WS-STAT2       TO W50-DEC (11).
010830       MOVE 134            TO WS-STAT2.
010840       MOVE 2              TO W50-LNGTH (12).
010850       MOVE WS-STAT2       TO W50-DEC (12).
010860       CALL X"B0" USING 0, W50-FUNCTIONS.
010870       MOVE 1              TO W44-FUNCTION.
010880       PERFORM AA12.
010890       MOVE 3              TO W44-FUNCTION.
010900       PERFORM AA13.
       AA99.
             EXIT.
 
       COPY LOCKED.REC.

       COPY CLEAR.CRT.

       COPY DATE.CHK.

      *
      *    ****   D I S P L A Y   L O O K U P   O P T I O N S 
      *
011010 AA300              SECTION.
011020 AA301.
011010	     DISPLAY "F1" AT 2502
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011020		     " Item code/ "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011030		     "F2" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011040		     " Alt code/ "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011050		     "F3" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011060		     " Description/ "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
011070		     "F4" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011080		     " Cross Reference Lookup"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
011110 AA305.
011120       EXIT.

      /
      *    ****    READ FILES ROUTINES
      *
004930 AC000-READ              SECTION.

011150 COPY AUDIT.RD.

       COPY CHEQUE.RD.

011170 COPY CONTROL.RD.

011230 COPY DEPART.RD.

       COPY LEDTRF.RD.

011290 COPY PARAM.RD.

011310 COPY SALE.RD.

011330 COPY STOCK.RD.

000140 COPY STKMEM.RD.

011330 COPY TXPTRN.RD.

011350 COPY TXTRAN.RD.

      /
006420 AD000-WRITE             SECTION.

011150 COPY AUDIT.WR.

       COPY CHEQUE.WR.

011170 COPY CONTROL.WR.

011230 COPY DEPART.WR.

       COPY LEDTRF.WR.

011290 COPY PARAM.WR.

011310 COPY SALE.WR.

011330 COPY STOCK.WR.

011330 COPY TXPTRN.WR.

011350 COPY TXTRAN.WR.

       COPY CASHDRAW.OPN.

       COPY STOCK.LUP.

      /
      *    THIS ROUTINE GENERATES THE RECOVERY FILE RECORDS
      *
011670 AY000           SECTION.
011680 AY01.
011690       MOVE 01             TO REC-FILE.
011700       MOVE WS-PARKEY      TO REC-KEY.
011710       PERFORM READ-PARAM-LOCK THRU READ-PARAM-EXIT.
011720       MOVE PAR-RECORD1    TO REC-PARAM.
011730       GO TO AY50.
011850 AY05.
011860       MOVE 05             TO REC-FILE.
011870       MOVE ZERO           TO REC-KEY.
011880       MOVE ZERO           TO REC-TYPE.
011890       PERFORM READ-STOCK-LOCK THRU READ-STOCK-EXIT.
011900       MOVE STK-RECORD1    TO REC-STOCKF.
011910       GO TO AY50.
011920 AY16.
011930       MOVE 16             TO REC-FILE.
011940       MOVE WS-AUDKEY      TO REC-KEY.
011950       MOVE AUD-REC1       TO REC-AUDITF.
011960       GO TO AY50.
011970 AY18.
011980	     MOVE 18		 TO REC-FILE.
011990       MOVE ZERO           TO REC-KEY.
012000       MOVE WS-ACTION      TO REC-TYPE.
012010	     MOVE TXP-RECORD1	 TO REC-TXPTRN.
012020       GO TO AY50.
011970 AY19.
011980       MOVE 19             TO REC-FILE.
011990       MOVE ZERO           TO REC-KEY.
012000       MOVE WS-ACTION      TO REC-TYPE.
012010       MOVE TAX-RECORD1    TO REC-TXTRAN.
012020       GO TO AY50.
       AY36.
             MOVE 36             TO REC-FILE.
             MOVE ZERO           TO REC-KEY.
             MOVE WS-ACTION      TO REC-TYPE.
             MOVE CHQ-RECORD1    TO REC-CHEQUE.
             GO TO AY50.
012090 AY38.
012100       MOVE 38             TO REC-FILE.
012110       MOVE WS-DEPKEY      TO REC-KEY.
012120       PERFORM READ-DEPART-LOCK THRU READ-DEPART-EXIT.
012130       MOVE DPT-RECORD     TO REC-DEPART.
012140       GO TO AY50.
012150 AY39.
012160       MOVE 39             TO REC-FILE.
012170       MOVE WS-NETKEY      TO REC-KEY.
012180       MOVE NET-RECORD     TO REC-NETWORK.
012190       GO TO AY50.
012200 AY40.
011080       MOVE 40             TO REC-FILE.
008020       MOVE ZERO           TO REC-KEY.
             MOVE WS-ACTION      TO REC-TYPE
011100       MOVE XFR-REC        TO REC-LEDTRF.
011110       GO TO AY50.
       AY49.
012210       MOVE 99             TO REC-FILE.
012220       MOVE ZERO           TO REC-KEY.
012230       MOVE SPACES         TO REC-DETAIL.
012240       PERFORM AY50.
012250       ADD 1               TO WS-TRANS.
012260     IF WS-RECOVER > 95
012270         CLOSE RECOVER
012280         OPEN OUTPUT RECOVER
012290         CLOSE RECOVER
012300         OPEN I-O RECOVER
012310         MOVE ZERO         TO WS-RECOVER.
012320       GO TO AY59.
012330 AY50.
012340       ADD 1               TO WS-RECOVER.
012350       MOVE WS-RECOVER     TO WS-RECKEY.
012360       MOVE WS-TRANS       TO REC-TRAN.
012370       WRITE REC-RECORD.
012380     IF WS-STATUS NOT = "00"
012390         DISPLAY "Write error Recovery file - Status " AT 2212
012400                  WITH FOREGROUND-COLOR 14
012410                  WS-STATUS WITH FOREGROUND-COLOR 15
012420         STOP RUN.
012430       CLOSE RECOVER.
012440       OPEN I-O RECOVER.
012450 AY59.
012460       EXIT.
012470 AY60.
      *
      *    ****    Read PARAM record 4 - Lock record and start recovery
      *            file procedure.
      *
012480     IF WS-SKIP = "Y" OR "A"
012490         GO TO AY999.
012500       MOVE 4              TO WS-PARKEY.
012510       PERFORM READ-PARAM-LOCK THRU READ-PARAM-EXIT.
012520     IF PAR-USERS < 24
012530         MOVE 1            TO WS-SUB
012540         GO TO AY62.
012550	     DISPLAY "WAITING" AT 2551
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 12.
012560	     UNLOCK PARAM.
012570       MOVE -3977          TO WS-WAIT.
012580       PERFORM LOCK-REC-LOOP.
012590	     DISPLAY SPACE AT 2551
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 3.
012600       GO TO AY60.
012610 AY61.
012620       MOVE "DS"           TO PAR-PROG (WS-USUB).
012630       MOVE WS-USER        TO PAR-USR (WS-USUB).
012640       PERFORM REWRITE-PARAM-UNLOCK THRU WRITE-PARAM-EXIT.
      *
      *    ****    Read the DEBTOR control record in the NETWORK file
      *            and lock it. Log details to the RECOVERY file.
      *
012690       MOVE 5              TO WS-NETKEY.
012700       PERFORM READ-CONTROL-LOCK THRU READ-CONTROL-EXIT.
012650       MOVE 1              TO WS-NETKEY.
012660       PERFORM READ-CONTROL-LOCK THRU READ-CONTROL-EXIT.
012670       PERFORM AY39 THRU AY59.
012680       MOVE NET-DEBTOR     TO W70-DEBT.
012690       MOVE 3              TO WS-NETKEY.
012700       PERFORM READ-CONTROL-LOCK THRU READ-CONTROL-EXIT.
012710       PERFORM AY39 THRU AY59.
012720       GO TO AY999.
012730 AY62.
012740     IF PAR-PROG (WS-SUB) = "DB" OR "DS" OR "CS"
      *
      *    ****    Test if this is a program error first
      *
               IF WS-USER = PAR-USR (WS-USUB)
                   SUBTRACT 1    FROM PAR-USERS
                   MOVE SPACES   TO PAR-PROG (WS-USUB)
                                    PAR-USR (WS-USUB)
               ELSE
                   UNLOCK PARAM
                   DISPLAY "Waiting" AT 2572 
			    WITH BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 14 BLINK
                   MOVE -5000    TO WS-WAIT
                   PERFORM LOCK-REC-LOOP
                   DISPLAY "Waiting" AT 2572 
			    WITH BACKGROUND-COLOR 3
				 FOREGROUND-COLOR 14 BLINK
                   GO TO AY60.
012830     IF WS-SUB < 24
012840         ADD 1             TO WS-SUB
012850         GO TO AY62.
012860	     DISPLAY SPACE AT 2572
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
012870       MOVE 1              TO WS-SUB.
012880 AY63.
012890     IF PAR-USR (WS-SUB) = SPACES
012900         MOVE WS-SUB       TO WS-USUB
012910         ADD 1             TO PAR-USERS
012920         GO TO AY61.
012930       ADD 1               TO WS-SUB. 
012940       GO TO AY63.
012950 AY70.
      *
      *    ****    Write links back and unlock PARAM record 4 and
      *            NETWORK record 1.
      *
012960       PERFORM REWRITE-CONTROL THRU WRITE-CONTROL-EXIT.
012970       MOVE 1              TO WS-NETKEY.
012980       MOVE W70-DEBT       TO NET-DEBTOR.
012990       PERFORM REWRITE-CONTROL-UNLOCK THRU WRITE-CONTROL-EXIT.
013000       PERFORM AY49 THRU AY59.
013010       MOVE 4              TO WS-PARKEY.
013020       PERFORM READ-PARAM-LOCK-END THRU READ-PARAM-EXIT.
013030       MOVE SPACES         TO PAR-PROG (WS-USUB)
013040                              PAR-USR (WS-USUB).
013050       SUBTRACT 1          FROM PAR-USERS.
013060       PERFORM REWRITE-PARAM-UNLOCK THRU WRITE-PARAM-EXIT.
013070       COMMIT.
013080 AY999.
013090       EXIT.
      /
020450 AZ000-END               SECTION.
020460 AZ000-EOJ.
             CLOSE NETWORK
020500             AUDIT
                   CSHSLE
020480             DEPART
                   LEDTRF
                   PARAM
020470             STOCK
                   STKMEM
		   TXPTRN
                   TXTRAN
020520             RECOVER.
020540 AZ100.
020550     IF WS-OPTION = "8" OR "0"
               GO TO AZ105.
020680       DISPLAY CLR-SCREEN.
020690       DISPLAY (12, 12) "You may now switch the power off"
020700                         WITH FOREGROUND-COLOR 14.
020710       STOP RUN.
       AZ105.
             EXIT PROGRAM.
      /
007970 BG00-TRAN               SECTION.
007980 BG00.
007990       DISPLAY CLR-SCREEN.
008000       DISPLAY "CASH DRAWER CONTROL" AT 0231
008010                WITH FOREGROUND-COLOR 9.
008020       DISPLAY S001-OPTION-LINE.
008030       DISPLAY S040-TRANS.
008040     IF WS-CSS = "Y"
008050         DISPLAY S41.
008060       DISPLAY (17, 41) WS-SELECT WITH FOREGROUND-COLOR 11.
           IF WS-DAYS > 65
               COMPUTE WS-NUM = 15 - (WS-DAYS - 65)
               DISPLAY "This package must be registered within " AT 2502
			WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 12
			WS-NUM WITH BACKGROUND-COLOR 3
				    FOREGROUND-COLOR 15 BLINK
		       " days" WITH BACKGROUND-COLOR 3
				    FOREGROUND-COLOR 12.
008070 BG05.
008080       ACCEPT (17, 29) WS-OPTION WITH FOREGROUND-COLOR 15 AUTO.
008090       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
008140       MOVE ZERO TO W90-BAL.
	     MOVE 1		 TO WS-VAT-SUB.
008150     IF WS-OPTION = "1"
008160         PERFORM DA000
008170     ELSE
008180     IF WS-OPTION = "2"
008190         PERFORM OPEN-CASH-DRAWER THRU OPEN-CASH-DRAWER-EXIT
008200     ELSE
008210     IF WS-OPTION = "3"
008220         PERFORM EA000
008230     ELSE
008240     IF WS-OPTION = "4"
008250         PERFORM FA000
008260     ELSE
008270     IF WS-OPTION = "5"
008280         PERFORM GA000
008290     ELSE
008300     IF WS-OPTION = "6"
008310         PERFORM HA000
008320     ELSE
008300     IF WS-OPTION = "7"
008310         PERFORM JA000
008320     ELSE
           IF WS-OPTION = "*"
               PERFORM IA000
           ELSE
008330     IF WS-CSS = "N"
008340         IF WS-OPTION = "9"
008350             GO TO AZ000-EOJ
008360         ELSE
008370             GO TO BG00
008380     ELSE
008390     IF WS-OPTION = "8" OR "0"
008400         GO TO AZ000-EOJ.
008410       GO TO BG00.
008600 BG80.
008610       MOVE W70-AUDIT      TO WS-AUDKEY.
008620       MOVE LOW-VALUES     TO AUD-REC1.
008630       PERFORM AY16 THRU AY59.
008640       MOVE STK-CODE       TO AUD-CODE.
008650       MOVE 2              TO AUD-TYPE.
008660       MOVE WS-DRAW        TO AUD-SUB.
008680       PERFORM WRITE-AUDIT THRU WRITE-AUDIT-EXIT.
008690       ADD 1               TO W70-AUDIT.
008700       MOVE 1              TO WS-AUDKEY.
008710       PERFORM READ-AUDIT THRU READ-AUDIT-EXIT.
008720       PERFORM AY16 THRU AY59.
008730       MOVE 1              TO AUD-REP2.
008740       PERFORM REWRITE-AUDIT THRU WRITE-AUDIT-EXIT.
008750 BG85.
008760       EXIT.
      *
      *    ****   G E T   S T O C K   R E C O R D   U S I N G   C O D E
      *
013270 CA000         SECTION.
013280 CA00.
013290       MOVE 14             TO W50-LENGTH.
013300 CA05.
013310       MOVE W10-ITEM       TO W50-DATA.
013320     IF W50-1 = SPACE
013330         MOVE W50-13       TO W10-ITEM
013340         GO TO CA05.      
013350       CALL "_MSUPCASE" USING W50-DATA
013360                        LENGTH W50-DATA
013370                               W50-LENGTH
013380                        LENGTH W50-LENGTH
013390                               W50-STATUS.
013400       MOVE W50-ITEM       TO W10-ITEM.
013410 CA06.
013420       MOVE W50-ITEM       TO STK-CODE.
013430 CA10.
013440       PERFORM READ-STOCK THRU READ-STOCK-EXIT.
013450     IF WS-F-ERROR = 0
013460         PERFORM CA500.
013470 CA99.
013480       EXIT.
      *
      *    ****   G E T   S T O C K   R E C O R D   U S I N G   
      *           A L T E R N A T E   C O D E
      *
013490 CA100         SECTION.
013500 CA101.
013510       MOVE 10             TO W50-LENGTH.
013520 CA105.
013530       MOVE W10-ACODE      TO W50-DATA.
013540     IF W50-1 = SPACE
013550         MOVE W50-9        TO W10-ACODE
013560         GO TO CA105.      
013570       CALL "_MSUPCASE" USING W50-DATA
013580                        LENGTH W50-DATA
013590                               W50-LENGTH
013600                        LENGTH W50-LENGTH
013610                               W50-STATUS.
013620       MOVE W50-ACODE      TO STK-ACODE W10-ACODE.
013630 CA110.
013640       PERFORM START-AT-ALT-CODE THRU READ-STOCK-EXIT.
013650     IF WS-F-ERROR = 22
013660         GO TO CA119.
013670       PERFORM READ-STOCK-NEXT THRU READ-STOCK-EXIT.
013680     IF WS-F-ERROR = 0
013690         PERFORM CA500.
013700 CA119.
013710       EXIT.
      *
      *    ****   G E T   S T O C K   R E C O R D   U S I N G   X R E F
      *
014230 CA200         SECTION.
014240 CA201.
014250       MOVE 14             TO W50-LENGTH.
014260 CA205.
014270       MOVE W10-CODE2      TO W50-DATA.
014280     IF W50-1 = SPACE
014290         MOVE W50-13       TO W10-CODE2
014300         GO TO CA205.      
014310       CALL "_MSUPCASE" USING W50-DATA
014320                        LENGTH W50-DATA
014330                               W50-LENGTH
014340                        LENGTH W50-LENGTH
014350                               W50-STATUS.
014360       MOVE W50-ITEM       TO W10-CODE2.
014370 CA206.
014380       MOVE W50-ITEM       TO STK-XREF.
014390 CA210.
014400       PERFORM START-AT-STOCK-XREF THRU READ-STOCK-EXIT.
014410     IF WS-F-ERROR = 22
014420         GO TO CA299.
014430       PERFORM READ-STOCK-NEXT THRU READ-STOCK-EXIT.
014440       PERFORM CA500.
014450 CA299.
014460       EXIT.
      *
      *    ****    Calculate the inclusive prices
      *
014470 CA500         SECTION.
014480 CA505.
014490     IF STK-WSALE = ZERO
014500         IF STK-CASH NOT = ZERO
014510             MOVE STK-CASH TO STK-WSALE
014520         ELSE
014530             MOVE STK-SELL TO STK-WSALE.
014540     IF STK-CASH = ZERO
014550         MOVE STK-SELL     TO STK-CASH.
014560       MOVE STK-CASH       TO W10-VCASH
014570       MOVE STK-SELL       TO W10-VSELL
014580       MOVE STK-WSALE      TO W10-VWSALE.
014590       MOVE ZERO           TO W05-RATE.
014670     IF STK-TAX > 0
014680	       MOVE W05-VAT (WS-VAT-SUB)
014690                           TO W05-RATE.
014700       COMPUTE W10-VCASH ROUNDED 
014710             = W10-VCASH + (W10-VCASH * W05-RTE).
014720       COMPUTE W10-VWSALE ROUNDED 
014730             = W10-VWSALE + (W10-VWSALE * W05-RTE).
014740       COMPUTE W10-VSELL ROUNDED 
014750             = W10-VSELL + (W10-VSELL * W05-RTE).
014760 CA599.
014770       EXIT.

       COPY LEDTRF.UPD.

      /
009550 DA000                   SECTION 52.
009560 DA00.
      *
      *    ****    S U P E R V I S O R   P A S S W O R D S
      *
018520       MOVE 5              TO WS-PARKEY.
018530       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
018540       MOVE PAR-PW         TO W85-PASS. 
009600       ADD 150 WS-DRAW GIVING WS-PARKEY.
009610       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
009620       MOVE PAR-RECORD151 TO W85-RECORD151.
009630 DA05.
009640       DISPLAY CLR-SCREEN.
009650       DISPLAY S07.
009660       MOVE 7 TO LIN.
009670       PERFORM DA48 UNTIL LIN > 18.
009680       MOVE W85-CSHDTE TO W90-DTE W15-DATE.
009690       DISPLAY (3, 72) W90-DTE WITH FOREGROUND-COLOR 11.
009700       MOVE ZERO           TO W90-BDT W90-NONTAX W90-LDISC 
                                    W90-BAL W90-TAXVAL W90-SALES 
                                    W90-CUR W90-EXCTOT W10-SMAN.
009720       MOVE 1              TO WS-FIRST WS-LAST.
009730       MOVE SPACES         TO W90-TAX.
009740       MOVE SPACES         TO CSH-DATA.
009750 DA06.
	     DISPLAY "Key 99 to EXIT" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
009760       ACCEPT (3, 11) W10-SMAN
009770                      WITH FOREGROUND-COLOR 11 UPDATE AUTO.
           IF W10-SMAN = 99
               GO TO DA999.
009780     IF W10-SMAN > 50
009790         GO TO DA06.
	     DISPLAY CLEAR-L25.
009800     IF W10-SMAN = ZERO
009810         GO TO DA07.
009820       ADD 100 W10-SMAN GIVING WS-PARKEY.
009830       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
009840     IF PAR-SALESMAN = SPACES
009850         GO TO DA06.
009860       DISPLAY (3, 15) PAR-SALESMAN WITH FOREGROUND-COLOR 11.
009870 DA07.
009970	     MOVE PAR-SALESMAN TO W15-SMAN.
009980	     DISPLAY CLEAR-L25.
019660	     DISPLAY "Prices to use - " AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
019670		     "R" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
019680		     "etail/account, "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
019690		     "C" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
019700		     "ash or "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
019710		     "W" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
019720		     "holesale > <"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
019740       MOVE "C"            TO WS-PRC.
019770 DA10.
019780	     ACCEPT WS-PRC AT 2563
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15
			 UPDATE AUTO.
019790       CALL "_MSUPCASE" USING WS-PRC
019800                        LENGTH WS-PRC
019810                               WS-LENGTH
019820                        LENGTH WS-LENGTH
019830                               WS-STATUS.
019840     IF NOT (WS-PRC = "C" OR "R" OR "W")
019850         GO TO DA10.
010120     IF WS-OPTION = "Y"
010130         GO TO DA20.
010140 DA15.
010260	     DISPLAY CLEAR-L25.
010270 DA20.
010280       MOVE 7 TO LIN.
010290       MOVE ZERO TO W90-DB.
010300 DA25.
010310       MOVE SPACES         TO W10-DESC W10-ITEM.
010320       MOVE ZERO           TO W10-SELL WS-SUPER.
             MOVE 1              TO W10-QUANT.
010330 DA30.
020730       PERFORM AA300.
      *
      *    ****    G E T   S T O C K   C O D E
      *
020740       ACCEPT (LIN, 5) W10-ITEM WITH FOREGROUND-COLOR 11
020750                                     UPDATE AUTO.
           IF ESC-KEY
017730         DISPLAY (LIN, 1) WS-MID-LINE
010370         SUBTRACT 1 FROM WS-LAST
010380         GO TO DA49.
020760     IF F1-KEY OR F2-KEY OR F3-KEY OR F4-KEY
020770         PERFORM AA50
020780         DISPLAY (LIN, 5) W10-ITEM WITH FOREGROUND-COLOR 11
020790         IF W10-ITEM = SPACES
                   GO TO DA30.
010360     IF W10-ITEM = SPACES
010370         SUBTRACT 1 FROM WS-LAST
010380         GO TO DA49.
       DA31.
             PERFORM CA000.
           IF WS-F-ERROR = 22
               MOVE 99           TO W50-KEY
018620         PERFORM AA50
018630         DISPLAY (LIN, 5) W10-ITEM WITH FOREGROUND-COLOR 11
018640         IF W10-ITEM = SPACES
018720             GO TO DA30
               ELSE
                   GO TO DA31.
010430       MOVE WS-LAST TO WS-SALKEY.
010440       INITIALIZE SAL-RECORD1.
010450       MOVE WS-LAST TO SAL-CODE.
      *
      *    ****    I T E M   N U M B E R   O N   C A S H   S L I P
      *
010460       DISPLAY (LIN, 2) WS-LAST WITH FOREGROUND-COLOR 11.
010470       MOVE STK-CODE  TO SAL-ITEM.
010480	     DISPLAY CLEAR-L25.
      *
      *    ****    I S   I T   A   F R E E - F O R M A T   I T E M
      *
010490 DA33.
010500     IF STK-IND = 3
020960         MOVE ZERO         TO STK-AVGE
010510         ACCEPT (LIN, 20) W10-DESC
010520                          WITH UPDATE FOREGROUND-COLOR 11 AUTO
010530         DISPLAY (25, 12) "Index Unit cost"
010540				 WITH BACKGROUND-COLOR 3
				      FOREGROUND-COLOR 14
010550         ACCEPT S26-AVGE AT LINE 25
010560     ELSE
010570         MOVE STK-DESC TO W10-DESC
010580         DISPLAY (LIN, 20) W10-DESC WITH FOREGROUND-COLOR 11.
021050     IF STK-IND = 3
021060         IF STK-AVGE = ZERO
021070             DISPLAY "Unit cost is zero" AT 2512
021080			    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
                   GO TO DA33.
021100	     DISPLAY CLEAR-L25.
      *
      *    ****    L O G   D E T A I L S   T O   S A L E S   F I L E
      *
010590       MOVE W10-ITEM TO SAL-ITEM.
010600       MOVE W10-DESC TO SAL-DESC.
010610       MOVE STK-AVGE TO SAL-COST W10-COST.
       DA35.
010620       ACCEPT S26-QNT AT LINE LIN.
017720     IF ESC-KEY OR (W10-QUANT = ZERO)
017730         DISPLAY (LIN, 1) WS-MID-LINE
017740         GO TO DA25.
021180	     DISPLAY CLEAR-L25.
      *
      *    ****    G E T   S E L L I N G   P R I C E   (ACCOUNT OR CASH)
      *
021190     IF STK-IND < 3
021320         IF W90-TAX NOT = SPACES
021330             IF WS-PRC = "R"
021340                 MOVE STK-SELL 
021350                           TO W10-SELL
021360             ELSE
021370             IF WS-PRC = "C"
021380                 MOVE STK-CASH 
021390                           TO W10-SELL
021400             ELSE
021410                 MOVE STK-WSALE 
021420                           TO W10-SELL
021430         ELSE
021440             IF WS-PRC = "R"
021450                 MOVE W10-VSELL 
021460                           TO W10-SELL
021470             ELSE
021480             IF WS-PRC = "C"
021490                 MOVE W10-VCASH 
021500                           TO W10-SELL
021510             ELSE
021520                 MOVE W10-VWSALE 
021530                           TO W10-SELL.
010720 DA35A.
010730       ACCEPT S26-PRC AT LINE LIN.
           IF ESC-KEY
010380         GO TO DA35.
010740       MOVE W10-SELL TO W10-SPAPRC.
010750       PERFORM DA110 THRU DA120.
010760     IF WS-ERROR = 1
010770         MOVE ZERO TO WS-ERROR
010780         GO TO DA35A.
010790 DA35B.
010800       MOVE W10-SELL TO SAL-SELL.
010810     IF STK-IND > 0
010820         GO TO DA40.
010830     IF STK-QUANT = ZERO
010840         DISPLAY (25, 12) "No stock - Continue (Y/N) > <"
010850		       WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
010860         DISPLAY (25, 42) "'Y' will make stock holding negative"
010870		       WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
010880	       ACCEPT (25, 39) WS-OPTION
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO
010890         CALL "_MSUPCASE" USING WS-OPTION
023170                          LENGTH WS-OPTION
023180                                 WS-LENGTH
023190                          LENGTH WS-LENGTH
023200                                 WS-STATUS
010940	       DISPLAY CLEAR-L25
010950         IF WS-OPTION = "N"
010960             MOVE W10-QUANT TO W10-REORD
010970             GO TO DA25.
010980     IF (W10-QUANT NOT > STK-QUANT) OR
010990        (STK-QUANT NOT > ZERO)
011000         GO TO DA40.
011010       SUBTRACT STK-QUANT FROM W10-QUANT GIVING W10-REORD.
011020       MOVE STK-QUANT TO W100-BAL.
011030       DISPLAY (25, 2) "Insufficient Stock "
011040		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
011050		     W100-BAL
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15
011060		    " Accept (Enter/N) ?"
011070		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
011080	     ACCEPT (25, 52) WS-OPTION
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
011090       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
011140	     DISPLAY CLEAR-L25.
011150     IF WS-OPTION = "N"
011160         MOVE W10-QUANT TO W10-REORD
011170         GO TO DA25.
011180       MOVE STK-QUANT TO W10-QUANT.
011190       DISPLAY S26-QNT AT LINE LIN.
011200 DA40.
      *
      *    ****    C A L C U L A T E   E X T E N D E D   V A L U E
      *
011210       MOVE W10-QUANT TO SAL-QNT.
011220       COMPUTE W25-VALUE ROUNDED = (1.000 * W10-SELL * W10-QUANT).
011230       MOVE W25-VALUE TO W15-PRICE SAL-VAL W100-EXT.
011240       DISPLAY (LIN, 70) W100-EXT WITH FOREGROUND-COLOR 11.
      *
      *    ****    L I N E   D I S C O U N T   ( PERCENTAGE )
      *
011250	     DISPLAY (25, 18) "Discount %"
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
011260       MOVE ZERO TO WS-DISC W90-CDISC.
011270 DA42.       
011280       ACCEPT S26-DSC AT LINE 25.
           IF ESC-KEY
011140	       DISPLAY CLEAR-L25
010380         GO TO DA35A.
011290     IF WS-DISC = ZERO
011300         GO TO DA45.
011310       COMPUTE W10-SPAPRC ROUNDED = W10-SELL -
011320             (W10-SELL * WS-DISC / 100.00000).
      *
      *    ****    C H E C K   M A R G I N
      *
011330       PERFORM DA110 THRU DA120.
011340     IF WS-ERROR = 1
011350         GO TO DA42.
	     DISPLAY CLEAR-L25.
011360       MOVE WS-DISC TO SAL-DSC.
011370       COMPUTE W90-CDISC ROUNDED = ((W25-VALUE * WS-DISC) / 100).
011380       MOVE W90-CDISC TO W15-PRICE SAL-DISC.
011390	     DISPLAY (25, 40) W15-PRICE
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15.
011400 DA45.
      *
      *    ****    A R E   T H E   D E T A I L S   C O R R E C T
      *
011410*      DISPLAY (25, 18) WS-CHK
      *		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
011420*      ACCEPT (25, 52) WS-OPTION
      *		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
011430*      CALL "_MSUPCASE" USING WS-OPTION
023170*                       LENGTH WS-OPTION
023180*                              WS-LENGTH
023190*                       LENGTH WS-LENGTH
023200*                              WS-STATUS.
011480*    IF WS-OPTION = "N"
011490*        GO TO DA30.
011500 DA45A.
      *
      *    ****    A C C U M U L A T E   TOTAL COST / TOTAL DISCOUNT /
      *            VALUES SUBJECT TO TAX AND NON-TAX.
      *
011510     IF (STK-IND < 2) OR (STK-IND = 3)
011520         COMPUTE W90-BAL = W90-BAL + (W10-QUANT * W10-COST).
011530       ADD W90-CDISC TO W90-LDISC.
011540       SUBTRACT W90-CDISC FROM W25-VALUE GIVING W90-VALUE.
           IF STK-TAX = 0
022540         ADD W90-VALUE     TO W90-NONTAX
022550         MOVE W90-VALUE    TO SAL-NONTAX
022560     ELSE
022570         MOVE W90-VALUE    TO SAL-TAXVAL
022580         ADD W90-VALUE     TO W90-TAXVAL.
           IF W90-TAX NOT = SPACES
               COMPUTE SAL-VAT ROUNDED = 
                       SAL-TAXVAL * W05-RATE / 100.
      *
      *    ****    A C C U M U L A T E   T O T A L   S A L E
      *
011610       ADD W25-VALUE TO W90-DB.
011620 DA45B.
011630       MOVE W90-DB TO W90-TOTAL.
011640       SUBTRACT W90-LDISC FROM W90-TOTAL.
011650       MOVE W90-DB TO W15-PRICE.
011660       DISPLAY (20, 15) W15-PRICE WITH FOREGROUND-COLOR 11.
011670       MULTIPLY -1 BY W90-LDISC GIVING W15-PRICE.
011680       DISPLAY (21, 15) W15-PRICE WITH FOREGROUND-COLOR 11.
       DA45-AA.
011750       MOVE W90-TOTAL TO W15-VAL.
011760       DISPLAY (23, 15) W15-VAL WITH FOREGROUND-COLOR 11.
011770 DA45C.
011780	     DISPLAY CLEAR-L25.
023170	     DISPLAY "A" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023180		     "ccept, "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
023190		     "C" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023200		     "ancel > <"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
022850	     MOVE "A"		 TO WS-OPTION.
011820 DA46.
      *
      *    ****    M U S T   T H E   L A S T   E N T R Y   B E  
      *            A C C E P T E D.
      *
011830       ACCEPT (25, 28) WS-OPTION
011840		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15
			 UPDATE AUTO.
011850       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
011900     IF NOT (WS-OPTION = "A" OR "C")
011910         GO TO DA46.
011920	     DISPLAY CLEAR-L25.
011930     IF WS-OPTION = "C"
011940         DISPLAY (LIN, 1) WS-MID-LINE
               PERFORM DA47
               PERFORM DA45B THRU DA45-AA
011950         GO TO DA25.               
             MOVE WS-SUPER       TO SAL-SUPER.
011960       PERFORM WRITE-SALE THRU WRITE-SALE-EXIT.
011970       ADD 1 TO WS-LAST.
011980     IF LIN < 18
011990         ADD 1 TO LIN
012000         GO TO DA25.
012010       MOVE 7 TO LIN.
012020       PERFORM DA48 UNTIL LIN > 18.
012030       MOVE 7 TO LIN.
012040       GO TO DA25.
       DA47.
025340       SUBTRACT W25-VALUE FROM W90-DB.
025350       SUBTRACT W90-CDISC FROM W90-LDISC.
025360       SUBTRACT SAL-NONTAX FROM W90-NONTAX.
025370       SUBTRACT SAL-TAXVAL FROM W90-TAXVAL.
025380     IF (STK-IND < 2) OR (STK-IND = 3)
025390         COMPUTE W90-BAL = W90-BAL - (W10-COST * W10-QUANT).
012050 DA48.
012060       DISPLAY (LIN, 1) WS-MID-LINE.
012070       ADD 1 TO LIN.
012080 DA49.
012090     IF WS-LAST = ZERO
012100         GO TO DA05.
      *
      *    ****    P R O C E S S   T H E   P A Y M E N T
      *
012110 DA50.
012120	     DISPLAY CLEAR-L25.
023960	     DISPLAY "P" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023970		     "rocess Invoice, "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
023980		     "A" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023990		     "mend sales, "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
024000		     "C" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
024010		     "ancel or "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
024020		     "M" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
024030		     "ore items"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
012150 DA51.
012160	     ACCEPT (25, 63) WS-OPTION
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
012170       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
012220     IF NOT (WS-OPTION = "P" OR "A" OR "C" OR "M")
012230         GO TO DA51.
	     DISPLAY CLEAR-L25.
023780     IF WS-OPTION = "M"
023790         ADD 1             TO WS-LAST
023800         GO TO DA25.
012240     IF WS-OPTION = "A"
012250         PERFORM DA200 THRU DA260
012260         GO TO DA50.
           IF WS-OPTION = "C"
               GO TO DA05.
012270       MOVE ZERO TO WS-TDISC W90-TDISC.
012280     IF W90-LDISC NOT = ZERO
012290         MOVE W90-LDISC TO W90-TDISC
012300         GO TO DA60.
012310       MOVE W90-DB TO W90-DVAL.
             GO TO DA60.
      *
      *     VERSION 6.0  - The following paragraph has been bypassed as
      *                    discount is only allowed per item at this 
      *                    stage.
      *
012320 DA55.
012330       ACCEPT S26-TDSC AT LINE 21.
012340	     DISPLAY (25, 18) WS-CHK
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
012350	     ACCEPT (25, 52) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
012360       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
012410	     DISPLAY CLEAR-L25.
012420     IF WS-OPTION = "N"
012430         GO TO DA55.
012440     IF WS-TDISC = ZERO
012450         GO TO DA60.
012460       COMPUTE W90-TDISC = W90-DVAL * WS-TDISC / 100.
012470       ADD W90-NONTAX W90-TAXVAL GIVING W90-TOTAL.
012480       COMPUTE W90-VALUE ROUNDED = 
                    (W90-TDISC / W90-TOTAL) * W90-TAXVAL.
012490       SUBTRACT W90-VALUE FROM W90-TAXVAL.
012500       SUBTRACT W90-VALUE FROM W90-TDISC GIVING W90-TOTAL.
012510       SUBTRACT W90-TOTAL FROM W90-NONTAX.
012520 DA60.
012530       SUBTRACT W90-TDISC FROM W90-DB GIVING W90-TSELL W90-TOTAL.
012540       MULTIPLY -1 BY W90-TDISC GIVING W15-VAL.
012550       DISPLAY (21, 15) W15-VAL WITH FOREGROUND-COLOR 11.
012560       MOVE ZERO TO W90-TTAX.
024230     IF W90-TAX = SPACES
024240         GO TO DA65.
012590     IF W90-TAXVAL = ZERO
012600         GO TO DA65.
012660 DA65.
012670       MOVE ZERO TO W90-DUE W90-CASH W90-CHQ 
012680                    W90-PMT W90-CARD W90-CHANGE.
012690       MOVE W90-TOTAL TO W15-VAL W90-DUE.
012700       DISPLAY (23, 15) W15-VAL WITH FOREGROUND-COLOR 11.
012710 DA71.
012720       COMPUTE W90-CRD = W90-DUE - W90-PMT.
012730       MOVE W90-CRD TO W100-BAL.
012740       DISPLAY (23, 43) W100-BAL WITH FOREGROUND-COLOR 11.
012750 DA72.
      *
      *    ****    C A S H   V A L U E
      *
012760       ACCEPT S26-CASH.
012770       MOVE W90-CASH TO W90-PMT.
012780     IF W90-PMT NOT < W90-DUE
012790         GO TO DA74.
012800       PERFORM DA71.
012810 DA73.
      *
      *    ****    C H E Q U E   V A L U E
      *
012820       ACCEPT S26-CHQ.
012830       ADD W90-CHQ TO W90-PMT.
012840     IF W90-PMT NOT < W90-DUE
012850         GO TO DA74.
012860       PERFORM DA71.
      *
      *    ****    C R E D I T   C A R D   V A L U E
      *
012870       ACCEPT S26-CARD.
012880       ADD W90-CARD TO W90-PMT.
      *
      *    ****    C H E C K   F O R   S H O R T   P A Y M E N T
      *
012890     IF W90-PMT < W90-DUE
012900         GO TO DA76.
012910 DA74.
      *
      *    ****    A R E   P A Y M E N T   D E T A I L S   C O R R E C T
      *
012920	     DISPLAY CLEAR-L25.
024630*       DISPLAY "C" AT 2512 WITH FOREGROUND-COLOR 14
024640*               "orrect or " WITH FOREGROUND-COLOR 6
024650*               "R" WITH FOREGROUND-COLOR 14
024660*               "ekey payment" WITH FOREGROUND-COLOR 6.
012930	     DISPLAY "Print " AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "1" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " / " WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "2" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " Cash slips or "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "R" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "ekey payment"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
012950 DA75.
012960*       ACCEPT (25, 37) WS-OPTION WITH FOREGROUND-COLOR 15 AUTO.
012960	     ACCEPT WS-OPTION AT 2552
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.

012970       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
013020*     IF NOT (WS-OPTION = "C" OR "R")
013030*         GO TO DA75.
013020     IF NOT (WS-OPTION = "1" OR "2" OR "R")
013030         GO TO DA75.
013040	     DISPLAY CLEAR-L25.
013050     IF WS-OPTION = "R"
013060         GO TO DA65.           
           IF WS-OPTION = "1"
               MOVE "N"          TO WS-DUP
           ELSE
               MOVE "Y"          TO WS-DUP.
           IF W90-CHQ = ZERO
               GO TO DA75B.
010630       MOVE 0              TO W44-FUNCTION.
010640       PERFORM AA12.
010650       MOVE 2              TO W44-FUNCTION.
010660       PERFORM AA13.
             DISPLAY "Name          >                        <" 
                      AT 1033 WITH REVERSE-VIDEO.
             DISPLAY "Telephone No. >              <          "
                      AT 1133 WITH REVERSE-VIDEO.
             DISPLAY "Cheque Date   >        <                "
                      AT 1233 WITH REVERSE-VIDEO.
             MOVE SPACES         TO W10-NAME W10-TEL.
             MOVE W12-TODAY      TO W22-DTE1.
       DA75A.
             ACCEPT S10.
	     DISPLAY CLEAR-L25.
           IF W10-NAME = SPACES OR
              W10-TEL = SPACES OR
              W22-DTE1 = ZERO
               DISPLAY "Require name, telephone and date" AT 2502
			WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
               GO TO DA75A.
             MOVE W22-DTE1       TO W22-DTE3
                                    W10-EDTE.
             PERFORM CHECK-DATE.
             MOVE W20-DTE        TO W22-DTE1.
             MOVE W22-DTE3       TO W20-DTE.
           IF WS-ERROR = 1
               DISPLAY "Invalid date" AT 2302 WITH FOREGROUND-COLOR 14
               GO TO DA75A.
             MOVE 1              TO W44-FUNCTION.
             PERFORM AA12.
             MOVE 3              TO W44-FUNCTION.
             PERFORM AA13.
       DA75B.
013070       COMPUTE W90-CHANGE = W90-PMT - W90-DUE.
013080       MOVE W90-CHANGE TO W15-VAL.
013090       DISPLAY (23, 68) W15-VAL WITH FOREGROUND-COLOR 11.
013100       GO TO DA79.
013110 DA76.
013120       DISPLAY (25, 12) "Short - REKEY Payment - Press ENTER"
013130		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
013140	     ACCEPT (25, 48) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
013150       MOVE 20 TO LIN.
013160 DA78.
013170       DISPLAY (LIN, 68) "           ".
013180     IF LIN < 23
013190         ADD 1 TO LIN
013200         GO TO DA78.
013210       MOVE WS-S9 TO LIN.
013220       GO TO DA65.
013230 DA79.
      *       DISPLAY "Print Invoice " AT 2502 WITH FOREGROUND-COLOR 7
      *               "Y" WITH FOREGROUND-COLOR 14
      *               "/" WITH FOREGROUND-COLOR 7
      *               "N" WITH FOREGROUND-COLOR 14
      *               " > <" WITH FOREGROUND-COLOR 7.
             MOVE "Y"            TO WS-PRNINV.
025310* DA79A.
025320*       ACCEPT WS-PRNINV AT 2521
      *              WITH FOREGROUND-COLOR 15 UPDATE AUTO.
025330*       CALL "_MSUPCASE" USING WS-PRNINV
025340*                        LENGTH WS-PRNINV
025350*                               WS-LENGTH
025360*                        LENGTH WS-LENGTH
025370*                               WS-STATUS.
      *     IF NOT (WS-PRNINV = "Y" OR "N")
      *         GO TO DA79A.
      *
      *    ****    P R O C E S S   T H E   S A L E
      *
013240	     DISPLAY CLEAR-L25.
013250       DISPLAY "Processing Sale" AT 2520 WITH
013260		      BACKGROUND-COLOR 3 FOREGROUND-COLOR 14 BLINK.
013270       MOVE 1              TO WS-SALKEY.
013280       PERFORM AY60 THRU AY999.
013330       MOVE W70-INVOICE    TO W90-REF W15-RECNO.
013290     IF W70-INVOICE = 99999999
013300         MOVE 1            TO W70-INVOICE
013310     ELSE
013320         ADD 1             TO W70-INVOICE.
013340       DISPLAY W90-REF AT 0410 WITH FOREGROUND-COLOR 11.
013350       MOVE "CASH SALE/KONTANT" TO W15-DOCTYP.
      *     IF WS-PRNINV = "N"
      *         GO TO DA80.
013360       MOVE W15-L1A        TO CSH-DATA.
013370       WRITE CSH-L.
013380       MOVE W15-L1         TO CSH-DATA.
013390       WRITE CSH-L.
013400       MOVE W15-L2         TO CSH-DATA.
013410       WRITE CSH-L.
013420       MOVE W15-L3         TO CSH-DATA.
013430       WRITE CSH-L.
           IF W05-VATNO NOT = SPACES
               MOVE W05-VATNO    TO W15-GNO
               MOVE W15-L3A      TO CSH-DATA
               WRITE CSH-L.
	     MOVE WS-PRC	 TO W15-PRC.
013440       MOVE W15-L4         TO CSH-DATA.
013450       WRITE CSH-L.
013460     IF W10-SMAN NOT = ZERO
013470         MOVE W15-L5       TO CSH-DATA
013480         WRITE CSH-L.
013490       MOVE W15-L6         TO CSH-DATA.
013500       WRITE CSH-L.
013510       MOVE SPACE          TO CSH-DATA.
013520       WRITE CSH-L.
013530 DA80.
      *
      *    ****    R E A D   T H E   S A L E   F I L E   A N D
      *            P R I N T   T H E   C A S H   S L I P
      *
013540     IF WS-SALKEY > WS-LAST
013550         GO TO DA95.
013560       PERFORM READ-SALE THRU READ-SALE-EXIT.
013570       MOVE SAL-ITEM       TO STK-CODE.
             PERFORM AY05 THRU AY59.
013590       MOVE SAL-ITEM       TO W15-ITM.
013600       MOVE SAL-DESC       TO W15-DESC.
013610       MOVE SAL-QNT        TO W10-QUANT W15-QUANT.
013620       MOVE SAL-VAL        TO W15-PRICE W25-VALUE.
013630       MOVE SAL-COST       TO W10-COST.
013640       MOVE SAL-SELL       TO W10-SELL.
013650       MOVE SAL-DISC       TO W90-CDISC.
013660       MOVE SAL-DSC        TO WS-DISC.
013670       SUBTRACT W90-CDISC FROM W25-VALUE GIVING W90-VALUE.
             MOVE SAL-SUPER      TO WS-SUPER.
           IF W90-TAX = SPACES
               IF STK-TAX NOT = ZERO
		   MOVE W05-VAT (WS-VAT-SUB)
                                 TO W05-RATE
                   COMPUTE W90-VALUE ROUNDED = W90-VALUE -
                       (((W90-VALUE / (W05-RATE + 100.00000)) * 
                          W05-RATE))
                   COMPUTE W90-EXCDIS ROUNDED = W90-CDISC -
                       (((W90-CDISC / (W05-RATE + 100.00000)) *
                          W05-RATE)).
             ADD W90-VALUE       TO W90-EXCTOT.
           IF WS-PRNINV = "Y"
013680         MOVE W15-L11      TO CSH-DATA
013690         WRITE CSH-L.
      *
      *    ****    U P D A T E   S A L E S   A N A L Y S I S
      *
026950       MOVE STK-LEDG       TO WS-DEPKEY.
026960       PERFORM AY38 THRU AY59.
026970       ADD W90-VALUE       TO DPT-SALES-DAY
026980                              DPT-SALES-MTD
026990                              DPT-SALES-YTD.
           IF WX-INT = "Y"
               MOVE W12-T-YMD    TO WX-DATE
               MOVE STK-LEDG     TO WX-LEDG
               MOVE "CASH SALES" TO WX-NAR
               COMPUTE WX-VALUE = W90-VALUE * -1
               MOVE DPT-SALE-GL  TO WX-AC
               MOVE 04           TO WX-TYPE
               PERFORM GL-TRF-UPDATE.
      *
      *    ****    U P D A T E   C O S T - O F - S A L E S
      *
027160       COMPUTE W90-BCR ROUNDED = (1.000 * W10-QUANT * W10-COST).
027000       ADD W90-BCR         TO DPT-COST-DAY
                                    DPT-COST-MTD
027010                              DPT-COST-YTD.
           IF WX-INT = "Y"
               IF W90-BCR NOT = ZERO
                   MOVE W90-BCR  TO WX-VALUE
                   MOVE DPT-COST-GL
                                 TO WX-AC
                   MOVE 08       TO WX-TYPE
                   PERFORM GL-TRF-UPDATE
                   COMPUTE WX-VALUE = W90-BCR * -1
                   MOVE DPT-PUR-GL
                                 TO WX-AC
                   MOVE 19       TO WX-TYPE
                   PERFORM GL-TRF-UPDATE.
      *
      *    ****    U P D A T E   D I S C O U N T   G I V E N
      *
027020       ADD W90-EXCDIS      TO DPT-DISC-DAY
027030                              DPT-DISC-MTD
027040                              DPT-DISC-YTD
                                    DPT-SALES-DAY
                                    DPT-SALES-MTD
                                    DPT-SALES-YTD.
027050       PERFORM REWRITE-DEPART THRU WRITE-DEPART-EXIT.
013750       MOVE W12-T-YMD      TO STK-ACT.
      *
      *    ****    C H E C K   I F   S T O C K   C O N T R O L L E D    
      *
013760     IF STK-IND > ZERO
013770         GO TO DA85.
013780       SUBTRACT W10-QUANT  FROM STK-QUANT.
013790     IF STK-DISC > ZERO
013800         GO TO DA85.
      *
      *    ****    C H E C K   R E - O R D E R   L E V E L   A N D
      *            R E P O R T   L O W - L E V E L S
      *
013810     IF STK-QUANT NOT > STK-LEVEL
013820         MOVE 1            TO STK-DISC
013830         PERFORM BG80.
013840 DA85.
013860       ADD W90-BCR         TO W90-BDT STK-MTDC STK-YTDC.
013870       ADD W10-QUANT       TO STK-MTD STK-YTD.
013880       ADD W90-VALUE       TO STK-MTDV W90-SALES STK-YTDV.
013950       PERFORM REWRITE-STOCK THRU WRITE-STOCK-EXIT.
013960       MOVE W70-AUDIT      TO WS-AUDKEY.
013970       MOVE LOW-VALUES     TO AUD-REC1.
013980       PERFORM AY16 THRU AY59.
013990       MOVE 6              TO AUD-TYPE.
014000       MOVE WS-DRAW        TO AUD-SUB.
014010       MOVE W90-REF        TO AUD-CSH.
014020       MOVE W10-SMAN       TO AUD-SMAN.
014030       MOVE W90-VALUE      TO AUD-SEL.
014040       MOVE W90-BCR        TO AUD-CST.
014050       MOVE STK-CODE       TO AUD-STOCK.
             MOVE WS-SUPER       TO AUD-SUPER.
014060       PERFORM WRITE-AUDIT THRU WRITE-AUDIT-EXIT.
014070       ADD 1               TO W70-AUDIT.
014080       MOVE 1              TO WS-AUDKEY.
014090       PERFORM READ-AUDIT THRU READ-AUDIT-EXIT.
014100       PERFORM AY16 THRU AY59.
014110       MOVE 1              TO AUD-REP6.
014120       PERFORM REWRITE-AUDIT THRU WRITE-AUDIT-EXIT.
014130     IF W90-CDISC = ZERO
014140         GO TO DA90.
             MOVE SPACES         TO W15-DISCOUNT.
014150       MOVE "DISCOUNT/AFSLAG %" 
                                 TO W15-DISC.
014160       MOVE WS-DISC        TO W15-DSC.
014170       MULTIPLY -1 BY W90-CDISC 
                                 GIVING W15-PRICE.
           IF WS-PRNINV = "Y"
014180         MOVE W15-L11      TO CSH-DATA
014190         WRITE CSH-L.
014200 DA90.
014210       MOVE SPACES         TO CSH-DATA.
014220       ADD 1               TO WS-SALKEY.
014230       GO TO DA80.
014240 DA95.
           IF WS-PRNINV = "Y"
014250         WRITE CSH-L.
014260       MOVE "Sub TOTAL/TOTAAL :" 
                                 TO W15-REMK.
014270       MOVE W90-DB         TO W15-VAL W90-TOTAL.
           IF WS-PRNINV = "Y"
014280         MOVE W15-L13      TO CSH-DATA
014290         WRITE CSH-L.
014300     IF W90-TDISC NOT = ZERO
014310         IF W90-LDISC = ZERO
027690             MOVE 298      TO WS-DEPKEY
027700             PERFORM AY38 THRU AY59
027710             ADD W90-TDISC TO DPT-DISC-DAY
027720                              DPT-DISC-MTD
027730                              DPT-DISC-YTD
                   IF WX-INT = "Y"
                       MOVE W90-EXCDIS
                                 TO WX-VALUE
                       MOVE DPT-DISC-GL
                                 TO WX-AC
                       MOVE 15   TO WX-TYPE
                       PERFORM GL-TRF-UPDATE
                   END-IF
027740             PERFORM REWRITE-DEPART THRU WRITE-DEPART-EXIT.
014370     IF W90-TDISC NOT = ZERO
014380         MOVE "DISCOUNT/AFSLAG  :" 
                                 TO W15-REMK
014390         COMPUTE W15-VAL = W90-TDISC * -1
               IF WS-PRNINV = "Y"
014400             MOVE W15-L13  TO CSH-DATA
014410             WRITE CSH-L.
           IF W90-TAX NOT = SPACES
014440         MOVE "TAX / BELASTING  :" 
                                 TO W15-REMK.
           IF W90-TAX = SPACES
	       MOVE W05-VAT (WS-VAT-SUB)
				 TO W05-RATE
               COMPUTE W90-TTAX ROUNDED = (W90-TAXVAL / 
                  (100.00000 + W05-RATE)) * W05-RATE
               COMPUTE W90-TAXVAL = W90-TAXVAL - W90-TTAX.
014480       MOVE 9              TO WS-PARKEY.
014500       PERFORM AY01 THRU AY59.
027830       MOVE 300            TO WS-DEPKEY.
027840       PERFORM AY38 THRU AY59.
027850       ADD W90-TTAX        TO DPT-SALES-DAY
027860                              DPT-SALES-MTD
027870                              DPT-SALES-YTD.
           IF (WX-INT = "Y") AND (W90-TTAX NOT = ZERO)
                COMPUTE WX-VALUE = W90-TTAX * -1
                MOVE DPT-SALE-GL TO WX-AC
                MOVE 10          TO WX-TYPE
                PERFORM GL-TRF-UPDATE.
027880       PERFORM REWRITE-DEPART THRU WRITE-DEPART-EXIT.
             ADD W90-NONTAX      TO PAR-DNGS-DAY
                                    PAR-DNGS-MTD
                                    PAR-DNGS-YTD.
             ADD W90-TAXVAL      TO PAR-DVAT-DAY
                                    PAR-DVAT-MTD
                                    PAR-DVAT-YTD.
             PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
027890       MOVE W05-RATE       TO WS-PER.
           IF W90-TAX = SPACES
               GO TO DA100.
014450       MOVE W90-TTAX       TO W15-VAL.
           IF WS-PRNINV = "Y"
014460         MOVE W15-L13      TO CSH-DATA
014470         WRITE CSH-L.
014540 DA100.
014550       MOVE W90-BDT        TO W90-TCOST.
             MOVE 2              TO TAX-TYPE.
             MOVE 2              TO TAX-ACTYPE.
             MOVE 01             TO TAX-CODE.
             MOVE W12-T-YMD      TO TAX-DATE.
             MOVE W90-REF        TO TAX-REF.
             MOVE W90-TTAX       TO TAX-VAT.
             MOVE W90-NONTAX     TO TAX-TAXFREE.
             SUBTRACT W90-DISC FROM W90-TOTAL
                                 GIVING TAX-VALUE.
             MOVE ZERO           TO TAX-SEQ
                                    TAX-AC.
	   IF WS-VAT-SUB = 2
	       MOVE TAX-RECORD1	 TO TXP-RECORD1
000890	       PERFORM WRITE-TXPTRN THRU WRITE-TXPTRN-EXIT
000900	       MOVE 1		TO WS-ACTION
000910	       PERFORM AY18 THRU AY59
	   ELSE
	       PERFORM WRITE-TXTRAN THRU WRITE-TXTRAN-EXIT
	       MOVE 1		 TO WS-ACTION
	       PERFORM AY19 THRU AY59.
014560       MOVE "DUE / VERSKULDIG :" 
                                 TO W15-REMK.
014570       SUBTRACT W90-TDISC  FROM W90-TOTAL GIVING W15-VAL.
           IF WS-PRNINV = "N"
               GO TO DA101.
014580       MOVE W15-L13        TO CSH-DATA
014590       WRITE CSH-L.
014600     IF W90-CASH > ZERO
014610         MOVE "CASH/KONTANT REC :" 
                                 TO W15-REMK
014620         MOVE W90-CASH     TO W15-VAL
014630         MOVE W15-L13      TO CSH-DATA
014640         WRITE CSH-L.
014650     IF W90-CHQ > ZERO
014660         MOVE "CHEQUE/TJEK REC  :" 
                                 TO W15-REMK
014670         MOVE W90-CHQ      TO W15-VAL
014680         MOVE W15-L13      TO CSH-DATA
014690         WRITE CSH-L.
014700     IF W90-CARD > ZERO
014710         MOVE "CR-CARD/KT-KAART :"
                                 TO W15-REMK
014720         MOVE W90-CARD     TO W15-VAL
014730         MOVE W15-L13      TO CSH-DATA
014740         WRITE CSH-L.
014750     IF W90-CHANGE > ZERO
014760         MOVE "CHANGE/KLEINGELD :" 
                                 TO W15-REMK
014770         MOVE W90-CHANGE   TO W15-VAL
014780         MOVE W15-L13      TO CSH-DATA
014790         WRITE CSH-L.
       DA101.
014800       PERFORM OPEN-CASH-DRAWER THRU OPEN-CASH-DRAWER-EXIT.
           IF WS-PRNINV = "N"
               GO TO DA106.
014810       MOVE SPACES         TO CSH-DATA.
014820       WRITE CSH-L.
           IF W90-TAX = SPACES
               IF W05-VATNO NOT = SPACES
                   MOVE "VAT Inclusive / BTW Ingesluit"
                                 TO CSH-DATA
                   WRITE CSH-L
                   MOVE SPACES   TO CSH-DATA.
           IF W05-VATNO NOT = SPACES
               MOVE ALL "="      TO CSH-LINE
               WRITE CSH-L
               MOVE SPACES       TO CSH-DATA
               MOVE "   TAX INVOICE"
                                 TO W15-DOCTYP
013360         MOVE W15-L1A      TO CSH-DATA
               WRITE CSH-L
               MOVE SPACES       TO CSH-DATA
               MOVE "TAXABLE/BELASBARE :"
                                 TO W15-REMK
               MOVE W90-TAXVAL   TO W15-VAL
014730         MOVE W15-L13      TO CSH-DATA
014740         WRITE CSH-L
               MOVE "V A T / B T W     :"
                                 TO W15-REMK
               MOVE W90-TTAX     TO W15-VAL
014730         MOVE W15-L13      TO CSH-DATA
014740         WRITE CSH-L
               MOVE ALL "="      TO CSH-LINE
               WRITE CSH-L
               MOVE SPACES       TO CSH-DATA
014790         WRITE CSH-L.
014830       MOVE W15-L9         TO CSH-DATA.
014840       WRITE CSH-L.
014850       MOVE SPACES         TO CSH-DATA.
014860       MOVE 1              TO WS-S9.
014870 DA105.     
014880       WRITE CSH-L.
014890     IF WS-S9 < W85-ADVANCE
014900         ADD 1             TO WS-S9
014910         GO TO DA105.
           IF WS-DUP = "Y"
               PERFORM DA150 THRU DA180.
       DA106.
014920       MOVE W70-AUDIT      TO WS-AUDKEY.
014930       MOVE LOW-VALUES     TO AUD-REC1.
014940       PERFORM AY16 THRU AY59.
014950       MOVE 5              TO AUD-TYPE.
014960       MOVE WS-DRAW TO AUD-SUB.
014970       MOVE W90-REF TO AUD-CSH.
             COMPUTE AUD-SELL = W90-TSELL - W90-TTAX.
014990       MOVE W90-TCOST TO AUD-COST.
015000       MOVE W10-SMAN TO AUD-SMAN.
015010       PERFORM WRITE-AUDIT THRU WRITE-AUDIT-EXIT.
015020       ADD 1 TO W70-AUDIT.
015030       MOVE 1 TO WS-AUDKEY.
015040       PERFORM READ-AUDIT THRU READ-AUDIT-EXIT.
015050       PERFORM AY16 THRU AY59.
015060       MOVE 1 TO AUD-REP5.
015070       PERFORM REWRITE-AUDIT THRU WRITE-AUDIT-EXIT.
015080       MOVE W70-AUDIT TO WS-AUDKEY.
015090       MOVE LOW-VALUES TO AUD-REC1.
015100       PERFORM AY16 THRU AY59.
015110       MOVE 4 TO AUD-TYPE.
015120       MOVE WS-DRAW TO AUD-SUB.
015130       MOVE W10-SMAN TO AUD-AC.
015140       MOVE W90-REF TO AUD-REF.
015150       COMPUTE AUD-VAL = (W90-TOTAL - W90-TDISC).
015160       PERFORM WRITE-AUDIT THRU WRITE-AUDIT-EXIT.
015170       ADD 1 TO W70-AUDIT.
015180       MOVE 1 TO WS-AUDKEY.
015190       PERFORM READ-AUDIT THRU READ-AUDIT-EXIT.
015200       PERFORM AY16 THRU AY59.
015210       MOVE 1 TO AUD-REP4.
015220       PERFORM REWRITE-AUDIT THRU WRITE-AUDIT-EXIT.
015230     IF W10-SMAN NOT = ZERO
015240         ADD 100 W10-SMAN GIVING WS-PARKEY
015260         PERFORM AY01 THRU AY59
015270         ADD W90-TCOST     TO PAR-CT-MTD PAR-CT-YTD
015280         ADD W90-EXCTOT    TO PAR-SL-MTD PAR-SL-YTD
015290         PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
015330       SUBTRACT W90-BAL FROM STK-TOTAL.
015340       ADD W90-SALES TO STK-SMTD STK-SYTD.
015360       ADD 150 WS-DRAW GIVING WS-PARKEY.
015380       PERFORM AY01 THRU AY59.
015390       ADD W90-CASH        TO PAR-CASH.
015400       ADD W90-CHQ         TO PAR-CHEQUES.
015410       ADD W90-CARD        TO PAR-CARDS.
015420       SUBTRACT W90-CHANGE FROM PAR-CASH.
015430       ADD W25-TOTAL       TO PAR-TAXVAL.
             ADD W90-TTAX        TO PAR-VATVAL.
029070       ADD W90-TAXVAL      TO PAR-TAXVAL.
015440       COMPUTE PAR-CSH = PAR-CSH + W90-TAXVAL + W90-NONTAX.
015450       COMPUTE PAR-CSHMTD = PAR-CSHMTD + W90-TAXVAL + W90-NONTAX.
015460       COMPUTE PAR-CSHYTD = PAR-CSHYTD + W90-TAXVAL + W90-NONTAX.
015470       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
015370       MOVE PAR-RECORD151  TO W85-RECORD151.
015480       MOVE 7  TO WS-PARKEY.
015500       PERFORM AY01 THRU AY59.
             COMPUTE PAR-CASH-DAY  = PAR-CASH-DAY + (W90-CASH 
                                     - W90-CHANGE) + W90-CHQ 
                                     + W90-CARD.
             COMPUTE PAR-CASH-MTH  = PAR-CASH-MTH + (W90-CASH 
                                     - W90-CHANGE) + W90-CHQ
                                     + W90-CARD.
             COMPUTE PAR-CASH-YEAR = PAR-CASH-YEAR + (W90-CASH 
                                     - W90-CHANGE) + W90-CHQ 
                                     + W90-CARD.
           IF WX-INT = "Y"
               MOVE W12-T-YMD    TO WX-DATE
               MOVE 01           TO WX-LEDG
               MOVE "CASH SLIPS" TO WX-NAR
               MOVE W90-BDT      TO WX-VALUE
               MOVE PAR-CASH-GL  TO WX-AC
               MOVE 26           TO WX-TYPE
               PERFORM GL-TRF-UPDATE.
             PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
015480       MOVE 8  TO WS-PARKEY.
015500       PERFORM AY01 THRU AY59.
015510       ADD W90-BDT TO PAR-CSHT PAR-CMTD PAR-CYTD.
015520       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
           IF W90-CHQ NOT = ZERO
               INITIALIZE CHQ-RECORD2
               MOVE W90-REF      TO CHQ-TR-NUMBER
               MOVE W22-DTE1     TO CHQ-YMD
               MOVE W20-DTE      TO CHQ-DTE
               MOVE W10-NAME     TO CHQ-NAME
               MOVE W10-TEL      TO CHQ-TEL
               MOVE W90-CHQ      TO CHQ-VALUE
               PERFORM WRITE-CHEQUE THRU WRITE-CHEQUE-EXIT
               MOVE 1            TO WS-ACTION
               PERFORM AY36 THRU AY59.
015530       PERFORM AY70 THRU AY999.
015540       CLOSE PARAM AUDIT STOCK SALE NETWORK DEPART.
028820       OPEN OUTPUT SALE.
028830       CLOSE SALE.
015550       OPEN I-O PARAM AUDIT STOCK SALE NETWORK DEPART.
015570	     DISPLAY CLEAR-L25.
028860	     DISPLAY "ENTER" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " to continue - "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "E" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " to exit"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
028880	     ACCEPT WS-OPTION AT 2542
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
015610       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
015660     IF WS-OPTION = "E"
015670         GO TO DA999.
015680       GO TO DA05.
015690 DA110.
015700       MOVE ZERO TO WS-ERROR.
           IF (WS-PRC = "R") AND (STK-SELL NOT > W10-SPAPRC)
015720         GO TO DA120
           ELSE
           IF (WS-PRC = "C") AND (STK-CASH NOT > W10-SPAPRC)
015720         GO TO DA120
           ELSE
015710     IF STK-WSALE NOT > W10-SPAPRC
015720         GO TO DA120.
015730       COMPUTE W10-MARG = ((W10-SPAPRC - W10-COST) / W10-SPAPRC)
015740                          * 100.00.
015750     IF W10-MARG NOT < W85-MARG
015760         GO TO DA120.
015770       DISPLAY (25, 1) "Margin less than allowed - Override Y/N"
015780			      WITH BACKGROUND-COLOR 3
				   FOREGROUND-COLOR 14.
015790 DA115.
015800	     ACCEPT (25, 41) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
015810       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
015860     IF NOT (WS-OPTION = "N" OR "Y")
015870         GO TO DA115.
015880     IF WS-OPTION = "N"
015890         MOVE 1 TO WS-ERROR
015900         GO TO DA120.
       DA116.
015910       DISPLAY (25, 51) "Enter password >      <"
015920		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
015930       ACCEPT (25, 67) W40-CSHPASS
015940		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15
			 AUTO NO-ECHO.
018300       MOVE 6 TO WS-LENGTH.
018310       CALL "_MSUPCASE" USING W40-CSHPASS
018320                        LENGTH W40-CSHPASS
018330                               WS-LENGTH
018340                        LENGTH WS-LENGTH
018350                               WS-STATUS.
018360       MOVE 1 TO WS-LENGTH.
             MOVE 1              TO WS-SUPER.
       DA117.
018370     IF W40-CSHPASS = W85-SUPER (WS-SUPER) 
               GO TO DA118.
           IF WS-SUPER < 9
               ADD 1             TO WS-SUPER
               GO TO DA117
           ELSE
           IF W40-CSHPASS = "!@#$%^"
               MOVE 10           TO WS-SUPER
           ELSE
018470         MOVE 1            TO WS-ERROR
               MOVE ZERO         TO WS-SUPER.
016050         MOVE 1 TO WS-ERROR.
       DA118.
	     DISPLAY CLEAR-L25.
016060 DA120.
016070       EXIT.
      *
      *    ****    P R I N T   D U P L I C A T E   S L I P
      *
       DA150.
013270       MOVE 1              TO WS-SALKEY.
013330       MOVE W70-INVOICE    TO W90-REF W15-RECNO.
013350       MOVE "DUPLICATE/" TO W15-DOCTYP.
013360       MOVE W15-L1A        TO CSH-DATA.
013370       WRITE CSH-L.
013350       MOVE "     DUPLIKAAT" TO W15-DOCTYP.
013360       MOVE W15-L1A        TO CSH-DATA.
013370       WRITE CSH-L.
013380       MOVE W15-L1         TO CSH-DATA.
013390       WRITE CSH-L.
             MOVE W15-ESC2       TO CSH-ESC.
             MOVE W15-DCAN       TO CSH-CONT.
013440       MOVE W15-L4         TO CSH-DET.
013450       WRITE CSH-L.
013460     IF W10-SMAN NOT = ZERO
013470         MOVE W15-L5       TO CSH-DATA
013480         WRITE CSH-L.
013490       MOVE W15-L6         TO CSH-DATA.
013500       WRITE CSH-L.
013510       MOVE SPACE          TO CSH-DATA.
013520       WRITE CSH-L.
013530 DA155.
013540     IF WS-SALKEY > WS-LAST
013550         GO TO DA170.
013560       PERFORM READ-SALE THRU READ-SALE-EXIT.
             MOVE SPACES         TO W15-DISCOUNT.
013590       MOVE SAL-ITEM       TO W15-ITM.
013600       MOVE SAL-DESC       TO W15-DESC.
013610       MOVE SAL-QNT        TO W10-QUANT W15-QUANT.
013620       MOVE SAL-VAL        TO W15-PRICE W25-VALUE.
013630       MOVE SAL-COST       TO W10-COST.
013640       MOVE SAL-SELL       TO W10-SELL.
013650       MOVE SAL-DISC       TO W90-CDISC.
013660       MOVE SAL-DSC        TO WS-DISC.
013670       SUBTRACT W90-CDISC FROM W25-VALUE GIVING W90-VALUE.
013680       MOVE W15-L11        TO CSH-DATA.
013690       WRITE CSH-L.
013840 DA160.
014130     IF W90-CDISC = ZERO
014140         GO TO DA165.
             MOVE SPACES         TO W15-DISCOUNT.
014150       MOVE "DISCOUNT/AFSLAG %" 
                                 TO W15-DISC.
014160       MOVE WS-DISC        TO W15-DSC.
014170       MULTIPLY -1 BY W90-CDISC 
                                 GIVING W15-PRICE.
014180       MOVE W15-L11        TO CSH-DATA.
014190       WRITE CSH-L.
014200 DA165.
014210       MOVE SPACES         TO CSH-DATA.
014220       ADD 1               TO WS-SALKEY.
014230       GO TO DA155.
014240 DA170.
014250       WRITE CSH-L.
014830       MOVE W15-L9         TO CSH-DATA.
014840       WRITE CSH-L.
014850       MOVE SPACES         TO CSH-DATA.
014860       MOVE 1              TO WS-S9.
014870 DA175.     
014880       WRITE CSH-L.
014890     IF WS-S9 < W85-ADVANCE
014900         ADD 1             TO WS-S9
014910         GO TO DA175.
       DA180.
             EXIT.
      *
      *    ****    A M E N D   S A L E S   D E T A I L S
      *
016080 DA200.
016090       MOVE 7 TO LIN.
016100       PERFORM DA48 UNTIL LIN > 18.
016110       MOVE 7 TO LIN.
016120       MOVE 1 TO WS-LINES WS-FIRST.
016130 DA202.
016140       MOVE WS-FIRST TO WS-SALKEY.
016150 DA205.
016160     IF WS-SALKEY > WS-LAST
016170         GO TO DA210.
016180       PERFORM READ-SALE THRU READ-SALE-EXIT.
016190       DISPLAY (LIN, 2) SAL-CODE WITH FOREGROUND-COLOR 11.
016200       DISPLAY ( , 5) SAL-ITEM WITH FOREGROUND-COLOR 11.
016210       DISPLAY ( , 20) SAL-DESC WITH FOREGROUND-COLOR 11.
016220       MOVE SAL-QNT TO W10-QUANT.
016230       DISPLAY S26-QNT AT LINE LIN.
016240       MOVE SAL-SELL TO W10-SELL.
016250       DISPLAY S26-PRC AT LINE LIN.
016260       MOVE SAL-VAL TO W15-PRICE W100-EXT.
016270       DISPLAY ( , 70) W100-EXT WITH FOREGROUND-COLOR 11.
016280     IF LIN < 18
016290         ADD 1 TO LIN WS-SALKEY WS-LINES
016300         GO TO DA205.
016310 DA210.
016320     IF WS-LINES < 12 
016330         IF WS-FIRST = 1
016340		   DISPLAY (25, 21) "'A'mend, 'D'elete an Item - 'E'xit
016350- 			    "> <"
			    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
016360         ELSE
016370             DISPLAY (25, 1) "'A'mend, 'D'elete an Item - 'P'revio
016380-                            "us screen - 'E'xit > <"
016390			    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
016400             MOVE 2 TO WS-LINES
016410	   ELSE
016420     IF WS-SALKEY < WS-LAST
016430         IF WS-FIRST = 1
016440             DISPLAY (25, 5) "'A'mend, 'D'elete an Item - 'N'ext s
016450-                            "creen - 'E'xit > <"
016460			   WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
016470             MOVE 1 TO WS-LINES
016480         ELSE
016490             DISPLAY (25, 5) "'A'mend, 'D'elete - 'N'ext, 'P'rev s
016500-                            "creen - 'E'xit > <"
016510			    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
016520             MOVE 3 TO WS-LINES
016530     ELSE
016540         MOVE 2 TO WS-LINES
016550         DISPLAY (25, 1) "'A'mend, 'D'elete an Item - 'P'revious s
016560-                        "creen - 'E'xit > <"
016570			WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
016580 DA215.
016590	     ACCEPT (25, 57) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
016600       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
016650     IF NOT (WS-OPTION = "A" OR "D" OR "E" OR "N" OR "P")
016660         GO TO DA215.
016670     IF WS-OPTION = "E"
016680         GO TO DA260.
016690     IF WS-OPTION = "A" OR "D"
016700         GO TO DA225.
016710     IF WS-LINES = 2 OR 3
016720         IF WS-OPTION = "P"
016730             PERFORM DA220
016740		   DISPLAY CLEAR-L25
016750             SUBTRACT 12 FROM WS-FIRST
016760             GO TO DA202.
016770     IF WS-LINES = 1 OR 3
016780         IF WS-OPTION = "N"
016790             PERFORM DA220
016800		   DISPLAY CLEAR-L25
016810             ADD 12 TO WS-FIRST
016820             GO TO DA202.
016830       GO TO DA215.
016840 DA220.
016850       MOVE 7 TO LIN.
016860       PERFORM DA48 UNTIL LIN > 18.
016870       MOVE 7 TO LIN.
016880       MOVE 1 TO WS-LINES.
016890 DA225.
016900     IF WS-OPTION = "A"
016910         GO TO DA235.
016920       DISPLAY (25, 1) "Are you sure Y/N?"
016930		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
016940       MOVE "N" TO WS-OPTION.
016950 DA230.
016960       ACCEPT (25, 19) WS-OPTION
016970		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15
			 UPDATE AUTO.
016980       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
017030     IF NOT (WS-OPTION = "N" OR "Y")
017040         GO TO DA230.              
017050	     DISPLAY CLEAR-L25.
017060     IF WS-OPTION = "N"
017070         GO TO DA215.
017080       MOVE "D" TO WS-OPTION.
017090 DA235.
017100       DISPLAY (25, 1) "Enter item No to Amend/Delete >  <"
017110		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
017120       MOVE ZERO TO WS-INO.
017130 DA240.
017140       ACCEPT (25, 32) WS-INO
017150		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15
			 UPDATE AUTO.
017160     IF WS-INO = ZERO
017170	       DISPLAY CLEAR-L25
017180         GO TO DA215.
017190     IF WS-INO > WS-SALKEY
017200         GO TO DA240.
017210     IF WS-INO < WS-FIRST
017220         GO TO DA240.
017230     IF WS-INO < 13
017240         ADD 6 WS-INO GIVING LIN
017250     ELSE
017260         COMPUTE LIN = WS-INO - WS-FIRST + 7.
017270       MOVE WS-INO TO WS-SALKEY.
017280       PERFORM READ-SALE THRU READ-SALE-EXIT.
017290       MOVE SAL-ITEM TO W10-ITEM STK-CODE.
017310       PERFORM READ-STOCK THRU READ-STOCK-EXIT.
017320       MOVE SAL-QNT TO W10-QUANT.
017330       MOVE SAL-COST TO W10-COST.
017340       MOVE SAL-SELL TO W10-SELL.
017350       MOVE SAL-DISC TO W90-CDISC.
017360       MOVE SAL-DSC TO WS-DISC.
017370       MOVE SAL-VAL TO W25-VALUE.
017380       SUBTRACT W25-VALUE FROM W90-DB.
017390       SUBTRACT W90-CDISC FROM W90-LDISC.
017400       SUBTRACT SAL-NONTAX FROM W90-NONTAX.
017410       SUBTRACT SAL-TAXVAL FROM W90-TAXVAL.
017420     IF (STK-IND < 2) OR (STK-IND = 3)
017430         COMPUTE W90-BAL = W90-BAL - (W10-COST * W10-QUANT).
017440     IF WS-OPTION = "A"
017450         GO TO DA250.
017460       PERFORM DA45B THRU DA45-AA.
017470 DA245.
017480       MOVE WS-SALKEY TO WS-SALSTR.
017490       ADD 1 TO WS-SALKEY.
017500     IF WS-SALKEY > WS-LAST
017510         SUBTRACT 1 FROM WS-LAST
017520         GO TO DA200.
017530       PERFORM READ-SALE THRU READ-SALE-EXIT.
017540       MOVE WS-SALSTR TO WS-SALKEY.
030650       SUBTRACT 1          FROM SAL-CODE.
017550       PERFORM WRITE-SALE THRU WRITE-SALE-EXIT.
017560       ADD 1 TO WS-SALKEY.
017570       GO TO DA245.
017580 DA250.
017590       ACCEPT S26-QNT AT LINE LIN.
017600	     DISPLAY CLEAR-L25.
017610     IF W10-QUANT = ZERO
017620         DISPLAY (25, 1) "Quantity MAY NOT be zero"
017630		       WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
017640         GO TO DA250.
017650       MULTIPLY W10-SELL BY W10-QUANT GIVING W25-VALUE.
017660       MOVE W25-VALUE TO W15-PRICE W100-EXT.
017670       DISPLAY (LIN, 70) W100-EXT WITH FOREGROUND-COLOR 11.
017680	     DISPLAY (25, 18) WS-CHK
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
017690	     ACCEPT (25, 52) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
017700       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
017750	     DISPLAY CLEAR-L25.
017760     IF WS-OPTION = "N"
017770         GO TO DA250.
017780       MOVE W10-QUANT TO SAL-QNT.
017790       MOVE W25-VALUE TO SAL-VAL.
017800     IF WS-DISC = ZERO
017810         GO TO DA255.
017820       COMPUTE W90-CDISC ROUNDED = (W25-VALUE * WS-DISC) / 100.
017830       MOVE W90-CDISC TO W15-PRICE SAL-DISC.
017840 DA255.
017850       PERFORM DA45A THRU DA45-AA.
017860       PERFORM WRITE-SALE THRU WRITE-SALE-EXIT.
017870       GO TO DA200.
017880 DA260.
017890       EXIT.
017900 DA999.
017910       EXIT.
      /
      *    ****    BALANCING REPORT (CASH DRAWER)
      *
017920 EA000                   SECTION 53.
017930 EA00.
046650       DISPLAY CLR-SCREEN.
046660       DISPLAY "CASH DRAW - BALANCING REPORT" AT 0227
046670                WITH FOREGROUND-COLOR 15.
046680       DISPLAY "P" AT 1212 WITH FOREGROUND-COLOR 14
046690               "rinter or " WITH FOREGROUND-COLOR 6
046700               "S" WITH FOREGROUND-COLOR 14
046710               "creen > <" WITH FOREGROUND-COLOR 6.
046720 EA05.
046730       ACCEPT WS-OPTION AT 1231 WITH FOREGROUND-COLOR 15 AUTO.
046740       CALL "_MSUPCASE" USING WS-OPTION
046750                        LENGTH WS-OPTION
046760                               WS-LENGTH
046770                        LENGTH WS-LENGTH
046780                               WS-STATUS.
046790     IF NOT (WS-OPTION = "P" OR "S")
046800         GO TO EA05.
046810     IF WS-OPTION NOT = "P"
046820	       DISPLAY WS-BLNK78 AT 1202 WITH FOREGROUND-COLOR 3
046830         MOVE 3 TO LIN.
018110       MOVE "Cash Drawer - Balancing Report" TO W15-L13.
018120 EA10.
018130     IF WS-OPTION = "P"
018140         MOVE W15-L13 TO CSH-DATA
018150         WRITE CSH-L
018160     ELSE
018170         DISPLAY (LIN, 12) W15-L13 WITH FOREGROUND-COLOR 11
018180         ADD 2 TO LIN.
018190 EA15.
018200       ADD 150 WS-DRAW GIVING WS-PARKEY.
018210       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
018220     IF WS-OPTION = "P"
018230         MOVE W12-TODAY TO W15-DATE
018240         MOVE W15-L4 TO CSH-DATA
018250         WRITE CSH-L.
018260       MOVE "Cash Float" TO W15-REMK.
018270       MOVE PAR-FLOAT TO W15-VAL.
018280       PERFORM EA10.
018290       MOVE "Cash Takings" TO W15-REMK.
018300       MOVE PAR-CASH TO W15-VAL.
018310       PERFORM EA10.
018320       MOVE "Cash in Drawer" TO W15-REMK.
018330       ADD PAR-FLOAT PAR-CASH GIVING W15-VAL.
018340       PERFORM EA10.
018350     IF PAR-CHEQUES NOT = ZERO
018360         MOVE "Cheques" TO W15-REMK
018370         MOVE PAR-CHEQUES TO W15-VAL
018380         PERFORM EA10.
018390     IF PAR-CARDS NOT = ZERO
018400         MOVE "Credit Cards" TO W15-REMK
018410         MOVE PAR-CARDS TO W15-VAL
018420         PERFORM EA10.
018430     IF PAR-RECEIPTS NOT = ZERO
018440         MOVE "Receipts" TO W15-REMK
018450         MOVE PAR-RECEIPTS TO W15-VAL
018460         PERFORM EA10.
018470     IF PAR-TAXVAL NOT = ZERO
018480         MOVE "Tax" TO W15-REMK
018490         MOVE PAR-VATVAL TO W15-VAL
018500         PERFORM EA10.
018510       MOVE "Sales - Today" TO W15-REMK.
018520       MOVE PAR-CSH TO W15-VAL.
018530       PERFORM EA10.
018540       MOVE "      - Month" TO W15-REMK.
018550       MOVE PAR-CSHMTD TO W15-VAL.
018560       PERFORM EA10.
018570       MOVE SPACES TO W15-L13.
018580       PERFORM EA10.
018590       MOVE "TO BE BANKED" TO W15-REMK.
018600       COMPUTE W15-VAL = PAR-CASH + PAR-CHEQUES + PAR-CARDS.
018620       PERFORM EA10.
018630     IF WS-OPTION = "P"
018640         MOVE SPACES TO W15-L13
018650         PERFORM EA10 12 TIMES.
018660     IF WS-OPTION = "S"
018670	       DISPLAY (25, 12) WS-A
		       WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
018680	       ACCEPT (25, 32) WS-OPTION
		       WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
018690 EA999.
018700       EXIT.
      /
      *    ****    ADJUST FLOAT (CASH DRAWER)
      *
018710 FA000                   SECTION 54.
018720 FA00.
047410       DISPLAY CLR-SCREEN.
047420       DISPLAY "ADJUST THE CASH DRAWER FLOAT" AT 0227
047430                WITH FOREGROUND-COLOR 15.
047440       MOVE SPACES         TO W40-CSHPASS.
047450       DISPLAY S05.
047460 FA05.
047470       ACCEPT S06.
047480       MOVE 6              TO WS-LENGTH.
018810       CALL "_MSUPCASE" USING W40-CSHPASS
018820                        LENGTH W40-CSHPASS
018830                               WS-LENGTH
018840                        LENGTH WS-LENGTH
018850                               WS-STATUS.
047540       MOVE 1              TO WS-LENGTH.
047550       MOVE 5              TO WS-PARKEY.
047560       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
047570       MOVE PAR-PW         TO W85-PASS.
018900     IF NOT (W40-CSHPASS = W85-SUPER (1) OR
018910                           W85-SUPER (2) OR
018920                           W85-SUPER (3) OR
018930                           W85-SUPER (4) OR
018940                           W85-SUPER (5) OR
018950                           W85-SUPER (6) OR
018960                           W85-SUPER (7) OR
018970                           W85-SUPER (8) OR
018980                           W85-SUPER (9) OR
018990                           "!@#$%^")
047680         DISPLAY "Invalid password - press any key" AT 1412
047690                  WITH FOREGROUND-COLOR 14
047700         ACCEPT WS-OPTION AT 1445 WITH FOREGROUND-COLOR 15 AUTO
047710         GO TO FA999.
047720       ADD 150 WS-DRAW     GIVING WS-PARKEY.
047730       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
047740       DISPLAY "Cash Float >           <" AT 1212.
019070 FA10.
047760       ACCEPT S29.
047770	     DISPLAY WS-CHK AT 2518
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
047780	     ACCEPT WS-OPTION AT 2552
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
047790       CALL "_MSUPCASE" USING WS-OPTION
047800                        LENGTH WS-OPTION
047810                               WS-LENGTH
047820                        LENGTH WS-LENGTH
047830                               WS-STATUS.
047840	     DISPLAY CLEAR-L25.
047850     IF WS-OPTION = "N"
047860         GO TO FA10.
019200       MOVE PAR-RECORD151 TO W85-RECORD151.
019210       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
019220 FA999.
019230       EXIT.
      /
      *    ****    DAY-END CLEAR (CASH DRAWER)
      *
019240 GA000                   SECTION 55.
019250 GA00.
047930       DISPLAY CLR-SCREEN.
047940       MOVE SPACES         TO W40-CSHPASS.
047950       DISPLAY "DAY, MONTH, YEAR-END CLEAR" AT 0228
047960                        WITH FOREGROUND-COLOR 15.
047970       DISPLAY "D" AT 0812 WITH FOREGROUND-COLOR 11 "ay, "
                     "M" WITH FOREGROUND-COLOR 11 "onth or "
                     "Y" WITH FOREGROUND-COLOR 11 "ear > <".
047980 GA05.
047990       ACCEPT WS-OPTION AT 0832 WITH FOREGROUND-COLOR 15 AUTO.
019340       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
019390     IF NOT (WS-OPTION = "D" OR "M" OR "Y")
019400         GO TO GA05.
019410       DISPLAY S05.
019420       ACCEPT S06.
019430       MOVE 6              TO WS-LENGTH.
019440       CALL "_MSUPCASE" USING W40-CSHPASS
019450                        LENGTH W40-CSHPASS
019460                               WS-LENGTH
019470                        LENGTH WS-LENGTH
019480                               WS-STATUS.
019490       MOVE 1              TO WS-LENGTH.
019500      
019510     IF WS-OPTION = "D"
019520         IF NOT (W40-CSHPASS  = "DAYEND" OR
019530                                W85-SUPER (1) OR
019540                                W85-SUPER (2) OR
019550                                W85-SUPER (3) OR
019560                                W85-SUPER (4) OR
019570                                W85-SUPER (5) OR
019580                                W85-SUPER (6) OR
019590                                W85-SUPER (7) OR
019600                                W85-SUPER (8) OR
019610                                W85-SUPER (9) OR
019620                                "!@#$%^")
048290             DISPLAY "Invalid password - press any key" AT 1412
048300                      WITH FOREGROUND-COLOR 14
048310             ACCEPT WS-OPTION AT 1445
048320                    WITH FOREGROUND-COLOR 15 AUTO
019670             GO TO GA999
019680         ELSE
019690             GO TO GA10.
019700     IF NOT (W40-CSHPASS = W85-SUPER (1) OR
019710                           W85-SUPER (2) OR
019720                           W85-SUPER (3) OR
019730                           W85-SUPER (4) OR
019740                           W85-SUPER (5) OR
019750                           W85-SUPER (6) OR
019760                           W85-SUPER (7) OR
019770                           W85-SUPER (8) OR
019780                           W85-SUPER (9) OR
019790                           "!@#$%^")
048460         DISPLAY "Invalid password - press any key" AT 1412
048470                  WITH FOREGROUND-COLOR 14
048480         ACCEPT WS-OPTION AT 1445 WITH FOREGROUND-COLOR 15 AUTO
019830         GO TO GA999.
019840 GA10.
048510       ADD 150 WS-DRAW     GIVING WS-PARKEY.
048520       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
048530       MOVE ZERO           TO PAR-ADVTAX PAR-CHEQUES
048540                              PAR-VATVAL PAR-CARDS  
                                    PAR-TAXVAL PAR-CASH 
048550                              PAR-CSH    PAR-RECEIPTS. 
048560     IF WS-OPTION NOT = "D"
048570         MOVE ZERO         TO PAR-CSHMTD.
048580     IF WS-OPTION = "Y"
048590         MOVE ZERO         TO PAR-CSHYTD.
019930       MOVE PAR-RECORD151 TO W85-RECORD151.
019940       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
019950 GA999.
019960       EXIT.
      /
      *    ****    CHANGE PASSWORD (CASH DRAWER)
      *
019970 HA000                   SECTION 56.
019980 HA00.
048650       DISPLAY CLR-SCREEN.
             DISPLAY "CHANGE PASSWORD" AT 0233 WITH FOREGROUND-COLOR 15.
048660       MOVE SPACES         TO W40-CSHPASS.
048670       DISPLAY S05.
048680 HA05.
048690       ACCEPT S06.
048700       MOVE 6              TO WS-LENGTH.
048710       CALL "_MSUPCASE" USING W40-CSHPASS
048720                        LENGTH W40-CSHPASS
048730                               WS-LENGTH
048740                        LENGTH WS-LENGTH
048750                               WS-STATUS.
048760       MOVE 1              TO WS-LENGTH.
048770       MOVE 5              TO WS-PARKEY.
048780       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
048790       MOVE PAR-PW         TO W85-PASS.
048800       MOVE 1              TO WS-S1.
048810 HA10.
048820     IF W40-CSHPASS = W85-SUPER (WS-S1)
048830         GO TO HA15.
048840     IF WS-S1 < 9
048850         ADD 1             TO WS-S1
048860         GO TO HA10.
048870       DISPLAY "Invalid password - press any key" AT 1412
048880                WITH FOREGROUND-COLOR 14.
048890       ACCEPT WS-OPTION AT 1445 WITH FOREGROUND-COLOR 15 AUTO.
048900       GO TO HA999.
048910 HA15.
048920	     DISPLAY WS-BLNK78 AT 1402 WITH FOREGROUND-COLOR 3.
048930       DISPLAY "New Password >      <" AT 1412.
048940 HA20.
048950       ACCEPT PAR-SUPER (WS-S1) AT 1426
048960              WITH FOREGROUND-COLOR 11 NO-ECHO AUTO.
048970       MOVE 6              TO WS-LENGTH.
048980       CALL "_MSUPCASE" USING PAR-SUPER (WS-S1)
048990                        LENGTH PAR-SUPER (WS-S1)
049000                               WS-LENGTH
049010                        LENGTH WS-LENGTH
049020                               WS-STATUS.
049030       MOVE 1              TO WS-LENGTH.
049040	     DISPLAY WS-CHK AT 2518
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
049050	     ACCEPT WS-OPTION AT 2552
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
049060       CALL "_MSUPCASE" USING WS-OPTION
049070                        LENGTH WS-OPTION
049080                               WS-LENGTH
049090                        LENGTH WS-LENGTH
049100                               WS-STATUS.
049110	     DISPLAY CLEAR-L25.
049120     IF WS-OPTION = "N"
049130         GO TO HA20.
049140       MOVE PAR-PW         TO W85-PASS.
049150       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
020430 HA999.
020440       EXIT.
      /
      *    ****    INITIALIZE THE CASH DRAWER DETAILS.
      *
018710 IA000                   SECTION 57.
018720 IA00.
018730       DISPLAY CLR-SCREEN.
018740       DISPLAY "INITIALIZE A CASH DRAWER" AT 0219
018750                        WITH FOREGROUND-COLOR 9.
018760       MOVE SPACES         TO W40-CSHPASS.
018770       DISPLAY S05.
018780 IA05.
018790       ACCEPT S06.
018800       MOVE 6              TO WS-LENGTH.
018810       CALL "_MSUPCASE" USING W40-CSHPASS
018820                        LENGTH W40-CSHPASS
018830                               WS-LENGTH
018840                        LENGTH WS-LENGTH
018850                               WS-STATUS.
018860       MOVE 1              TO WS-LENGTH.
018870       MOVE 5              TO WS-PARKEY.
018880       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
018890       MOVE PAR-PW         TO W85-PASS.
018900     IF NOT (W40-CSHPASS = W85-SUPER (1) OR
018910                           W85-SUPER (2) OR
018920                           W85-SUPER (3) OR
018930                           W85-SUPER (4) OR
018940                           W85-SUPER (5) OR
018950                           W85-SUPER (6) OR
018960                           W85-SUPER (7) OR
018970                           W85-SUPER (8) OR
018980                           W85-SUPER (9) OR
018990                           "!@#$%^")
048290         DISPLAY "Invalid password - press any key" AT 1412
048300                  WITH FOREGROUND-COLOR 14
048310         ACCEPT WS-OPTION AT 1445
048320                WITH FOREGROUND-COLOR 15 AUTO
019030         GO TO IA999.
019040       ADD 150 WS-DRAW     GIVING WS-PARKEY.
019050       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
             MOVE ZERO           TO PAR-FLOAT   
                                    PAR-CASH    
                                    PAR-CHEQUES 
                                    PAR-CARDS   
                                    PAR-TAXVAL  
                                    PAR-VATVAL  
                                    PAR-RECEIPTS
                                    PAR-CSH     
                                    PAR-CSHMTD  
                                    PAR-CSHYTD.
047740       DISPLAY "Cash Float >           <" AT 1212.
019070 IA10.
019080       ACCEPT S29.
047770	     DISPLAY WS-CHK AT 2518
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
047780	     ACCEPT WS-OPTION AT 2552
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
019120       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
019170	     DISPLAY CLEAR-L25.
019180     IF WS-OPTION = "N"
019190         GO TO IA10.
019200       MOVE PAR-RECORD151  TO W85-RECORD151.
019210       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
019220 IA999.
019230       EXIT.
      /
009550 JA000                   SECTION 58.
009560 JA00.
018730       DISPLAY CLR-SCREEN.
018740       DISPLAY "PROCESS A CASH REFUND" AT 0230
018750                WITH FOREGROUND-COLOR 15.
018760       MOVE SPACES TO W40-CSHPASS.
018770       DISPLAY S05.
018790       ACCEPT S06.
018800       MOVE 6              TO WS-LENGTH.
018810       CALL "_MSUPCASE" USING W40-CSHPASS
018820                        LENGTH W40-CSHPASS
018830                               WS-LENGTH
018840                        LENGTH WS-LENGTH
018850                               WS-STATUS.
018860       MOVE 1              TO WS-LENGTH.
018870       MOVE 5              TO WS-PARKEY.
018880       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
018890       MOVE PAR-PW         TO W85-PASS.
018900     IF NOT (W40-CSHPASS = W85-SUPER (1) OR
018910                           W85-SUPER (2) OR
018920                           W85-SUPER (3) OR
018930                           W85-SUPER (4) OR
018940                           W85-SUPER (5) OR
018950                           W85-SUPER (6) OR
018960                           W85-SUPER (7) OR
018970                           W85-SUPER (8) OR
018980                           W85-SUPER (9) OR
018990                           "!@#$%^")
048290         DISPLAY "Invalid password - press any key" AT 1412
048300                  WITH FOREGROUND-COLOR 14
048310         ACCEPT WS-OPTION AT 1445
048320                WITH FOREGROUND-COLOR 15 AUTO
019030         GO TO IA999.
009600       ADD 150 WS-DRAW     GIVING WS-PARKEY.
009610       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
009620       MOVE PAR-RECORD151  TO W85-RECORD151.
009630 JA05.
009640       DISPLAY CLR-SCREEN.
009650       DISPLAY S07.
             DISPLAY "CASH REFUND" AT 0234 WITH FOREGROUND-COLOR 15.
	     DISPLAY "Sale Date" AT 0362.
             DISPLAY "  Refund Details -" AT 2035.
             DISPLAY "REFUND DUE" AT 2303.
             DISPLAY "             " AT 2354.
009660       MOVE 7              TO LIN.
009670       PERFORM JA48 UNTIL LIN > 18.
009680       MOVE W85-CSHDTE TO  W90-DTE W15-DATE.
009690       DISPLAY (3, 72) W90-DTE WITH FOREGROUND-COLOR 11.
009700       MOVE ZERO           TO W90-BDT W90-LDISC W90-TAXVAL 
009710                              W90-BAL W10-SMAN  W90-NONTAX
                                    W90-CUR W90-SALES W90-EXCTOT.
009720       MOVE 1              TO WS-FIRST WS-LAST.
009730       MOVE SPACES         TO W90-TAX.
009740       MOVE SPACES         TO CSH-DATA.
009750 JA06.
	     DISPLAY "Key 99 to EXIT" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
009760       ACCEPT W10-SMAN AT 0311
009770              WITH FOREGROUND-COLOR 11 UPDATE AUTO.
           IF W10-SMAN = 99
               GO TO JA999.
009780     IF W10-SMAN > 50
009790         GO TO JA06.
	     DISPLAY CLEAR-L25.
009800     IF W10-SMAN = ZERO
009810	       GO TO JA06A.
009820       ADD 100 W10-SMAN    GIVING WS-PARKEY.
009830       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
009840     IF PAR-SALESMAN = SPACES
009850         GO TO JA06.
009860       DISPLAY PAR-SALESMAN AT 0315 WITH FOREGROUND-COLOR 11.
       JA06A.
	     ACCEPT S26-DATE.
	     MOVE W21-DATE	 TO W10-EDTE.
	     DISPLAY CLEAR-L25.
008400       UNSTRING W10-DATE DELIMITED BY "/" OR " "
008410         INTO W20-DD, W20-MM, W20-YY
008420	       OVERFLOW GO TO JA06C.
008430       MOVE ZERO           TO WS-ERROR.
008440     IF W20-DATE NOT NUMERIC
008450	       GO TO JA06C.
008460	     MOVE W20-DATE	 TO W22-DATE.
008470     IF W20-DAY < 01 OR > 31
008480	       GO TO JA06C.
008490     IF W20-MONTH < 01 OR > 12
008500	       GO TO JA06C.
008510     IF W20-MONTH = 01 OR 03 OR 05 OR 07 OR 08 OR 10 OR 12
008520	       GO TO JA06D.
008530     IF W20-MONTH = 02 AND W20-DAY > 28
008540	       GO TO JA06B.
008550     IF W20-DAY > 30
008560	       GO TO JA06C.
008570	     GO TO JA06D.
      
008580 JA06B.
008590     IF W20-DAY > 29
008600	       GO TO JA06C.
008610       DIVIDE W20-YEAR BY 4 GIVING W25-RESULT.
008620     IF W25-DECIMAL = 0
008630	       GO TO JA06D.
      
008640 JA06C.
008650	     DISPLAY "Invalid date" AT 2502
		      WITH BACKGROUND-COLOR 3
			   FOREGROUND-COLOR 6 HIGHLIGHT.
	     GO TO JA06A.
008660 JA06D.
	   IF W22-DATE < WS-VAT-DATE
	       MOVE 2		 TO WS-VAT-SUB
	   ELSE
	       MOVE 1		 TO WS-VAT-SUB.

009870 JA07.
009880	     DISPLAY (25, 18) WS-CHK
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
009890	     ACCEPT (25, 52) WS-OPTION
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
009900       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
009950     IF WS-OPTION = "N"
009960         GO TO JA06.
009970       MOVE PAR-SALESMAN TO W15-SMAN.
009980	     DISPLAY CLEAR-L25.
010000       MOVE "Y" TO WS-OPTION.
019660	     DISPLAY "Prices to use - " AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
019670		     "R" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
019680		     "etail/account, "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
019690		     "C" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
019700		     "ash or "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
019710		     "W" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
019720		     "holesale > <"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
019740       MOVE "R"            TO WS-PRC.
019770 JA10.
019780	     ACCEPT WS-PRC AT 2563
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15
			 UPDATE AUTO.
019790       CALL "_MSUPCASE" USING WS-PRC
019800                        LENGTH WS-PRC
019810                               WS-LENGTH
019820                        LENGTH WS-LENGTH
019830                               WS-STATUS.
019840     IF NOT (WS-PRC = "C" OR "R" OR "W")
019850         GO TO JA10.
010020*      ACCEPT (25, 32) WS-OPTION
010030*                      WITH UPDATE FOREGROUND-COLOR 15 AUTO.
010040*      CALL "_MSUPCASE" USING WS-OPTION
023170*                       LENGTH WS-OPTION
023180*                              WS-LENGTH
023190*                       LENGTH WS-LENGTH
023200*                              WS-STATUS.
010090*    IF NOT (WS-OPTION = "Y" OR "N")
010100*        GO TO JA10.
010110*      DISPLAY CLEAR-L25.
010120     IF WS-OPTION = "Y"
010130         GO TO JA20.
010140 JA15.
010150*      ACCEPT (3, 39) W90-TAX
010160*                     WITH FOREGROUND-COLOR 11 UPDATE AUTO.
010170*      DISPLAY (25, 18) WS-CHK WITH FOREGROUND-COLOR 14.
010180*      ACCEPT (25, 52) WS-OPTION WITH FOREGROUND-COLOR 15 AUTO.
010190*      CALL "_MSUPCASE" USING WS-OPTION
023170*                       LENGTH WS-OPTION
023180*                              WS-LENGTH
023190*                       LENGTH WS-LENGTH
023200*                              WS-STATUS.
010240*    IF WS-OPTION = "N"
010250*        GO TO JA15.
010260*      DISPLAY CLEAR-L25.
010270 JA20.
010280       MOVE 7              TO LIN.
010290       MOVE ZERO           TO W90-DB.
010300 JA25.
010310       MOVE SPACES         TO W10-DESC W10-ITEM.
010320       MOVE ZERO           TO W10-SELL WS-SUPER.
             MOVE 1              TO W10-QUANT.
010330 JA30.
             PERFORM AA300.
      *
      *    ****    G E T   S T O C K   C O D E
      *
010340       ACCEPT (LIN, 5) W10-ITEM
010350                       WITH FOREGROUND-COLOR 11 UPDATE AUTO.
           IF F1-KEY OR F2-KEY OR F3-KEY OR F4-KEY
               PERFORM AA50
020780         DISPLAY (LIN, 5) W10-ITEM WITH FOREGROUND-COLOR 11
               IF W10-ITEM = SPACES
                   GO TO JA30.
010360     IF W10-ITEM = SPACES
010370         SUBTRACT 1 FROM WS-LAST
010380         GO TO JA49.
       JA31.
             PERFORM CA000.
010400     IF WS-F-ERROR = 22
               MOVE 99           TO W50-KEY
018620         PERFORM AA50
018630         DISPLAY (LIN, 5) W10-ITEM WITH FOREGROUND-COLOR 11
018640         IF W10-ITEM = SPACES
018720             GO TO JA30
               ELSE
                   GO TO JA31.
010430       MOVE WS-LAST TO WS-SALKEY.
010440       INITIALIZE SAL-RECORD1.
010450       MOVE WS-LAST TO SAL-CODE.
      *
      *    ****    I T E M   N U M B E R   O N   C A S H   S L I P
      *
010460       DISPLAY (LIN, 2) WS-LAST WITH FOREGROUND-COLOR 11.
010470       MOVE STK-CODE       TO SAL-ITEM.
010480	     DISPLAY CLEAR-L25.
      *
      *    ****    I S   I T   A   F R E E - F O R M A T   I T E M
      *
010490 JA35.
010500     IF STK-IND = 3
               MOVE ZERO         TO STK-AVGE
010510         ACCEPT (LIN, 20) W10-DESC
010520                          WITH UPDATE FOREGROUND-COLOR 11 AUTO
010530         DISPLAY (25, 12) "Index Unit cost"
010540			WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
010550         ACCEPT S26-AVGE AT LINE 25
010560     ELSE
010570         MOVE STK-DESC TO W10-DESC
010580         DISPLAY (LIN, 20) W10-DESC WITH FOREGROUND-COLOR 11.
021050     IF STK-IND = 3
021060         IF STK-AVGE = ZERO
021070             DISPLAY "Unit cost is zero" AT 2512
021080			    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
                   GO TO JA35.
021100	     DISPLAY CLEAR-L25.
      *
      *    ****    L O G   D E T A I L S   T O   S A L E S   F I L E
      *
010590       MOVE W10-ITEM TO SAL-ITEM.
010600       MOVE W10-DESC TO SAL-DESC.
010610       MOVE STK-AVGE TO SAL-COST W10-COST.
010620       ACCEPT S26-QNT AT LINE LIN.
017720     IF W10-QUANT = ZERO
017730         DISPLAY (LIN, 1) WS-MID-LINE
017740         GO TO JA25.
010630	     DISPLAY CLEAR-L25.
      *
      *    ****    G E T   S E L L I N G   P R I C E   (ACCOUNT OR CASH)
      *
021190     IF STK-IND < 3
021320         IF W90-TAX NOT = SPACES
021330             IF WS-PRC = "R"
021340                 MOVE STK-SELL 
021350                           TO W10-SELL
021360             ELSE
021370             IF WS-PRC = "C"
021380                 MOVE STK-CASH 
021390                           TO W10-SELL
021400             ELSE
021410                 MOVE STK-WSALE 
021420                           TO W10-SELL
021430         ELSE
021440             IF WS-PRC = "R"
021450                 MOVE W10-VSELL 
021460                           TO W10-SELL
021470             ELSE
021480             IF WS-PRC = "C"
021490                 MOVE W10-VCASH 
021500                           TO W10-SELL
021510             ELSE
021520                 MOVE W10-VWSALE 
021530                           TO W10-SELL.
010720 JA35A.
010730       ACCEPT S26-PRC AT LINE LIN.
010740       MOVE W10-SELL TO W10-SPAPRC.
       JA35B.
             MOVE W10-SELL TO SAL-SELL.
011200 JA40.
      *
      *    ****    C A L C U L A T E   E X T E N D E D   V A L U E
      *
011210       MOVE W10-QUANT TO SAL-QNT.
011220       COMPUTE W25-VALUE ROUNDED = (1.000 * W10-SELL * W10-QUANT).
011230       MOVE W25-VALUE TO W15-PRICE SAL-VAL W100-EXT.
011240       DISPLAY (LIN, 70) W100-EXT WITH FOREGROUND-COLOR 11.
      *
      *    ****    L I N E   D I S C O U N T   ( PERCENTAGE )
      *
011250	     DISPLAY (25, 18) "Discount %"
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
011260       MOVE ZERO TO WS-DISC W90-CDISC.
011270 JA42.       
011280       ACCEPT S26-DSC AT LINE 25.
011290     IF WS-DISC = ZERO
011300         GO TO JA45.
011310       COMPUTE W10-SPAPRC ROUNDED = W10-SELL -
011320           (W10-SELL * WS-DISC / 100.00000).
011360       MOVE WS-DISC TO SAL-DSC.
011370       COMPUTE W90-CDISC ROUNDED = ((W25-VALUE * WS-DISC)
                 / 100.00000).
011380       MOVE W90-CDISC TO W15-PRICE SAL-DISC.
011390	     DISPLAY (25, 40) W15-PRICE
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 11.
011400 JA45.
      *
      *    ****    A R E   T H E   D E T A I L S   C O R R E C T
      *
011410	     DISPLAY (25, 18) WS-CHK
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
011420	     ACCEPT (25, 52) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
011430       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
011480     IF WS-OPTION = "N"
011490         GO TO JA30.
011500 JA45A.
      *
      *    ****    A C C U M U L A T E   TOTAL COST / TOTAL DISCOUNT /
      *            VALUES SUBJECT TO TAX AND NON-TAX.
      *
011510     IF (STK-IND < 2) OR (STK-IND = 3)
011520         COMPUTE W90-BAL = W90-BAL + (W10-QUANT * W10-COST).
011530       ADD W90-CDISC TO W90-LDISC.
011540       SUBTRACT W90-CDISC FROM W25-VALUE GIVING W90-VALUE.
           IF STK-TAX = 0
022540         ADD W90-VALUE     TO W90-NONTAX
022550         MOVE W90-VALUE    TO SAL-NONTAX
022560     ELSE
022570         MOVE W90-VALUE    TO SAL-TAXVAL
022580         ADD W90-VALUE     TO W90-TAXVAL.
           IF W90-TAX NOT = SPACES
               COMPUTE SAL-VAT ROUNDED = 
                       SAL-TAXVAL * W05-RATE / 100.
      *
      *    ****    A C C U M U L A T E   T O T A L   R E F U N D
      *
011610       ADD W25-VALUE TO W90-DB.
011620 JA45B.
011630       MOVE W90-DB TO W90-TOTAL.
011640       SUBTRACT W90-LDISC FROM W90-TOTAL.
011650       MOVE W90-DB TO W15-PRICE.
011660       DISPLAY (20, 15) W15-PRICE WITH FOREGROUND-COLOR 11.
011670       MULTIPLY -1 BY W90-LDISC GIVING W15-PRICE.
011680       DISPLAY (21, 15) W15-PRICE WITH FOREGROUND-COLOR 11.
       JA45-AA.
011750       MOVE W90-TOTAL TO W15-VAL.
011760       DISPLAY (23, 15) W15-VAL WITH FOREGROUND-COLOR 11.
011770 JA45C.
011780	     DISPLAY CLEAR-L25.
023170	     DISPLAY "A" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023180		     "ccept, "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
023190		     "C" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023200		     "ancel > <"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
022850	     MOVE "A"		 TO WS-OPTION.
011820 JA46.
      *
      *    ****    M U S T   T H E   L A S T   E N T R Y   B E  
      *            A C C E P T E D.
      *
011830       ACCEPT (25, 28) WS-OPTION
011840		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 11
			 UPDATE AUTO.
011850       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
011900     IF NOT (WS-OPTION = "A" OR "C")
011910         GO TO JA46.
011920	     DISPLAY CLEAR-L25.
011930     IF WS-OPTION = "C"
011940         DISPLAY (LIN, 1) WS-MID-LINE
               PERFORM JA47
               PERFORM JA45B THRU JA45-AA
011950         GO TO JA25.               
             MOVE WS-SUPER       TO SAL-SUPER.
011960       PERFORM WRITE-SALE THRU WRITE-SALE-EXIT.
011970       ADD 1 TO WS-LAST.
011980     IF LIN < 18
011990         ADD 1 TO LIN
012000         GO TO JA25.
012010       MOVE 7 TO LIN.
012020       PERFORM JA48 UNTIL LIN > 18.
012030       MOVE 7 TO LIN.
012040       GO TO JA25.
       JA47.
025340       SUBTRACT W25-VALUE FROM W90-DB.
025350       SUBTRACT W90-CDISC FROM W90-LDISC.
025360       SUBTRACT SAL-NONTAX FROM W90-NONTAX.
025370       SUBTRACT SAL-TAXVAL FROM W90-TAXVAL.
025380     IF (STK-IND < 2) OR (STK-IND = 3)
025390         COMPUTE W90-BAL = W90-BAL - (W10-COST * W10-QUANT).
012050 JA48.
012060       DISPLAY (LIN, 1) WS-MID-LINE.
012070       ADD 1 TO LIN.
012080 JA49.
012090     IF WS-LAST = ZERO
012100         GO TO JA05.
      *
      *    ****    P R O C E S S   T H E   R E F U N D
      *
012110 JA50.
012120	     DISPLAY CLEAR-L25.
023600	     DISPLAY "P" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023610		     "rocess refund, "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
023620		     "A" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023630		     "mend sales, "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
023640		     "C" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023650		     "ancel or "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
023660		     "M" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
023670		     "ore items"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
012150 JA51.
012160	     ACCEPT (25, 62) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
012170       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
012220     IF NOT (WS-OPTION = "P" OR "A" OR "C" or "M")
012230         GO TO JA51.
	     DISPLAY CLEAR-L25.
023780     IF WS-OPTION = "M"
023790         ADD 1             TO WS-LAST
023800         GO TO JA25.
012240     IF WS-OPTION = "A"
012250         PERFORM JA200 THRU JA260
012260         GO TO JA50.
           IF WS-OPTION = "C"
               GO TO JA05.
012270       MOVE ZERO TO WS-TDISC W90-TDISC.
012280     IF W90-LDISC NOT = ZERO
012290         MOVE W90-LDISC TO W90-TDISC
012300         GO TO JA60.
012310       MOVE W90-DB TO W90-DVAL.
             GO TO JA60.
      *
      *     VERSION 6.0  - The following paragraph has been bypassed as
      *                    discount is only allowed per item at this 
      *                    stage.
      *
012320 JA55.
012330       ACCEPT S26-TDSC AT LINE 21.
012340	     DISPLAY (25, 18) WS-CHK
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
012350	     ACCEPT (25, 52) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
012360       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
012410	     DISPLAY CLEAR-L25.
012420     IF WS-OPTION = "N"
012430         GO TO JA55.
012440     IF WS-TDISC = ZERO
012450         GO TO JA60.
012460       COMPUTE W90-TDISC = W90-DVAL * WS-TDISC / 100.
012470       ADD W90-NONTAX W90-TAXVAL GIVING W90-TOTAL.
012480       COMPUTE W90-VALUE ROUNDED = 
                    (W90-TDISC / W90-TOTAL) * W90-TAXVAL.
012490       SUBTRACT W90-VALUE FROM W90-TAXVAL.
012500       SUBTRACT W90-VALUE FROM W90-TDISC GIVING W90-TOTAL.
012510       SUBTRACT W90-TOTAL FROM W90-NONTAX.
012520 JA60.
012530       SUBTRACT W90-TDISC FROM W90-DB GIVING W90-TSELL W90-TOTAL.
012540       MULTIPLY -1 BY W90-TDISC GIVING W15-VAL.
012550       DISPLAY (21, 15) W15-VAL WITH FOREGROUND-COLOR 11.
012560       MOVE ZERO TO W90-TTAX.
012660 JA65.
012670       MOVE ZERO TO W90-DUE W90-CASH W90-CHQ 
012680                    W90-PMT W90-CARD W90-CHANGE.
012690       MOVE W90-TOTAL TO W15-VAL W90-DUE.
012700       DISPLAY (23, 15) W15-VAL WITH FOREGROUND-COLOR 11.
012710 JA71.
012720       COMPUTE W90-CRD = W90-DUE - W90-PMT.
012730       MOVE W90-CRD TO W100-BAL.
012740       DISPLAY (23, 43) W100-BAL WITH FOREGROUND-COLOR 11.
012750 JA72.
      *
      *    ****    C A S H   V A L U E
      *
012760       ACCEPT S26-CASH.
012770       MOVE W90-CASH TO W90-PMT.
012780     IF W90-PMT NOT < W90-DUE
012790         GO TO JA74.
012800       PERFORM JA71.
012810 JA73.
      *
      *    ****    C H E Q U E   V A L U E
      *
012820       ACCEPT S26-CHQ.
012830       ADD W90-CHQ TO W90-PMT.
012840     IF W90-PMT NOT < W90-DUE
012850         GO TO JA74.
012860       PERFORM JA71.
      *
      *    ****    C R E D I T   C A R D   V A L U E
      *
012870       ACCEPT S26-CARD.
012880       ADD W90-CARD TO W90-PMT.
      *
      *    ****    C H E C K   F O R   S H O R T   P A Y M E N T
      *
012890     IF W90-PMT < W90-DUE
012900         GO TO JA76.
012910 JA74.
      *
      *    ****    A R E   P A Y M E N T   D E T A I L S   C O R R E C T
      *
012920	     DISPLAY CLEAR-L25.
           IF W90-PMT NOT = W90-DUE
               DISPLAY "May NOT exceed Refund Amount - Press 'ENTER' "
			AT 2512
			WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
	       ACCEPT WS-OPTION AT 2557
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO
               GO TO JA65.
024630	     DISPLAY "C" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
024640		     "orrect or "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
024650		     "R" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
024660		     "ekey refund"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
012950 JA75.
012960	     ACCEPT (25, 37) WS-OPTION
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
012970       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
013020     IF NOT (WS-OPTION = "C" OR "R")
013030         GO TO JA75.
013040	     DISPLAY CLEAR-L25.
013050     IF WS-OPTION = "R"
013060         GO TO JA65.           
013100       GO TO JA79.
013110 JA76.
	     DISPLAY CLEAR-L25.
013120       DISPLAY (25, 12) "Short - REKEY Refund - Press ENTER"
013130		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
013140	     ACCEPT (25, 48) WS-OPTION
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
013150       MOVE 20 TO LIN.
013160 JA78.
013170       DISPLAY (LIN, 68) "            ".
013180     IF LIN < 23
013190         ADD 1 TO LIN
013200         GO TO JA78.
013210       MOVE WS-S9 TO LIN.
013220       GO TO JA65.
013230 JA79.
      *
      *    ****    P R O C E S S   T H E   S A L E
      *
013240	     DISPLAY CLEAR-L25.
013250       DISPLAY "Processing Refund" AT 2520 WITH
013260		      BACKGROUND-COLOR 3 FOREGROUND-COLOR 14 BLINK.
013270       MOVE 1 TO WS-SALKEY.
013280       PERFORM AY60 THRU AY999.
013330       MOVE W70-INVOICE TO W90-REF W15-CRNO.
013290     IF W70-INVOICE = 99999999
013300         MOVE 1 TO W70-INVOICE
013310     ELSE
013320         ADD 1 TO W70-INVOICE.
013340       DISPLAY (4, 10) W90-REF WITH FOREGROUND-COLOR 11.
013350       MOVE "CASH - REFUND" TO W15-DOCTYP.
013360       MOVE W15-L1A TO CSH-DATA.
013370       WRITE CSH-L.
013380       MOVE W15-L1 TO CSH-DATA.
013390       WRITE CSH-L.
013400       MOVE W15-L2 TO CSH-DATA.
013410       WRITE CSH-L.
013420       MOVE W15-L3 TO CSH-DATA.
013430       WRITE CSH-L.
           IF W05-VATNO NOT = SPACES
               MOVE W05-VATNO    TO W15-GNO
               MOVE W15-L3A      TO CSH-DATA
               WRITE CSH-L.
013440       MOVE W15-L4 TO CSH-DATA.
013450       WRITE CSH-L.
013460     IF W10-SMAN NOT = ZERO
013470         MOVE W15-L5 TO CSH-DATA
013480         WRITE CSH-L.
013490       MOVE W15-L7A TO CSH-DATA.
013500       WRITE CSH-L.
013510       MOVE SPACE TO CSH-DATA.
013520       WRITE CSH-L.
013530 JA80.
      *
      *    ****    R E A D   T H E   S A L E   F I L E   A N D
      *            P R I N T   T H E   C A S H   S L I P
      *
013540     IF WS-SALKEY > WS-LAST
013550         GO TO JA95.
013560       PERFORM READ-SALE THRU READ-SALE-EXIT.
013570       MOVE SAL-ITEM       TO STK-CODE.
             PERFORM AY05 THRU AY59.
013590       MOVE SAL-ITEM       TO W15-ITM.
013600       MOVE SAL-DESC       TO W15-DESC.
013610       MOVE SAL-QNT        TO W10-QUANT W15-QUANT.
013620       MOVE SAL-VAL        TO W15-PRICE W25-VALUE.
013630       MOVE SAL-COST       TO W10-COST.
013640       MOVE SAL-SELL       TO W10-SELL.
013650       MOVE SAL-DISC       TO W90-CDISC.
013660       MOVE SAL-DSC        TO WS-DISC.
013670       ADD W90-CDISC W25-VALUE 
                                 GIVING W90-VALUE.
             MOVE SAL-SUPER      TO WS-SUPER.
           IF W90-TAX = SPACES
               IF STK-TAX NOT = ZERO
		   MOVE W05-VAT (WS-VAT-SUB)
                                 TO W05-RATE
                   COMPUTE W90-VALUE ROUNDED = (W90-VALUE -
                         ((W90-VALUE / (W05-RATE + 100.00000)) * 
                           W05-RATE)) 
                   COMPUTE W90-EXCDIS ROUNDED = (W90-CDISC -
                         ((W90-CDISC / (W05-RATE + 100.00000)) *
                           W05-RATE)).
             ADD W90-VALUE       TO W90-EXCTOT.
013680       MOVE W15-L11 TO CSH-DATA.
013690       WRITE CSH-L.
      *
      *    ****    U P D A T E   S A L E S   A N A L Y S I S
      *
026950       MOVE STK-LEDG       TO WS-DEPKEY.
026960       PERFORM AY38 THRU AY59.
026970       ADD W90-VALUE       TO DPT-RET-DAY
                                    DPT-RET-MTD
026980                              DPT-RET-YTD.
           IF WX-INT = "Y"
               MOVE W12-T-YMD    TO WX-DATE
               MOVE STK-LEDG     TO WX-LEDG
               MOVE "CASH REFUNDS"
                                 TO WX-NAR
               COMPUTE WX-VALUE = W90-VALUE * -1 
               MOVE DPT-SALE-GL  TO WX-AC
               MOVE 05           TO WX-TYPE
               PERFORM GL-TRF-UPDATE.
      *
      *    ****    U P D A T E   C O S T - O F - S A L E S
      *
013850       COMPUTE W90-BCR ROUNDED = (1.000 * W10-QUANT * W10-COST).
013920       ADD W90-BCR         TO DPT-CRET-DAY
                                    DPT-CRET-MTD
                                    DPT-CRET-YTD.
           IF WX-INT = "Y"
               IF W90-BDT NOT = ZERO
                   COMPUTE WX-VALUE = W90-BDT * -1
                   MOVE DPT-COST-GL
                                 TO WX-AC
                   MOVE 09       TO WX-TYPE
                   PERFORM GL-TRF-UPDATE
                   MOVE W90-BDT  TO WX-VALUE 
                   MOVE DPT-PUR-GL
                                 TO WX-AC
                   MOVE 20       TO WX-TYPE
                   PERFORM GL-TRF-UPDATE.
      *
      *    ****    U P D A T E   D I S C O U N T   G I V E N
      *
013930       SUBTRACT W90-EXCDIS FROM DPT-DISC-DAY
                                      DPT-DISC-MTD
                                      DPT-DISC-YTD.
             ADD W90-EXCDIS      TO DPT-RET-DAY
                                    DPT-RET-MTD
                                    DPT-RET-YTD.
013940       PERFORM REWRITE-DEPART THRU WRITE-DEPART-EXIT.
013760     IF STK-IND = ZERO
013780         ADD W10-QUANT TO STK-QUANT.
013840 JA85.
030720     IF STK-YTD NOT < W10-QUANT
030730         SUBTRACT W10-QUANT FROM STK-YTD.
030740     IF STK-MTD NOT < W10-QUANT
030750         SUBTRACT W10-QUANT FROM STK-MTD.
030760     IF STK-YTDV NOT < W90-VALUE
030770         SUBTRACT W90-VALUE FROM STK-YTDV.
030780     IF STK-MTDC NOT < W90-BCR
030790         SUBTRACT W90-BCR FROM STK-MTDC.
030800     IF STK-YTDC NOT < W90-BCR
030810         SUBTRACT W90-BCR FROM STK-YTDC.
030820     IF STK-MTDV NOT < W90-VALUE
030830         SUBTRACT W90-VALUE FROM STK-MTDV.
030840       ADD W90-VALUE       TO W90-SALES.
013950       PERFORM REWRITE-STOCK THRU WRITE-STOCK-EXIT.
013960       MOVE W70-AUDIT      TO WS-AUDKEY.
013970       MOVE LOW-VALUES     TO AUD-REC1.
013980       PERFORM AY16 THRU AY59.
013990       MOVE 6              TO AUD-TYPE.
014000       MOVE WS-DRAW        TO AUD-SUB.
014010       MOVE W90-REF        TO AUD-CSH.
014020       MOVE W10-SMAN       TO AUD-SMAN.
014030       MULTIPLY -1 BY W90-VALUE
                                 GIVING AUD-SEL.
014040       MULTIPLY -1 BY W90-BCR
                                 GIVING AUD-CST.
014050       MOVE STK-CODE       TO AUD-STOCK.
014060       PERFORM WRITE-AUDIT THRU WRITE-AUDIT-EXIT.
014070       ADD 1               TO W70-AUDIT.
014080       MOVE 1              TO WS-AUDKEY.
014090       PERFORM READ-AUDIT THRU READ-AUDIT-EXIT.
014100       PERFORM AY16 THRU AY59.
014110       MOVE 1              TO AUD-REP6.
014120       PERFORM REWRITE-AUDIT THRU WRITE-AUDIT-EXIT.
014130     IF W90-CDISC = ZERO
014140         GO TO JA90.
             MOVE SPACES         TO W15-DISCOUNT.
014150       MOVE "DISCOUNT/AFSLAG %" 
                                 TO W15-DISC.
014160       MOVE WS-DISC        TO W15-DSC.
014170       MULTIPLY -1 BY W90-CDISC 
                                 GIVING W15-PRICE.
014180       MOVE W15-L11        TO CSH-DATA.
014190       WRITE CSH-L.
014200 JA90.
014210       MOVE SPACES         TO CSH-DATA.
014220       ADD 1               TO WS-SALKEY.
014230       GO TO JA80.
014240 JA95.
014250       WRITE CSH-L.
014260       MOVE "Sub TOTAL/TOTAAL :" 
                                 TO W15-REMK.
014270       MOVE W90-DB         TO W15-VAL.
014280       MOVE W15-L13        TO CSH-DATA.
014290       WRITE CSH-L.
014300     IF W90-TDISC NOT = ZERO
014310         IF W90-LDISC = ZERO
014320             MOVE 298 TO WS-DEPKEY
014340             PERFORM AY38 THRU AY59
014350             SUBTRACT W90-TDISC 
                                 FROM DPT-DISC-DAY
                                      DPT-DISC-MTD
                                      DPT-DISC-YTD
                   IF WX-INT = "Y"
                       COMPUTE WX-VALUE = W90-EXCDIS * -1
                       MOVE DPT-DISC-GL  TO WX-AC
                       MOVE 16           TO WX-TYPE
                       PERFORM GL-TRF-UPDATE
                   END-IF
014360             PERFORM REWRITE-DEPART THRU WRITE-DEPART-EXIT.
014370     IF W90-TDISC NOT = ZERO
014380         MOVE "DISCOUNT/AFSLAG  :" TO W15-REMK
014390         COMPUTE W15-VAL = W90-TDISC * -1
014400         MOVE W15-L13 TO CSH-DATA
014410         WRITE CSH-L.
           IF W90-TAX NOT = SPACES
014440         MOVE "TAX / BELASTING  :" 
                                 TO W15-REMK.
           IF W90-TAX = SPACES
040360	       MOVE W05-VAT (WS-VAT-SUB)
040370                           TO W05-RATE
	       COMPUTE W90-TTAX ROUNDED = (W90-TAXVAL /
                  (100.00000 + W05-RATE)) * W05-RATE 
               COMPUTE W90-TAXVAL = W90-TAXVAL - W90-TTAX.
014480       MOVE 9              TO WS-PARKEY.
014500       PERFORM AY01 THRU AY59.
027830       MOVE 300            TO WS-DEPKEY.
027840       PERFORM AY38 THRU AY59.
027850       SUBTRACT W90-TTAX   FROM DPT-RET-DAY
                                      DPT-RET-MTD
027870                                DPT-RET-YTD.
           IF (WX-INT = "Y") AND (W90-TTAX NOT = ZERO)
                COMPUTE WX-VALUE = W90-TTAX * -1
                MOVE DPT-PUR-GL  TO WX-AC
                MOVE 11          TO WX-TYPE
                PERFORM GL-TRF-UPDATE.
027880       PERFORM REWRITE-DEPART THRU WRITE-DEPART-EXIT.
             ADD W90-NONTAX      TO PAR-CNGS-DAY
                                    PAR-CNGS-MTD
                                    PAR-CNGS-YTD.
             ADD W90-TAXVAL      TO PAR-CVAT-DAY
                                    PAR-CVAT-MTD
                                    PAR-CVAT-YTD.
             PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
027890       MOVE W05-RATE       TO WS-PER.
           IF W90-TAX = SPACES
               GO TO JA100.
014450       MOVE W90-TTAX TO W15-VAL.
014460       MOVE W15-L13 TO CSH-DATA.
014470       WRITE CSH-L.
       JA100.
014530       ADD W25-TOTAL W90-DB GIVING W90-TOTAL.
014550       MOVE W90-BDT        TO W90-TCOST.
             MOVE 1              TO TAX-TYPE.
             MOVE 2              TO TAX-ACTYPE.
             MOVE 02             TO TAX-CODE.
             MOVE W12-T-YMD      TO TAX-DATE.
             MOVE W90-REF        TO TAX-REF.
             MULTIPLY -1 BY W90-TTAX
                                 GIVING TAX-VAT.
             MULTIPLY -1 BY W90-NONTAX
                                 GIVING TAX-TAXFREE.
             COMPUTE TAX-VALUE = (W90-TOTAL - W90-DISC) * -1.
             MOVE ZERO           TO TAX-SEQ
                                    TAX-AC.
             PERFORM WRITE-TXTRAN THRU WRITE-TXTRAN-EXIT.
             MOVE 1              TO WS-ACTION.
             PERFORM AY19 THRU AY59.
014560       MOVE "DUE / VERSKULDIG :" TO W15-REMK.
             SUBTRACT W90-TDISC FROM W90-TOTAL GIVING W15-VAL.
014580       MOVE W15-L13 TO CSH-DATA.
014590       WRITE CSH-L.
014600     IF W90-CASH > ZERO
014610         MOVE "CASH/KONTANT REF :" TO W15-REMK
014620         MOVE W90-CASH TO W15-VAL
014630         MOVE W15-L13 TO CSH-DATA
014640         WRITE CSH-L.
014650     IF W90-CHQ > ZERO
014660         MOVE "CHEQUE/TJEK REF  :" TO W15-REMK
014670         MOVE W90-CHQ TO W15-VAL
014680         MOVE W15-L13 TO CSH-DATA
014690         WRITE CSH-L.
014700     IF W90-CARD > ZERO
014710         MOVE "CR-CARD/KT-KAART :" TO W15-REMK
014720         MOVE W90-CARD TO W15-VAL
014730         MOVE W15-L13 TO CSH-DATA
014740         WRITE CSH-L.
014800       PERFORM OPEN-CASH-DRAWER THRU OPEN-CASH-DRAWER-EXIT.
014810       MOVE SPACES TO CSH-DATA.
014820       WRITE CSH-L.
           IF W90-TAX = SPACES
               IF W05-VATNO NOT = SPACES
                   MOVE "VAT Inclusive / BTW Ingesluit"
                                 TO CSH-DATA
                   WRITE CSH-L
                   MOVE SPACES   TO CSH-DATA.
014830       MOVE W15-L9 TO CSH-DATA.
014840       WRITE CSH-L.
014850       MOVE SPACES TO CSH-DATA.
014860       MOVE 1 TO WS-S9.
014870 JA105.     
014880       WRITE CSH-L.
014890     IF WS-S9 < W85-ADVANCE
014900         ADD 1 TO WS-S9
014910         GO TO JA105.
014920       MOVE W70-AUDIT TO WS-AUDKEY.
014930       MOVE LOW-VALUES TO AUD-REC1.
014940       PERFORM AY16 THRU AY59.
014950       MOVE 5 TO AUD-TYPE.
014960       MOVE WS-DRAW TO AUD-SUB.
014970       MOVE W90-REF TO AUD-CSH.
             COMPUTE AUD-SELL = (W90-TSELL - W90-TTAX) * -1.
014990       MULTIPLY -1 BY W90-TCOST GIVING AUD-COST.
015000       MOVE W10-SMAN TO AUD-SMAN.
015010       PERFORM WRITE-AUDIT THRU WRITE-AUDIT-EXIT.
015020       ADD 1 TO W70-AUDIT.
015030       MOVE 1 TO WS-AUDKEY.
015040       PERFORM READ-AUDIT THRU READ-AUDIT-EXIT.
015050       PERFORM AY16 THRU AY59.
015060       MOVE 1 TO AUD-REP5.
015070       PERFORM REWRITE-AUDIT THRU WRITE-AUDIT-EXIT.
015080       MOVE W70-AUDIT TO WS-AUDKEY.
015090       MOVE LOW-VALUES TO AUD-REC1.
015100       PERFORM AY16 THRU AY59.
015110       MOVE 4 TO AUD-TYPE.
015120       MOVE WS-DRAW TO AUD-SUB.
015130       MOVE W10-SMAN TO AUD-AC.
015140       MOVE W90-REF TO AUD-REF.
             COMPUTE AUD-VAL = (W90-TOTAL - W90-TDISC) * -1.
015160       PERFORM WRITE-AUDIT THRU WRITE-AUDIT-EXIT.
015170       ADD 1 TO W70-AUDIT.
015180       MOVE 1 TO WS-AUDKEY.
015190       PERFORM READ-AUDIT THRU READ-AUDIT-EXIT.
015200       PERFORM AY16 THRU AY59.
015210       MOVE 1 TO AUD-REP4.
015220       PERFORM REWRITE-AUDIT THRU WRITE-AUDIT-EXIT.
015230     IF W10-SMAN NOT = ZERO
015240         ADD 100 W10-SMAN GIVING WS-PARKEY
015260         PERFORM AY01 THRU AY59
015270         SUBTRACT W90-TCOST FROM PAR-CT-MTD PAR-CT-YTD
015280         SUBTRACT W90-TSELL FROM PAR-SL-MTD PAR-SL-YTD
015290         PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
015330       ADD W90-BAL TO STK-TOTAL.
015340       SUBTRACT W90-SALES FROM STK-SMTD STK-SYTD.
015360       ADD 150 WS-DRAW GIVING WS-PARKEY.
015380       PERFORM AY01 THRU AY59.
015390       SUBTRACT W90-CASH FROM PAR-CASH.
015400       SUBTRACT W90-CHQ FROM PAR-CHEQUES.
015410       SUBTRACT W90-CARD FROM PAR-CARDS.
015430       SUBTRACT W25-TOTAL FROM PAR-TAXVAL.
             SUBTRACT W90-TTAX  FROM PAR-VATVAL.
015440       COMPUTE PAR-CSH = PAR-CSH - (W90-TAXVAL + W90-NONTAX).
015450       COMPUTE PAR-CSHMTD = PAR-CSHMTD - 
                                 (W90-TAXVAL + W90-NONTAX).
015460       COMPUTE PAR-CSHYTD = PAR-CSHYTD -
                                 (W90-TAXVAL + W90-NONTAX).
015470       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
015370       MOVE PAR-RECORD151 TO W85-RECORD151.
015480       MOVE 7              TO WS-PARKEY.
015500       PERFORM AY01 THRU AY59.
             COMPUTE PAR-CASH-RDAY  = PAR-CASH-RDAY +
                                      W90-CASH + W90-CHQ + W90-CARD.
             COMPUTE PAR-CASH-RMTH  = PAR-CASH-RMTH +
                                      W90-CASH + W90-CHQ + W90-CARD.
             COMPUTE PAR-CASH-RYEAR = PAR-CASH-RYEAR +
                                      W90-CASH + W90-CHQ + W90-CARD.
           IF WX-INT = "Y"
               MOVE W12-T-YMD    TO WX-DATE
               MOVE 01           TO WX-LEDG
               MOVE "CASH REFUND SLIPS"
                                 TO WX-NAR
               COMPUTE WX-VALUE = W90-BDT * -1
               MOVE PAR-CASH-GL  TO WX-AC
               MOVE 29           TO WX-TYPE
               PERFORM GL-TRF-UPDATE.
             PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
015480       MOVE 8              TO WS-PARKEY.
015500       PERFORM AY01 THRU AY59.
015510       SUBTRACT W90-BDT    FROM PAR-CSHT PAR-CMTD PAR-CYTD.
015520       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
015530       PERFORM AY70 THRU AY999.
015540       CLOSE PARAM AUDIT STOCK SALE NETWORK DEPART.
028820       OPEN OUTPUT SALE.
028830       CLOSE SALE.
015550       OPEN I-O PARAM AUDIT STOCK SALE NETWORK DEPART.
015570	     DISPLAY CLEAR-L25.
028860	     DISPLAY "ENTER" AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " to continue"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
028880	     ACCEPT WS-OPTION AT 2530
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
015680       GO TO JA999.
015690 JA110.
015700       MOVE ZERO TO WS-ERROR.
           IF (WS-PRC = "R") AND (STK-SELL NOT > W10-SPAPRC)
015720         GO TO JA120
           ELSE
           IF (WS-PRC = "C") AND (STK-CASH NOT > W10-SPAPRC)
015720         GO TO JA120
           ELSE
015710     IF STK-WSALE NOT > W10-SPAPRC
015720         GO TO JA120.
015730       COMPUTE W10-MARG = ((W10-SPAPRC - W10-COST) / W10-SPAPRC)
015740                          * 100.00.
015750     IF W10-MARG NOT < W85-MARG
015760         GO TO JA120.
015770       DISPLAY (25, 1) "Margin less than allowed - Override Y/N"
015780                        WITH FOREGROUND-COLOR 14.
015790 JA115.
015800       ACCEPT (25, 41) WS-OPTION WITH FOREGROUND-COLOR 15 AUTO.
015810       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
015860     IF NOT (WS-OPTION = "N" OR "Y")
015870         GO TO JA115.
015880     IF WS-OPTION = "N"
015890         MOVE 1 TO WS-ERROR
015900         GO TO JA120.
       JA116.
015910       DISPLAY (25, 51) "Enter password >      <"
015920                        WITH FOREGROUND-COLOR 14.
015930       ACCEPT (25, 67) W40-CSHPASS
015940                       WITH FOREGROUND-COLOR 15 AUTO NO-ECHO.
018300       MOVE 6 TO WS-LENGTH.
018310       CALL "_MSUPCASE" USING W40-CSHPASS
018320                        LENGTH W40-CSHPASS
018330                               WS-LENGTH
018340                        LENGTH WS-LENGTH
018350                               WS-STATUS.
018360       MOVE 1 TO WS-LENGTH.
             MOVE 1              TO WS-SUPER.
       JA117.
018370     IF W40-CSHPASS = W85-SUPER (WS-SUPER) 
               GO TO JA118.
           IF WS-SUPER < 9
               ADD 1             TO WS-SUPER
               GO TO JA117
           ELSE
           IF W40-CSHPASS = "!@#$%^"
               MOVE 10           TO WS-SUPER
           ELSE
018470         MOVE 1            TO WS-ERROR
               MOVE ZERO         TO WS-SUPER.
016050         MOVE 1 TO WS-ERROR.
       JA118.
	     DISPLAY CLEAR-L25.
016060 JA120.
016070       EXIT.
      *
      *    ****    A M E N D   S A L E S   D E T A I L S
      *
016080 JA200.
016090       MOVE 7 TO LIN.
016100       PERFORM JA48 UNTIL LIN > 18.
016110       MOVE 7 TO LIN.
016120       MOVE 1 TO WS-LINES WS-FIRST.
016130 JA202.
016140       MOVE WS-FIRST TO WS-SALKEY.
016150 JA205.
016160     IF WS-SALKEY > WS-LAST
016170         GO TO JA210.
016180       PERFORM READ-SALE THRU READ-SALE-EXIT.
016190       DISPLAY (LIN, 2) SAL-CODE WITH FOREGROUND-COLOR 11.
016200       DISPLAY ( , 5) SAL-ITEM WITH FOREGROUND-COLOR 11.
016210       DISPLAY ( , 20) SAL-DESC WITH FOREGROUND-COLOR 11.
016220       MOVE SAL-QNT TO W10-QUANT.
016230       DISPLAY S26-QNT AT LINE LIN.
016240       MOVE SAL-SELL TO W10-SELL.
016250       DISPLAY S26-PRC AT LINE LIN.
016260       MOVE SAL-VAL TO W15-PRICE W100-EXT.
016270       DISPLAY ( , 70) W100-EXT WITH FOREGROUND-COLOR 11.
016280     IF LIN < 18
016290         ADD 1 TO LIN WS-SALKEY WS-LINES
016300         GO TO JA205.
016310 JA210.
016320     IF WS-LINES < 13 
016330         IF WS-FIRST = 1
016340             DISPLAY (25, 21) "'A'mend, 'D'elete an Item - 'E'xit 
016350-                             "> <" WITH FOREGROUND-COLOR 14
016360         ELSE
016370             DISPLAY (25, 1) "'A'mend, 'D'elete an Item - 'P'revio
016380-                            "us screen - 'E'xit > <"
016390                              WITH FOREGROUND-COLOR 14
016400             MOVE 2 TO WS-LINES
016410     ELSE
016420     IF WS-SALKEY < WS-LAST
016430         IF WS-FIRST = 1
016440             DISPLAY (25, 5) "'A'mend, 'D'elete an Item - 'N'ext s
016450-                            "creen - 'E'xit > <"
016460                              WITH FOREGROUND-COLOR 14
016470             MOVE 1 TO WS-LINES
016480         ELSE
016490             DISPLAY (25, 5) "'A'mend, 'D'elete - 'N'ext, 'P'rev s
016500-                            "creen - 'E'xit > <"
016510                              WITH FOREGROUND-COLOR 14
016520             MOVE 3 TO WS-LINES
016530     ELSE
016540         MOVE 2 TO WS-LINES
016550         DISPLAY (25, 1) "'A'mend, 'D'elete an Item - 'P'revious s
016560-                        "creen - 'E'xit > <"
016570                          WITH FOREGROUND-COLOR 14.
016580 JA215.
016590       ACCEPT (25, 57) WS-OPTION WITH FOREGROUND-COLOR 15 AUTO.
016600       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
016650     IF NOT (WS-OPTION = "A" OR "D" OR "E" OR "N" OR "P")
016660         GO TO JA215.
016670     IF WS-OPTION = "E"
016680         GO TO JA260.
016690     IF WS-OPTION = "A" OR "D"
016700         GO TO JA225.
016710     IF WS-LINES = 2 OR 3
016720         IF WS-OPTION = "P"
016730             PERFORM JA220
016740		   DISPLAY CLEAR-L25
016750             SUBTRACT 12 FROM WS-FIRST
016760             GO TO JA202.
016770     IF WS-LINES = 1 OR 3
016780         IF WS-OPTION = "N"
016790             PERFORM JA220
016800		   DISPLAY CLEAR-L25
016810             ADD 12 TO WS-FIRST
016820             GO TO JA202.
016830       GO TO JA215.
016840 JA220.
016850       MOVE 7 TO LIN.
016860       PERFORM JA48 UNTIL LIN > 18.
016870       MOVE 7 TO LIN.
016880       MOVE 1 TO WS-LINES.
016890 JA225.
016900     IF WS-OPTION = "A"
016910         GO TO JA235.
016920       DISPLAY (25, 1) "Are you sure Y/N?"
016930                        WITH FOREGROUND-COLOR 14.
016940       MOVE "N" TO WS-OPTION.
016950 JA230.
016960       ACCEPT (25, 19) WS-OPTION
016970                       WITH FOREGROUND-COLOR 15 UPDATE AUTO.
016980       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
017030     IF NOT (WS-OPTION = "N" OR "Y")
017040         GO TO JA230.              
017050	     DISPLAY CLEAR-L25.
017060     IF WS-OPTION = "N"
017070         GO TO JA215.
017080       MOVE "D" TO WS-OPTION.
017090 JA235.
017100       DISPLAY (25, 1) "Enter item No to Amend/Delete >  <"
017110                        WITH FOREGROUND-COLOR 14.
017120       MOVE ZERO TO WS-INO.
017130 JA240.
017140       ACCEPT (25, 32) WS-INO
017150                       WITH FOREGROUND-COLOR 15 UPDATE AUTO.
017160     IF WS-INO = ZERO
017170	       DISPLAY CLEAR-L25
017180         GO TO JA215.
017190     IF WS-INO > WS-SALKEY
017200         GO TO JA240.
017210     IF WS-INO < WS-FIRST
017220         GO TO JA240.
017230     IF WS-INO < 13
017240         ADD 6 WS-INO GIVING LIN
017250     ELSE
017260         COMPUTE LIN = WS-INO - WS-FIRST + 7.
017270       MOVE WS-INO TO WS-SALKEY.
017280       PERFORM READ-SALE THRU READ-SALE-EXIT.
017290       MOVE SAL-ITEM TO W10-ITEM.
017300       MOVE SAL-ITEM TO STK-CODE.
017310       PERFORM READ-STOCK THRU READ-STOCK-EXIT.
017320       MOVE SAL-QNT TO W10-QUANT.
017330       MOVE SAL-COST TO W10-COST.
017340       MOVE SAL-SELL TO W10-SELL.
017350       MOVE SAL-DISC TO W90-CDISC.
017360       MOVE SAL-DSC TO WS-DISC.
017370       MOVE SAL-VAL TO W25-VALUE.
017380       SUBTRACT W25-VALUE FROM W90-DB.
017390       SUBTRACT W90-CDISC FROM W90-LDISC.
017400       SUBTRACT SAL-NONTAX FROM W90-NONTAX.
017410       SUBTRACT SAL-TAXVAL FROM W90-TAXVAL.
017420     IF (STK-IND < 2) OR (STK-IND = 3)
017430         COMPUTE W90-BAL = W90-BAL - (W10-COST * W10-QUANT).
017440     IF WS-OPTION = "A"
017450         GO TO JA250.
017460       PERFORM JA45B THRU JA45-AA.
017470 JA245.
017480       MOVE WS-SALKEY TO WS-SALSTR.
017490       ADD 1 TO WS-SALKEY.
017500     IF WS-SALKEY > WS-LAST
017510         SUBTRACT 1 FROM WS-LAST
017520         GO TO JA200.
017530       PERFORM READ-SALE THRU READ-SALE-EXIT.
017540       MOVE WS-SALSTR TO WS-SALKEY.
017550       PERFORM WRITE-SALE THRU WRITE-SALE-EXIT.
017560       ADD 1 TO WS-SALKEY.
017570       GO TO JA245.
017580 JA250.
017590       ACCEPT S26-QNT AT LINE LIN.
017600	     DISPLAY CLEAR-L25.
017610     IF W10-QUANT = ZERO
017620         DISPLAY (25, 1) "Quantity MAY NOT be zero"
017630                          WITH FOREGROUND-COLOR 14
017640         GO TO JA250.
017650       MULTIPLY W10-SELL BY W10-QUANT GIVING W25-VALUE.
017660       MOVE W25-VALUE TO W15-PRICE W100-EXT.
017670       DISPLAY (LIN, 70) W15-PRICE WITH FOREGROUND-COLOR 11.
017680       DISPLAY (25, 18) WS-CHK WITH FOREGROUND-COLOR 14.
017690       ACCEPT (25, 52) WS-OPTION WITH FOREGROUND-COLOR 15 AUTO.
017700       CALL "_MSUPCASE" USING WS-OPTION
023170                        LENGTH WS-OPTION
023180                               WS-LENGTH
023190                        LENGTH WS-LENGTH
023200                               WS-STATUS.
017750	     DISPLAY CLEAR-L25.
017760     IF WS-OPTION = "N"
017770         GO TO JA250.
017780       MOVE W10-QUANT TO SAL-QNT.
017790       MOVE W25-VALUE TO SAL-VAL.
017800     IF WS-DISC = ZERO
017810         GO TO JA255.
017820       COMPUTE W90-CDISC = (W25-VALUE * WS-DISC) / 100.
017830       MOVE W90-CDISC TO W15-PRICE SAL-DISC.
017840 JA255.
017850       PERFORM JA45A THRU JA45-AA.
017860       PERFORM WRITE-SALE THRU WRITE-SALE-EXIT.
017870       GO TO JA200.
017880 JA260.
017890       EXIT.
017900 JA999.
017910       EXIT.
      /
020720 ZA000-INIT              SECTION 90.
020730 ZA000-OPEN.
             PERFORM ZA58 THRU ZA60.
049200	     DISPLAY WS-BLNK78 AT 1202 WITH FOREGROUND-COLOR 3.
020750       DISPLAY "CASH DRAWER PROGRAM" AT 1231
020760                WITH FOREGROUND-COLOR 15.
020770       MOVE ZERO TO WS-LINES.
           IF WS-DRAW = ZERO
               MOVE 40 TO WS-DRAW.
020830       OPEN I-O PARAM.
020840     IF RUNTIME-ERROR
               IF FLE-LOCKED
049280             GO TO ZA200
054340         ELSE
054350         IF FLE-LIMIT
054360             GO TO ZA49.
020860     IF WS-STATUS NOT = "00"
020870         MOVE 15 TO WS-F-ERROR
020880         PERFORM OPEN-ERROR.
020890       MOVE 3 TO WS-PARKEY.
020900       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
049340       MOVE PAR-DISC       TO W02-DSK18 W02-DSK1 
049350                              W02-DSK19 W02-DSK2 
049380                              W02-DSK22 W02-DSK7
049380                              W02-DSK25 W02-DSK32
				    W02-DSK35 W02-DSK36 W02-DSK40.
049400       MOVE PAR-EXT        TO W02-EXT18 W02-EXT1 
049410                              W02-EXT19 W02-EXT2 
049420                              W02-EXT22 W02-EXT7
049420                              W02-EXT25 W02-EXT32
				    W02-EXT35 W02-EXT36 W02-EXT40.
049460       MOVE WS-USER        TO W02-USE18 W02-USE19.
021000       MOVE PAR-PAGE48 TO WS-PAGE48.
021010       MOVE PAR-PAGE66 TO WS-PAGE66.
             MOVE PAR-VAT-REG    TO W05-VATNO.
021020       OPEN OUTPUT RECOVER.
021030       CLOSE RECOVER.
021040       OPEN I-O RECOVER.
040400       OPEN I-O CHEQUE.
040410     IF RUNTIME-ERROR
               IF FLE-LOCKED
040420             GO TO ZA200
               ELSE
               IF FLE-LIMIT
                   GO TO ZA49
               ELSE
               IF IDX-CORRUPT
                   MOVE 36       TO WS-F-ERROR
                   GO TO ZA50.
040430     IF WS-STATUS NOT = "00"
040440         MOVE 36           TO WS-F-ERROR
040450         PERFORM OPEN-ERROR.
021050       OPEN I-O STOCK.
021060     IF RUNTIME-ERROR
               IF FLE-LOCKED
042130             GO TO ZA200
054340         ELSE
054350         IF FLE-LIMIT
054360             GO TO ZA49
               ELSE
               IF IDX-CORRUPT
                   MOVE 22       TO WS-F-ERROR
                   GO TO ZA50.
021080     IF WS-STATUS NOT = "00"
021090         MOVE 22           TO WS-F-ERROR
021100         PERFORM OPEN-ERROR.
044300       OPEN INPUT STKMEM.
044310     IF RUNTIME-ERROR
               IF FLE-LOCKED
040420             GO TO ZA200
               ELSE
               IF FLE-LIMIT
                   GO TO ZA49
               ELSE
               IF IDX-CORRUPT
                   MOVE 25       TO WS-F-ERROR
                   GO TO ZA50.
044330     IF WS-STATUS NOT = "00"
044340         MOVE 25           TO WS-F-ERROR
044350         PERFORM OPEN-ERROR.
021050       OPEN I-O NETWORK.
021060     IF RUNTIME-ERROR
               IF FLE-LOCKED
021070             GO TO ZA200
054340         ELSE
054350         IF FLE-LIMIT
054360             GO TO ZA49.
021080     IF WS-STATUS NOT = "00"
021090         MOVE 2            TO WS-F-ERROR
021100         PERFORM OPEN-ERROR.
021110       OPEN I-O DEPART.
021120     IF RUNTIME-ERROR
               IF FLE-LOCKED
021130             GO TO ZA200
054340         ELSE
054350         IF FLE-LIMIT
054360             GO TO ZA49.
021140     IF WS-STATUS NOT = "00"
021150         MOVE 7 TO WS-F-ERROR
021160         PERFORM OPEN-ERROR.
021230       OPEN I-O AUDIT.
021240     IF RUNTIME-ERROR
               IF FLE-LOCKED
021250             GO TO ZA200
054340         ELSE
054350         IF FLE-LIMIT
054360             GO TO ZA49.
021260     IF WS-STATUS NOT = "00"
021270         MOVE 1 TO WS-F-ERROR
021280         PERFORM OPEN-ERROR.
021290       OPEN OUTPUT SALE.
054310     IF RUNTIME-ERROR
054320         IF FLE-LOCKED
054330             GO TO ZA200
054340         ELSE
054350         IF FLE-LIMIT
054360             GO TO ZA49.
021300     IF WS-STATUS NOT = "00"
021310         MOVE 9 TO WS-ERROR
021320         PERFORM OPEN-ERROR.
044300       OPEN I-O LEDTRF.
           IF WS-STATUS = "05"
               CLOSE LEDTRF
               OPEN OUTPUT LEDTRF
               CLOSE LEDTRF
               OPEN I-O LEDTRF.
044310     IF RUNTIME-ERROR
               IF FLE-LOCKED
040420             GO TO ZA200
               ELSE
               IF FLE-LIMIT
                   GO TO ZA49
               ELSE
               IF IDX-CORRUPT
                   MOVE 40       TO WS-F-ERROR
                   GO TO ZA50.
054240     IF WS-STATUS NOT = "00"
054250         MOVE 40           TO WS-F-ERROR
054260         PERFORM OPEN-ERROR.
021330       CLOSE SALE.
021340       OPEN I-O SALE.
054540	     OPEN I-O TXPTRN.
054550     IF RUNTIME-ERROR
054560         IF FLE-LOCKED
054570             GO TO ZA200
054580         ELSE
054590         IF FLE-LIMIT
054600             GO TO ZA49
054610         ELSE
054620         IF IDX-CORRUPT
054630		   MOVE 35	 TO WS-F-ERROR
054640             GO TO ZA50.
054650     IF WS-STATUS NOT = "00"
054660	       MOVE 35		 TO WS-F-ERROR
054670         PERFORM OPEN-ERROR.
021050	     OPEN I-O TXTRAN.
021060     IF RUNTIME-ERROR
               IF FLE-LOCKED
042130             GO TO ZA200
054340         ELSE
054350         IF FLE-LIMIT
054360             GO TO ZA49
               ELSE
               IF IDX-CORRUPT
                   MOVE 32       TO WS-F-ERROR
                   GO TO ZA50.
021080     IF WS-STATUS NOT = "00"
021090         MOVE 32           TO WS-F-ERROR
021100         PERFORM OPEN-ERROR.
021350       MOVE 5 TO WS-PARKEY.
021370       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
050550       MOVE PAR-VAT-RATES  TO W05-VAT-RATES.
	     MOVE PAR-RATE-DATE	 TO WS-VAT-DATE.
021400       MOVE 1 TO WS-PARKEY.
021410       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
021590     IF PAR-CSHEAD = SPACES
021600         DISPLAY "Setup cash slip headings - press ENTER" AT 1212
021610                  WITH FOREGROUND-COLOR 14
               ACCEPT WS-OPTION AT 1251 WITH AUTO
021620         GO TO ZA205.
021430       MOVE PAR-DMY TO W12-TODAY.
021440       MOVE PAR-YMD TO W12-T-YMD.
             MOVE PAR-CSHEAD     TO W15-COMP W40-NAME.
021660       MOVE PAR-CSHADD     TO W15-ADD.
021670       MOVE PAR-TELEPHONE  TO W15-TEL.
             MOVE 6 TO WS-PARKEY.
             PERFORM READ-PARAM THRU READ-PARAM-EXIT.
             MOVE PAR-WHOLESALE TO WS-WS.
           IF PAR-INTEGRATE NOT = "Y"
               MOVE "N"          TO WX-INT
           ELSE
               MOVE "Y"          TO WX-INT.
             MOVE PAR-DEBGL      TO WX-DEBGL.
             MOVE PAR-CREGL      TO WX-CREGL.
             MOVE PAR-INTGL      TO WX-INTGL.
             MOVE PAR-BNKGL      TO WX-BNKGL.
             MOVE PAR-UNPROF     TO WX-UNPROF.
             MOVE PAR-REDGL      TO WX-REDGL.
             MOVE PAR-ADJGL      TO WX-ADJGL.
             MOVE PAR-RLGL       TO WX-RLGL.
             MOVE PAR-DSGL       TO WX-DSGL.
021490       ADD 150 WS-DRAW GIVING WS-PARKEY.
021500       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
021510       MOVE W12-TODAY TO PAR-CSHDTE
021520       MOVE PAR-RECORD151 TO W85-RECORD151.
021530       PERFORM REWRITE-PARAM THRU WRITE-PARAM-EXIT.
021540       MOVE 5 TO WS-PARKEY.
021550       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
021560       MOVE PAR-PW       TO W85-PASS.
021680       MOVE 32 TO WS-S1.
020780       DISPLAY "Waiting for printer response" AT 1431
020790                WITH FOREGROUND-COLOR 14 BLINK.
021690 ZA05.
021700     IF W40-NCH (WS-S1) = SPACE
021710         SUBTRACT 1 FROM WS-S1
021720         GO TO ZA05.
021730     IF WS-S1 > 16
021740         MOVE W85-NUL TO W15-EXPP1 W15-ECAN1
021750     ELSE
021760         MOVE W85-SO TO W15-EXPP1
021770         MOVE W85-CSO TO W15-ECAN1.
021780       MOVE W85-ESC TO W15-ESC1 W15-ESC2 W15-ESC3
021790                       W15-ESC4 W15-ESC5.
021800       MOVE W85-SO TO W15-EXPP2 W15-EXPP4.
021810       MOVE W85-CSO TO W15-ECAN2 W15-ECAN4.
021820       MOVE W85-DBL TO W15-DBLE W15-DBLE2 W15-DBLE3.
021830       MOVE W85-CDBL TO W15-DCAN W15-DCAN2.
021840       MOVE W85-SI TO W15-COND1.
021850       MOVE W85-CSI TO W15-NORM1.
           IF W85-CPRN = 1
               MOVE "LPT1" TO W02-PRINTER
           ELSE
           IF W85-CPRN = 2
               MOVE "LPT2" TO W02-PRINTER
           ELSE
           IF W85-CPRN = 3
               MOVE "LPT3" TO W02-PRINTER
           ELSE
           IF W85-CPRN = 4
               MOVE "COM1" TO W02-PRINTER
           ELSE
           IF W85-CPRN = 5
               MOVE "COM2" TO W02-PRINTER
           ELSE
           IF W85-CPRN = 9
               MOVE "CSH001.PRN" TO W02-PRINTER.
             OPEN OUTPUT CSHSLE.
      *
      *     O L D   S T Y L E   C A S H   D R A W E R
      *
           IF W85-DRAWER  = "F"
               IF W85-PORT = 2
                   MOVE "COM2"   TO W02-CSHDRW
               ELSE
               IF W85-PORT = 3
                   MOVE "COM3"   TO W02-CSHDRW
               ELSE
               IF W85-PORT = 4
                   MOVE "COM4"   TO W02-CSHDRW.
           IF W85-DRAWER = "F"
               OPEN OUTPUT CSHDRW
               MOVE ALL "A"  TO CSH-OPEN.
             GO TO ZA999.
055270 ZA49.
055280       DISPLAY "Too many files OPEN" AT 0812
055290                WITH FOREGROUND-COLOR 14.
055300       DISPLAY "Check the FILES option in CONFIG.SYS" AT 1012.
055310       DISPLAY "Press any key to continue" AT 1212.
055320       ACCEPT WS-OPTION AT 1238 WITH FOREGROUND-COLOR 15.
055330       GO TO ZA205.
       ZA50.
041850     IF WS-F-ERROR = 22
041860         MOVE "STOCK file" TO WS-FILE
           ELSE
           IF WS-F-ERROR = 25
               MOVE "STOCK MEMO" TO WS-FILE
041840     ELSE
041850	   IF WS-F-ERROR = 32 OR 35
041860         MOVE "TAX file"   TO WS-FILE
           ELSE
041850     IF WS-F-ERROR = 36
041860         MOVE "PD CHEQUE file"
                                 TO WS-FILE
           ELSE
041850     IF WS-F-ERROR = 40
041860         MOVE "INTEGRATION"
                                 TO WS-FILE.
             DISPLAY "Rebuild " AT 0812
                      WS-FILE WITH FOREGROUND-COLOR 14.
             DISPLAY "Press any key to continue" AT 1012.
             ACCEPT WS-OPTION AT 1038 WITH FOREGROUND-COLOR 15.
       ZA51.
             EXIT PROGRAM.
      *
      *    ****    S E T U P   T H E   S C R E E N   G R A P H I C S
      *
       ZA58.
051090       MOVE 1 TO WS-S1.
051100       MOVE SPACES TO WS-MID-LINE WS-MID-LNE WS-MID-LNE2.
051110 ZA60.
051120       MOVE WS-G1          TO WS-TCHAR (WS-S1) WS-BCHAR (WS-S1).
051130       MOVE WS-G1          TO WS-TCHR (WS-S1)  WS-BCHR (WS-S1).
051140       MOVE WS-G1          TO WS-TCH (WS-S1)   WS-BCH (WS-S1).
051150       MOVE WS-G8          TO WS-TCR (WS-S1)   WS-BCR (WS-S1).
051160     IF WS-S1 < 80
051170         ADD 1 TO WS-S1
051180         GO TO ZA60.
051190       MOVE WS-G9          TO WS-TCR   (1).
051200       MOVE WS-G10         TO WS-TCR   (80).
051210       MOVE WS-G11         TO WS-BCR   (1).
051220       MOVE WS-G12         TO WS-BCR   (80).
051230       MOVE WS-G14         TO WS-TCHAR (1)  WS-BCHAR (1)
051240                              WS-TCHR  (1)  WS-BCHR  (1)
051250                              WS-TCH   (1)  WS-BCH   (1).
051260       MOVE WS-G13         TO WS-TCHAR (80) WS-BCHAR (80)
051270                              WS-TCHR  (80) WS-BCHR  (80)
051280                              WS-TCH   (80) WS-BCH   (80).
051290       MOVE WS-G2          TO WS-TCHAR (4)  WS-TCHAR (19)
051300                              WS-TCHAR (50) WS-TCHAR (59) 
051310                              WS-TCHAR (69)
051320                              WS-TCHR  (18) WS-TCHR  (49)
051330                              WS-TCHR  (60) WS-TCHR  (70)
051340                              WS-TCH   (7)  WS-TCH   (48)
051350                              WS-TCH   (60) WS-TCH   (72).
051360       MOVE WS-G3          TO WS-MCHAR (4)  WS-MCHAR (19) 
051370                              WS-MCHAR (50) WS-MCHAR (59) 
051380                              WS-MCHAR (69) WS-MCHAR (80)
                                    WS-MCHAR (1)
051390                              WS-MCH   (7)  WS-MCH   (48)
051400                              WS-MCH   (60) WS-MCH   (72)
051410                              WS-MCR   (1)  WS-MCR   (80)
051420                              WS-MCHR  (18) WS-MCHR  (49)
051430                              WS-MCHR  (60) WS-MCHR  (70)
051440                              WS-MCHR  (1)  WS-MCHR  (80) 
051450                              WS-MCH   (1)  WS-MCH   (80).
051460       MOVE WS-G4          TO WS-BCHAR (4)  WS-BCHAR (19) 
051470                              WS-BCHAR (50) WS-BCHAR (59) 
051480                              WS-BCHAR (69)
051490                              WS-BCHR  (18) WS-BCHR  (49)
051500                              WS-BCHR  (60) WS-BCHR  (70)
051510                              WS-BCH   (7)  WS-BCH   (48)
051520                              WS-BCH   (60) WS-BCH   (72).
             MOVE WS-COMPANY     TO WS-TOP-COMP.
             MOVE 44             TO W50-NUMBER.
             MOVE 1              TO W50-SETTING.
             CALL X"AF" USING W50-BIT-PAIRS W50-PARAMETERS.
022010 ZA200.
022020       DISPLAY "Files locked - Try later" AT 2312
022030                WITH FOREGROUND-COLOR 14
                     " " WS-STATUS WITH FOREGROUND-COLOR 15.
022040       DISPLAY "Press any key" AT 2512 
022050		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
022060	     ACCEPT WS-OPTION AT 2526
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.
       ZA205.
             EXIT PROGRAM.
022090 ZA999.
022100       EXIT.
      /
022110 ZB000-ERROR           SECTION 90.

051650 OPEN-ERROR.
051660       DISPLAY CLR-SCREEN.
051670       DISPLAY "Open error" AT 0812 WITH FOREGROUND-COLOR 14.
051680       PERFORM DISPLAY-FILE-NAME.
051690
051700 READ-ERROR.
051710       DISPLAY CLR-SCREEN.
051720       DISPLAY "Read error" AT 0812 WITH FOREGROUND-COLOR 14.
051730       PERFORM DISPLAY-FILE-NAME.
051740
051750 WRITE-ERROR.
051760       DISPLAY CLR-SCREEN.
051770       DISPLAY "Write error" AT 0812 WITH FOREGROUND-COLOR 14.
051730       PERFORM DISPLAY-FILE-NAME.
051780

051790 DISPLAY-FILE-NAME.
051800     IF WS-F-ERROR = 1
051810         MOVE W02-AUDITF TO WS-FILE
051820         MOVE WS-AUDKEY TO WS-KEY
051830     ELSE
051840     IF WS-F-ERROR = 2
051850         MOVE W02-NETWORK TO WS-FILE
051860         MOVE WS-NETKEY TO WS-KEY
051950     ELSE
051960     IF WS-F-ERROR = 7
051970         MOVE W02-DEPART TO WS-FILE
051980         MOVE WS-DEPKEY TO WS-KEY
051990*     ELSE
052000*     IF WS-F-ERROR = 9
052010*         MOVE W02-GARTEE TO WS-FILE
      *         MOVE ZERO         TO WS-KEY
      *         MOVE GUA-KEY      TO WS-KEYX
052070     ELSE
052080     IF WS-F-ERROR = 15
052090         MOVE WS-PARID     TO WS-FILE
052100         MOVE WS-PARKEY    TO WS-KEY
052110     ELSE
052120     IF WS-F-ERROR = 18
052130         MOVE W02-RECOVER  TO WS-FILE
052140         MOVE WS-RECKEY    TO WS-KEY
052150     ELSE
052160     IF WS-F-ERROR = 19
052170         MOVE W02-SALE TO WS-FILE
052180         MOVE WS-SALKEY TO WS-KEY
052190     ELSE
052200     IF WS-F-ERROR = 22
052210         MOVE W02-STOCKF   TO WS-FILE
052220         MOVE ZERO         TO WS-KEY
               MOVE STK-CODE     TO WS-KEYX
041840     ELSE
041850     IF WS-F-ERROR = 25
041860         MOVE W02-STKMEM   TO WS-FILE
041870         MOVE ZERO         TO WS-KEY
               MOVE SME-KEY      TO WS-KEYX
052270     ELSE
052280     IF WS-F-ERROR = 32
052290         MOVE W02-TXTRAN   TO WS-FILE
052300         MOVE ZERO         TO WS-KEY
               MOVE TAX-KEY      TO WS-KEYX
041840     ELSE
041850	   IF WS-F-ERROR = 35
041860	       MOVE W02-TXPTRN	 TO WS-FILE
041870         MOVE ZERO         TO WS-KEY
	       MOVE TXP-KEY	 TO WS-KEYX
041840	   ELSE
041850	   IF WS-F-ERROR = 36
041860         MOVE W02-CHEQUE   TO WS-FILE
041870         MOVE ZERO         TO WS-KEY
               MOVE CHQ-TR-NUMBER
                                 TO WS-KEYX
041840     ELSE
041850     IF WS-F-ERROR = 40
041860         MOVE W02-LEDTRF   TO WS-FILE
041870         MOVE ZERO         TO WS-KEY
               MOVE XFR-KEY      TO WS-KEYX.
052310     IF WS-STATUS = "10"
052320         MOVE "End of FILE" TO WS-STAT-MESSAGE
052330     ELSE
052340     IF WS-STATUS = "22"
052350         MOVE "Duplicate record number" TO WS-STAT-MESSAGE
052360     ELSE
052370     IF WS-STATUS = "23"
052380         MOVE "Invalid record number" TO WS-STAT-MESSAGE
052390     ELSE
052400     IF WS-STATUS = "24"
052410         MOVE "DISK full" TO WS-STAT-MESSAGE
052420     ELSE
052430     IF WS-STATUS = "30"
052440         MOVE "DISK error" TO WS-STAT-MESSAGE
052450     ELSE
052460     IF WS-STATUS = "94"
052470         MOVE "FILE locked" TO WS-STAT-MESSAGE.
052480       DISPLAY "File - " AT 1012 WS-FILE WITH FOREGROUND-COLOR 11.
052490       DISPLAY "Status " AT 1212 
052500                WS-STATUS WITH FOREGROUND-COLOR 11
052510               ": " WS-STAT-MESSAGE WITH FOREGROUND-COLOR 14.
052520     IF WS-STATUS NOT = "94" 
052530         DISPLAY "Key    " AT 1412 
052540                  WS-KEY WITH FOREGROUND-COLOR 11
                        " " WS-KEYX WITH FOREGROUND-COLOR 11
052550         DISPLAY "Reverse backup or contact program Support"
052560                  AT 1612.
052570         DISPLAY "Please make a note of these details" AT 1812.
052580       STOP RUN.
