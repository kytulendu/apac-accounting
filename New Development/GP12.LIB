      /
      *    ****    P U R C H A S E   H I S T O R Y   L O O K U P
      *
000010 G-PROF12-LOOKUP		 SECTION 53.

000030 GP12-LUP-SCREEN.
000050	     DISPLAY S-GP12.
	     INITIALIZE DHS-REC1.
	   IF WS-ENQ = "S"
	       MOVE W10-EXT-ITEM TO DHS-EXT-CODE.
	     MOVE W80-ACNO	 TO DHS-AC.

       GP12-LUP-CLR-SCREEN.
000060       MOVE 0601           TO CPOS.
000080	     PERFORM GP12-CRT-EDGE UNTIL CLIN = 22.

       GP12-LUP-CONTINUE.
000180	     MOVE 6		 TO CLIN.
000200       MOVE 1              TO W75-S W75-S1.

       GP12-LUP-TAB-LOOP.
	     MOVE ZERO		 TO W75-QNT(W75-S1, W75-S).
	   IF W75-S < 12
	       ADD 1		 TO W75-S
	       GO TO GP12-LUP-TAB-LOOP.
	     MOVE SPACES	 TO W75-ITEM(W75-S1)
				    W75-DESC(W75-S1).
	   IF W75-S1 < 16
               ADD 1             TO W75-S1
	       MOVE 1		 TO W75-S
	       GO TO GP12-LUP-TAB-LOOP.
	     MOVE ZERO		 TO W75-S1.
	     MOVE 1		 TO W75-S.

       GP12-LUP-START-DBTX.
	     MOVE SPACES	 TO WS-OPTION.
	     PERFORM START-AT-DBHS-AC THRU READ-DEBHIS-EXIT.
000880	   IF WS-F-ERROR = 54
	       GO TO GP12-NO-RECORD.

000810 GP12-GET-DEBHIS-REC.
           IF WS-OPTION = "J"
               MOVE SPACE        TO WS-OPTION
	       GO TO GP12-SKIP-DBTX-READ.
000840	     PERFORM READ-DEBHIS-NEXT THRU READ-DEBHIS-EXIT.
	   IF WS-F-ERROR = 54
               SUBTRACT 1        FROM W75-S
	       GO TO GP12-FULL-SCREEN.

       GP12-LUP-DISP-ITEM.
	   IF NOT (DHS-AC = DEB-ACNO)
	       GO TO GP12-FULL-SCREEN.
	   IF (WS-ENQ = "S") AND
	      (W10-EXT-ITEM NOT = DHS-EXT-CODE)
	       GO TO GP12-FULL-SCREEN.

       GP12-SKIP-DBTX-READ.
	     MOVE 1	       TO W75-S1.
	     MOVE DHS-START-MNTH
			       TO W75-S2.

       GP12-STORE-GP-LOOP.
	     COMPUTE W75-QNT(W75-S, W75-S1) = ((DHS-TSELL(W75-S2)
		   - DHS-TCOST(W75-S2)) / DHS-TSELL(W75-S2)) * 100.
	     MOVE DHS-QNT(W75-S2)
			       TO W75-QNT(W75-S, W75-S1).
	   IF W75-S1 < 12
	       ADD 1	       TO W75-S1 W75-S2
	       IF W75-S2 > 12
		   SUBTRACT 12 FROM W75-S2
	       END-IF
	       GO TO GP12-STORE-GP-LOOP.
	     MOVE DHS-EXT-CODE TO W75-ITEM(W75-S).
	     MOVE DHS-DESC     TO W75-DESC(W75-S).
000890	     DISPLAY (CLIN, 2) DHS-EXT-CODE
		      WITH FOREGROUND-COLOR 3 HIGHLIGHT.
	     DISPLAY ( , 21) DHS-DESC
		      WITH FOREGROUND-COLOR 3 HIGHLIGHT.
	     MOVE 53	       TO CCOL.
	   IF WS-VIEW = "F"
	       MOVE 1	       TO W75-S1 W75-S2
	   ELSE
	   IF WS-VIEW = "C"
	       MOVE 9	       TO W75-S1
	       MOVE 1	       TO W75-S2
	   ELSE
	       MOVE 5	       TO W75-S1
	       MOVE 1	       TO W75-S2.
	     PERFORM GP12-DISPLAY-4-GP.
000970	   IF CLIN < 21
000980         ADD 1             TO CLIN W75-S
000990	       GO TO GP12-GET-DEBHIS-REC.
001000
001010 GP12-FULL-SCREEN.
	     DISPLAY WS-BLNK78 AT 2302 WITH FOREGROUND-COLOR 3.
001020	     DISPLAY "" AT 2303 WITH FOREGROUND-COLOR 14
		     X"1B1A" WITH FOREGROUND-COLOR 14
001030		     " - " WITH FOREGROUND-COLOR 7
		     "PgUp" WITH FOREGROUND-COLOR 14
                     "/" WITH FOREGROUND-COLOR 7
		     "PgDn" WITH FOREGROUND-COLOR 14
		     " - " WITH FOREGROUND-COLOR 7
		     "F" WITH FOREGROUND-COLOR 14
		     "irst," WITH FOREGROUND-COLOR 7
		     "M" WITH FOREGROUND-COLOR 14
		     "iddle," WITH FOREGROUND-COLOR 7
		     "C" WITH FOREGROUND-COLOR 14
		     "urrent four months - " WITH FOREGROUND-COLOR 7
001170		     "Esc" WITH FOREGROUND-COLOR 14
		     "ape." WITH FOREGROUND-COLOR 7.

       GP12-SAVE-FULL-SCREEN.
	     PERFORM SAVE-SCREEN-2.
001140	     MOVE 0		 TO W75-S1.
001150       MOVE 0601           TO CPOS.

001180 GP12-CRT-ATTRIB.
	     MOVE 3920		 TO W41-LENGTH.
	     CALL "CBL_WRITE_SCR_ATTRS" USING SAVE-POS
					      W42-ATTRIB2
					      W41-LENGTH
					RETURNING WS-STATUS.
001220	     MOVE 4000		 TO W41-LENGTH.

001240 GP12-GET-USER-OPT.
	     CALL X"AF" USING GET-SINGLE-CHAR, KEY-STATUS.
	     PERFORM CLEAR-L50.
	   IF ADIS-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN UP-KEY
001320		     GO TO GP12-ADJ-NO-KEYS
		 WHEN DOWN-KEY
001340		     GO TO GP12-CHK-NO-KEYS
		 WHEN LEFT-KEY
		     IF WS-VIEW = "F" OR "M"
			 MOVE "F"
				 TO WS-OPTION
		     ELSE
			 MOVE "M"
				 TO WS-OPTION
		     END-IF
		     GO TO GP12-CHK-VIEW
		 WHEN RIGHT-KEY
		     IF WS-VIEW = "C" OR "M"
			 MOVE "L"
				 TO WS-OPTION
		     ELSE
			 MOVE "C"
				 TO WS-OPTION
		     END-IF
		     GO TO GP12-CHK-VIEW
		 WHEN OTHER	 CALL X"E5"
	       END-EVALUATE
	       GO TO GP12-GET-USER-OPT
	   ELSE
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		     GO TO G-PROF12-LOOKUP-EXIT
		 WHEN PAGE-DOWN
001340		     GO TO GP12-GET-NEXT-PAGE
		 WHEN PAGE-UP
001340		     GO TO GP12-GET-PREV-PAGE
		 WHEN OTHER	 CALL X"E5"
	       END-EVALUATE
	       GO TO GP12-GET-USER-OPT
	   ELSE
	   IF DATA-8BIT
	       MOVE KEY-CODE-1X  TO WS-OPTION
	       GO TO GP12-CHK-VIEW.
	     CALL X"E5".
001280	     GO TO GP12-GET-USER-OPT.

       GP12-CHK-VIEW.
	     CALL "CBL_TOUPPER" USING WS-OPTION
				BY VALUE WS-LENGTH
				RETURNING WS-STATUS.
	   IF NOT (WS-OPTION = "F" OR "M" OR "C")
	       GO TO GP12-GET-USER-OPT.
	   IF WS-VIEW = WS-OPTION
	       GO TO GP12-GET-USER-OPT.
	     MOVE WS-OPTION    TO WS-VIEW.
	     DISPLAY S-GP12.
	   IF WS-VIEW ="F"
	       DISPLAY W65-FIRST-4 AT 0452 WITH REVERSE-VIDEO
	   ELSE
	   IF WS-VIEW ="M"
	       DISPLAY W65-MID-4 AT 0452 WITH REVERSE-VIDEO.
	     PERFORM GP12-LUP-CLR-SCREEN.
	     MOVE W75-S        TO WS-S9.
	     MOVE 1	       TO W75-S.
000180	     MOVE 6	       TO CLIN.

       GP12-CHANGE-VIEW.
	     DISPLAY (CLIN, 2) W75-ITEM(W75-S)
		      WITH FOREGROUND-COLOR 3 HIGHLIGHT.
	   IF WS-VIEW = "P" OR "C"
	       DISPLAY ( , 21) W75-DESC(W75-S)
			WITH FOREGROUND-COLOR 3 HIGHLIGHT.
	     MOVE 53	       TO CCOL.
	   IF WS-VIEW = "F"
	       MOVE 1	       TO W75-S1 W75-S2
	   ELSE
	   IF WS-VIEW = "C"
	       MOVE 9	       TO W75-S1
	       MOVE 1	       TO W75-S2
	   ELSE
	       MOVE 5	       TO W75-S1
	       MOVE 1	       TO W75-S2.
	     PERFORM GP12-DISPLAY-4-GP.
	   IF W75-S < WS-S9
	       ADD 1	       TO W75-S
				  CLIN
	       GO TO GP12-CHANGE-VIEW.
	     GO TO GP12-FULL-SCREEN.

       GP12-DISPLAY-4-GP.
	     MOVE W75-QNT(W75-S, W75-S1)
			       TO W100-2V3.
	     DISPLAY W100-2V3 AT CPOS
		     WITH FOREGROUND-COLOR 3 HIGHLIGHT.
	   IF W75-S2 < 4
	       ADD 1	       TO W75-S1 W75-S2
	       ADD 7	       TO CCOL
	       GO TO GP12-DISPLAY-4-GP.

001240 GP12-GET-NEXT-PAGE.
001480     IF W75-S < 16
001490	       GO TO GP12-GET-USER-OPT.

       GP12-NEW-PAGE.
001500       MOVE 0601           TO CPOS.
001520	     PERFORM GP12-CRT-EDGE UNTIL CLIN = 22.
001530       MOVE 6              TO CLIN.
001540       MOVE LOW-VALUES     TO W75-KEYS.
001550       MOVE 1              TO W75-S W75-S1.
	     PERFORM GP12-LUP-TAB-LOOP.
001560	     GO TO GP12-GET-DEBHIS-REC.

       GP12-GET-PREV-PAGE.
             MOVE 1              TO WS-IXS1.
      *
      *    ****    SET OPTION TO BYPASS THE READ NEXT
      *
	      MOVE "J"		  TO WS-OPTION.

       GP12-GET-PREV-LOOP.
	     PERFORM READ-DEBHIS-PREV THRU READ-DEBHIS-EXIT.
	   IF WS-F-ERROR = 43
	       MOVE SPACE	 TO WS-OPTION
	       GO TO GP12-LUP-SCREEN.
	   IF NOT (DHS-AC = DEB-ACNO)
	       PERFORM READ-DEBHIS-NEXT THRU READ-DEBHIS-EXIT
	       GO TO GP12-NEW-PAGE.
	   IF WS-IXS1 < 32
	       ADD 1		 TO WS-IXS1
	       GO TO GP12-GET-PREV-LOOP.
	     GO TO GP12-NEW-PAGE.

001580 GP12-NO-RECORD.
	     PERFORM CLEAR-L50.
001590	     DISPLAY "No record - Press " AT 2512
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
001600		     "ANY" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
001610		     " key"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
	     CALL X"AF" USING GET-SINGLE-CHAR, KEY-STATUS.
001770	     GO TO G-PROF12-LOOKUP-EXIT.

001790 GP12-ADJ-NO-KEYS.
001800     IF W75-S1 > 1
001810         SUBTRACT 1        FROM W75-S1 CLIN.
001820	     GO TO GP12-HIGHLIGHT.

001840 GP12-CHK-NO-KEYS.
001850     IF W75-S1 = ZERO
001860         MOVE 1            TO W75-S1
001870	       GO TO GP12-HIGHLIGHT.
001880     IF W75-S1 < W75-S
001890         ADD 1             TO W75-S1 CLIN.

001910 GP12-HIGHLIGHT.
001920	     PERFORM GP12-CRT-ATTRIB.
001930       DISPLAY W43-DET (CLIN) AT CPOS WITH REVERSE-VIDEO.
001940	     GO TO GP12-GET-USER-OPT.

002070 GP12-CRT-EDGE.
002130	     DISPLAY "³" AT CPOS WITH BACKGROUND-COLOR 0
				      FOREGROUND-COLOR 3
		     "                  ³
      - 	     "      ³      ³      ³      "
		      WITH FOREGROUND-COLOR 3
		     "³" WITH BACKGROUND-COLOR 0
			      FOREGROUND-COLOR 3.
002090	     ADD 1		 TO CLIN.

002110 G-PROF12-LOOKUP-EXIT.
002120       EXIT.
