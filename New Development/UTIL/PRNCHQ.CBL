      $SET LINKCOUNT"320"
      ******************************************************************
      *                                                                *
      *    ******   **	  **  *******	*******   **	**  *******    *
      *   **	**  **	  **  **       **     **  **	**  **	       *
      *   **	    **	  **  **       **     **  **	**  **	       *
      *   **	    ********  ****     **     **  **	**  ****       *
      *   **	    **	  **  **       **     **  **	**  **	       *
      *   **	**  **	  **  **       **   ***   **	**  **	       *
      *    ******   **	  **  *******	***** **   ******   *******    *
      *                                                                *
      *     ENGLISH                                                    *
      *                                                                *
      *     C H E Q U E   P R I N T   U T I L I T Y   P R O G R A M    *
      *                                                                *
      *     VERSION 8.13.07 - March 2008			       *
      * 							       *
      ******************************************************************
000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID.     PRNCHQ.
000030 AUTHOR.         J W LEMMON (APAC).
000040 DATE-WRITTEN.   January 1997.

	   This program is used to print/spool Cheque details.

	   The program performs the following functions:

	   a)  Allows the USER to capture the cheque details and then
	       calls CHQPRN to print the cheque.

	   b)  Allows the USER to capture cheque details to a batch
	       file which may be viewed and cheque details may be
	       amended or deleted.

	       Cheques may then be printed from the batch file and
	       the program calls CHQPRN to print each cheque after
	       which the USER may invoke a rountine to allocate the
	       cheque numbers to each cheque that has been printed.

	       Cheques that have had numbers allocated may then be
	       processed.

		   COPYRIGHT NOTICE: COPYRIGHT (C) 1997 - 2008
				     by James William Lemmon.
				       (Id No. 4412165050082).

		   All rights reserved.

		   e-mail jwlemmon@gmail.com.

000050 SECURITY.
		   This program is free software; you can redistribute
		   it and/or modify it under the terms of the GNU General
		   Public License as published by the Free Software
		   Foundation; either version 2 of the License, or (at
		   your option) any later version.

		   This program is distributed in the hope that it will
		   be useful, but WITHOUT ANY WARRANTY; without even the
		   implied warranty of MERCHANTABILITY or FITNESS FOR A
		   PARTICULAR PURPOSE.	See the GNU General Public License
		   for more details.

		   You should have received a copy of the GNU General
		   Public License along with this program; if not, write
		   to the Free Software Foundation, Inc., 59 Temple Place
		   - Suite 330, Boston, MA 02111-1307, USA.

000050 ENVIRONMENT DIVISION.
000060 CONFIGURATION SECTION.
000070 SPECIAL-NAMES.
000080                 CURSOR IS CSTART
000090		       CONSOLE IS CRT
		       CRT STATUS IS KEY-STATUS.

000100 INPUT-OUTPUT SECTION.
000100 FILE-CONTROL.

       COPY APACFIDS.SL.

       COPY PARAM.SL.

       COPY CHQBATCH.SL.

000160 COPY CREDIT.SL.

       COPY GACCNT.SL.

000220 DATA DIVISION.
000230 FILE SECTION.

       COPY APACFIDS.FDE.

       COPY PARAM.FDE.

       COPY CHQBATCH.FDE.

000360 COPY CREDIT.FDE.

000320 COPY GACCNT.FDE.

      /
001690 WORKING-STORAGE SECTION.
       77  WS-CHECK	   PIC	X(18)	 VALUE
			   "aeWlimemnomLalismJ".
003260 77  WS-S1	   PIC	9(04)	 COMP-5.
003270 77  WS-S2	   PIC	9(04)	 COMP-5.
003280 77  WS-S3	   PIC	9(04)	 COMP-5.
003290 77  WS-S4	   PIC	9(04)	 COMP-5.
003300 77  WS-S5	   PIC	9(04)	 COMP-5.
003310 77  WS-S6	   PIC	9(04)	 COMP-5.
003320 77  WS-S7	   PIC	9(04)	 COMP-5.
003330 77  WS-S8	   PIC	9(04)	 COMP-5.
001790 77  WS-IXS	   PIC	9(04)	 COMP-5.
001800 77  WS-IXS1	   PIC	9(04)	 COMP-5.
001810 77  WS-IXS2	   PIC	9(04)	 COMP-5.
001820 77  WS-IXS3	   PIC	9(04)	 COMP-5.
001830 77  WS-IXS4	   PIC	9(04)	 COMP-5.
      *
      *    ****    T E M P O R A R Y   F I X
      *
001900 77  WS-OPEN	   PIC	9(02)	 VALUE 3.
003330 77  WS-LEFT	   PIC	9(04)	 COMP-5.
003330 77  WS-RIGHT	   PIC	9(04)	 COMP-5.
001670 77  WS-NETKEY	   PIC	9(06)	 COMP-5.
001660 77  WS-PARKEY       PIC  9(06)    COMP-5.
001820 77  WS-OPTION	   PIC	X(01).
       77  WS-BATCH	   PIC	X(01).
       77  WS-SKIP	   PIC	X(01)	 VALUE "N".
       77  WS-CRD-CHQ	   PIC	X(01)	 VALUE "N".
       77  WS-ERROR	   PIC	9(01)	 VALUE ZERO.
       77  WS-CHQ	   PIC	9(01)	 VALUE ZERO.
       77  WS-LINES	   PIC	9(02)	 VALUE ZERO.
002570 77  WS-PGE-LENGTH   PIC	9(02)	 VALUE 66.
001870 77  WS-PRN-LENGTH   PIC	9(02)	 VALUE 62.
003650 77  WS-COND	   PIC	X(06)	 VALUE X"000000000000".
003660 77  WS-NORM	   PIC	X(06)	 VALUE X"000000000000".
003070 77  WS-EXPP	   PIC	X(06)	 VALUE X"000000000000".
003080 77  WS-ECAN	   PIC	X(06)	 VALUE X"000000000000".
003090 77  WS-8LPI	   PIC	X(06)	 VALUE X"000000000000".
003100 77  WS-6LPI	   PIC	X(06)	 VALUE X"000000000000".
       77  WS-10CPI	   PIC	X(06)	 VALUE X"000000000000".
       77  WS-12CPI	   PIC	X(06)	 VALUE X"000000000000".
       77  WS-17CPI	   PIC	X(06)	 VALUE X"000000000000".
003150 77  WS-PRN-NO	   PIC	X(01)	 COMP-X VALUE 9.
003160 77  WS-PRN-STAT	   PIC	X(01)	 COMP-X.
       77  WS-NOT-APP	   PIC	X(14)	 VALUE "Not Applicable".
002190 77  WS-ER6	   PIC	X(09)	 VALUE "No Record".
002200 77  WS-ER7	   PIC	X(13)	 VALUE "Group Heading".
       77  TODAY-DDMMYY	   PIC	9(08) COMP-5.
       77  WS-USUB	   PIC	9(04) COMP-5.

003050 01  WS-DB-LINE.
003080	   03  WS-TOP-LNE2.
001390	       05  WS-TCR   PIC  X(80) VALUE "旼컴컴컴컴컴컴컴컴컴컴컴컴
      -        "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커".
003100	   03  WS-TP-LINE2 REDEFINES WS-TOP-LNE2.
003110         05  FILLER      PIC  X(01).
003120         05  WS-TOP-COMP PIC  X(40).
001430	       05  FILLER      PIC  X(23).
	       05  WS-WRKHD    PIC  X(11).
001430	       05  FILLER      PIC  X(01).
	       05  WS-WRKST    PIC  X(03).
001430	       05  FILLER      PIC  X(01).
002450	   03  WS-MID-LNE.
002460         05  WS-MCHR PIC X(01) OCCURS 80.
	   03  WS-MDGL-LNE REDEFINES WS-MID-LNE.
	       05  WS-MGL1     PIC X(01).
	       05  WS-MGL78    PIC X(78).
	       05  WS-MGL80    PIC X(01).
002450	   03  WS-MD-LNE.
002460         05  WS-MCR  PIC X(01) OCCURS 80.
	   03  WS-MDCR-LNE REDEFINES WS-MD-LNE.
	       05  WS-MCR1     PIC  X(01).
	       05  WS-MCR78    PIC  X(78).
	       05  WS-MCR80    PIC  X(01).
003160	   03  WS-MID-LNE2.
	       05  FILLER      PIC  X(01) VALUE "".
	       05  WS-BLNK78   PIC  X(78) VALUE ALL "".
	       05  FILLER      PIC  X(01) VALUE "".
003200	   03  WS-BOT-LNE2.
001510	       05  WS-BCR   PIC  X(80) VALUE "읕컴컴컴컴컴컴컴컴컴컴컴컴
      -        "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸".
003240	   03  WS-B-LINE REDEFINES WS-BOT-LNE2.
003250	       05  FILLER      PIC X(01).
               05  WS-MEM-LINE.
003260            07  WS-SRT-LINE
003270			       PIC X(50).
		  07  FILLER   PIC X(10).
003280	       05  FILLER      PIC X(19).

       COPY WS.WS.

       01  WS-HELP.
	   03  WS-MODULE       PIC  X(03) VALUE "PRN".
	   03  WS-PROG	       PIC  X(03) VALUE "CHQ".

000290 01  WS-PARID.
000020	   03  WS-SYS-ID       PIC  X(03).

002040 01  W02-FID.

       COPY APACFIDS.ID.

000010 COPY CHQBATCH.ID.

000360 COPY CREDIT.ID.

000320 COPY GACCNT.ID.

       COPY PARAM.ID.

       01  W02-PRINTER-DETAILS.
	   03  W02-PRINTER     PIC  X(12).
002570	   03  W02-PGE-LENGTH  PIC  9(02).
001870	   03  W02-PRN-LENGTH  PIC  9(02).
	   03  W02-LINAGE      PIC  9(02).
	   03  W02-PRN-STATUS  PIC  X(01) VALUE "C".
      *
      *    ****    D  =  Detail line
      * 	   C  =  Condensed print
      * 	   E  =  Expanded print
      * 	   H  =  Header line
      * 	   X  =  Cancel expanded print
      * 	   1  =  10 Characters per inch
      * 	   2  =  12 Characters per inch
      * 	   3  =  17 Characters per inch
      * 	   6  =  6 Lines per inch
      * 	   8  =  8 Lines per inch
      *
	   03  W02-PRN-TYPE	PIC  X(01).
	   03  W02-PRN-DET.
	       05  W02-PRN-DATE	PIC  9(08).
	       05  W02-PRN-PAY	PIC  X(40).
	       05  W02-PRN-VAL	PIC  9(09)V99.
	       05  FILLER	PIC  X(77).

002500 01  W10-DATES.
002510	   03  W10-DATE	       PIC  X(10).
002520	   03  W10-EDTE REDEFINES W10-DATE PIC 99/99/9999.

       COPY W12.WS.

	   03  W12-T-CYMD      PIC  9(08).
	   03  W12-CHK-DATE REDEFINES W12-T-CYMD.
	       05  W12-CN      PIC  9(02).
	       05  W12-YYMMDD  PIC  9(06).
	   03  W12-CHK-DTE REDEFINES W12-T-CYMD.
	       05  W12-TCY     PIC  9(04).
	       05  W12-TMM     PIC  9(02).
	       05  W12-TDD     PIC  9(02).

       01  W15-INPUT.
	   03  W15-DATE        PIC  9(08).
	   03  W15-PAYEE       PIC  X(40).
	   03  W15-BANK        PIC  9(06).
	   03  W15-BANK-NAME   PIC  X(30).
	   03  W15-NARRATIVE-1 PIC  X(40).
	   03  W15-ALLOCATIONS OCCURS 10.
	     05  W15-GL-AC     PIC  9(06).
	     05  W15-GLAC-NAME PIC  X(30).
	     05  W15-NARRATIVE PIC  X(40).
	     05  W15-AMOUNT    PIC S9(09)V99.
	   03  W15-VALUE       PIC S9(09)V99.
	   03  W15-CHQ-NO      PIC  9(08).
	   03  W15-ACCOUNT     PIC  9(06).
002680	   03  W15-ACNO1   REDEFINES W15-ACCOUNT.
002690	       05  FILLER      PIC  9(04).
002710	       05  W15-SER     PIC  9(02).
002720     03  W15-ACNO2   REDEFINES W15-ACCOUNT.
002730	       05  W15-GR      PIC  9(02).
002740	       05  W15-SGRP    PIC  9(02).
002760	       05  W15-ASER    PIC  9(02).
002780     03  W15-ACNO3   REDEFINES W15-ACCOUNT.
002790	       05  W15-GROUP   PIC  9(02).
002810	       05  W15-REST    PIC  9(04).
002830     03  W15-ACNO4   REDEFINES W15-ACCOUNT.
002840	       05  W15-GRP     PIC  9(01).
002850	       05  FILLER      PIC  9(05).
	   03  W15-CRED        PIC  X(06).
003310	   03  W15-ACNO        PIC  X(06).
003740	   03  W15-NAME.
001490	       05  W15-NCHAR   PIC  X(01) OCCURS 40.
	   03  W15-CNAME       PIC  X(40).

       COPY W20.WS.

	   03  W22-CCYMD.
	       05  W22-C       PIC  9(02).
	       05  W22-YMD     PIC  9(06).
	   03  W22-CCYYMMDD REDEFINES W22-CCYMD.
	       05  W22-CY      PIC  9(04).
	       05  W22-M       PIC  9(02).
	       05  W22-D       PIC  9(02).
	   03  W22-CYMD REDEFINES W22-CCYMD
			       PIC  9(08).
	   03  W22-DDMMCCYY.
	       05  W22-DD      PIC  9(02).
	       05  W22-MM      PIC  9(02).
	       05  W22-CCYY    PIC  9(04).
	   03  W22-DMCY REDEFINES W22-DDMMCCYY
			       PIC  9(08).

003930 01  W25-CALCS.
002860	   03  W25-RESULT      PIC 9(05)V99.
002870     03  W25-RESULT1 REDEFINES W25-RESULT.
002880         05  W25-WHOLE   PIC 9(05).
002890         05  W25-DECIMAL PIC 9(02).
           03  W25-RESULT2 REDEFINES W25-RESULT.
	       05  W25-KEY     PIC 9(04).
	       05  W25-SUB     PIC 9(01).
	       05  FILLER      PIC 9(02).

       COPY W40.WS.

       COPY W70.WS.

       01  W75-KEYS.
           03  W75-S          PIC 9(02) COMP-5.
           03  W75-S1         PIC 9(02) COMP-5.
	   03  W75-CNO	      PIC X(06) OCCURS 18.
	   03  W75-GNO	      PIC 9(06) COMP-5
                              OCCURS 18.

       COPY FUNCTION.WS.

       LINKAGE SECTION.

       COPY CHAIN.LS.

      /
004580 SCREEN SECTION.

       COPY BLANK.CRT.

       01  S-CHEQUE.
	   03  LINE  3 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
	   VALUE "旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
      -		 "컴컴컴컴컴".
	   03	       COLUMN 72 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "".
	   03  LINE  4 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "Date    ".
	   03	       COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "        ".
	   03	       COLUMN 26 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5
		 VALUE "                                              ".
	   03	       COLUMN 72 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "".
	   03  LINE  5 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "Payee   ".
	   03	       COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE  6 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "Bank Ac ".
	   03	       COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "      ".
	   03	       COLUMN 24 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       ":				           ".
	   03	       COLUMN 67 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "     ".
	   03  LINE  7 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "Narrat. ".
	   03	       COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
	   "    				                 ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE  8 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "Value   ".
	   03	       COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5
				 VALUE "              ".
	   03	       COLUMN 32 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "                                        ".
	   03  LINE  9 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 0
				 BACKGROUND-COLOR 5 VALUE
		       "____________________A L L O C A T I O N S_______
      -		       "_____________".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 10 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "A/C No Name/Narrative
      -		       "      Amount ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 11 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 12 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 13 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 14 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 15 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 16 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 17 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 18 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 19 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 20 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE " ".
	   03	       COLUMN 10 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE
		       "
      -		       "	     ".
	   03	       COLUMN 71 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE " ".
	   03  LINE 21 COLUMN  8 BACKGROUND-COLOR 5 FOREGROUND-COLOR 0
				 VALUE "".
	   03	       COLUMN  9 FOREGROUND-COLOR 5 HIGHLIGHT
				 BACKGROUND-COLOR 5
	   VALUE "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
      -		 "컴컴컴컴켸".

       01  SA-CHEQUE.
	   02  SA-CHQ-DTE.
	   03  LINE  4 COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 99/99/9999
				 USING W15-DATE AUTO.
	   02  SD-CHQ-NO.
	   03  LINE  4 COLUMN 57 FOREGROUND-COLOR 6 HIGHLIGHT
				 BACKGROUND-COLOR 5 VALUE "Chq.No.".
	   03	       COLUMN 65 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZ
				 FROM W15-CHQ-NO.

	   02  SA-CHQ-PAY.
	   03  LINE  5 COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 USING W15-PAYEE AUTO.

	   02  SA-CHQ-BANK.
	   03  LINE  6 COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 USING W15-BANK AUTO.

	   02  SD-CHQ-BNAME.
	   03  LINE  6 COLUMN 25 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(30)
				 FROM W15-BANK-NAME.

	   02  SA-CHQ-NAR-1.
	   03  LINE  7 COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 USING W15-NARRATIVE-1 AUTO.

	   02  SA-CHQ-VAL.
	   03  LINE  8 COLUMN 18 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZ,ZZZ,ZZ9.99-
				 USING W15-VALUE AUTO.

       01  SA-CHEQUE-2.
	   02  SA-CHQ-GLAC.
	   03	       COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 USING W15-GL-AC(WS-S8) AUTO.

	   02  SD-CHQ-GNAME.
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME(WS-S8).

	   02  SA-CHQ-GLA-NAR.
	   03	       COLUMN 17 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 USING W15-NARRATIVE(WS-S8) AUTO.

	   02  SA-CHQ-GLA-VAL.
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 USING W15-AMOUNT(WS-S8) AUTO.

       01  SA-ALLOCATE.
	   03  LINE 16 COLUMN 48 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ
				 USING W15-CHQ-NO AUTO.

       01  SD-CHQ-ALLOCATE.
	   03  LINE 11 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (1).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (1).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (1).
	   03  LINE 12 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (2).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (2).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (2).
	   03  LINE 13 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (3).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (3).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (3).
	   03  LINE 14 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (4).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (4).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (4).
	   03  LINE 15 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (5).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (5).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (5).
	   03  LINE 16 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (6).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (6).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (6).
	   03  LINE 17 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (7).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (7).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (7).
	   03  LINE 18 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (8).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (8).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (8).
	   03  LINE 19 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (9).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (9).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (9).
	   03  LINE 20 COLUMN 10 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC 9(06)
				 BLANK WHEN ZERO
				 FROM W15-GL-AC (10).
	   03	       COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-GLAC-NAME (10).
	   03	       COLUMN 58 FOREGROUND-COLOR 7 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC ZZZZZZZZ9.99-
				 BLANK WHEN ZERO
				 FROM W15-AMOUNT (10).


       01  SD-ACC-NARRATIVES.
	   03  LINE 11 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (1).
	   03  LINE 12 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (2).
	   03  LINE 13 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (3).
	   03  LINE 14 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (4).
	   03  LINE 15 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (5).
	   03  LINE 16 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (6).
	   03  LINE 17 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (7).
	   03  LINE 18 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (8).
	   03  LINE 19 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (9).
	   03  LINE 20 COLUMN 17 FOREGROUND-COLOR 3 HIGHLIGHT
				 BACKGROUND-COLOR 5 PIC X(40)
				 FROM W15-NARRATIVE (10).

       COPY CRDLUP.CRT.

       COPY LEDLUP.CRT.

004870 COPY S99.CRT.

       COPY ERROR.CRT.

       COPY OPT.CRT.

      /
001230 PROCEDURE DIVISION
		 USING LS-PARID LS-USER-ID LS0-PROGRAMS LS0-SECURITY.
010250 AA000-MAIN      SECTION.
010260 AA000-INIT.
003240	   IF LS0-GLLEV < 3
	       MOVE "Not Authorised"
				 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
	       GO TO AA49.
006560	     PERFORM ZA000-INIT.
	     DISPLAY "CHEQUE PROCESSING" at 0232
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     DISPLAY
	      "旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커"
	       AT 0415 WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7.
	     DISPLAY
	      " Single  cheques  will only be  printed!  Batched "
	       AT 0515 WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7.
	     DISPLAY
	      " cheques will be printed and then give the option "
	       AT 0615 WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7.
	     DISPLAY
	      " to post the cheques that have been printed.  The "
	       AT 0715 WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7.
	     DISPLAY
	      " system  allows  for the range of numbers  to  be "
	       AT 0815 WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7.
	     DISPLAY
	      " allocated to the cheques  that have been printed "
	       AT 0915 WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7.
	     DISPLAY
	      " before posting to the relevant accounts.         "
	       AT 1015 WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7.
	     DISPLAY
	      "읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸"
	       AT 1115 WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7.

       AA05.
	     MOVE "'S'ingle,'B'atch,'P'ost cheques or 'E'xit  [S]"
				 TO WS-ERR-MES.
	     MOVE "S"		 TO WS-OPTION.
	     PERFORM OPT-MESSAGE.
	   IF NOT (WS-OPTION = "B" OR "E" OR "S" OR "P")
	       GO TO AA05.
026330       DISPLAY CLR-SCREEN.
	     DISPLAY "CHEQUE PRINTING" at 0233
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	   IF WS-OPTION = "E"

	       GO TO AA45.
	   IF WS-OPTION = "P"
	       MOVE "UTP\POSTCHQ"
				 TO LS-NEXT-PRG
	       GO TO AA45.
	   IF WS-OPTION = "B"
	       MOVE "Y" 	 TO WS-BATCH
	       PERFORM CA000
	       GO TO AA45.
	     PERFORM OPEN-PRINTER.
	     MOVE "P"		 TO WS-COMMAND.
	     MOVE "D"		 TO W02-PRN-TYPE.
	     PERFORM BA000.
	     MOVE "C"		 TO WS-COMMAND.
	     PERFORM CALL-CHQPRINT.
	     CANCEL "UTP\CHQPRN".

       AA45.
	     CLOSE CREDIT
		   GACCNT.

       AA49.
	     EXIT PROGRAM.

       AA50-LOOKUP     SECTION.
       AA50.
011050	     PERFORM SAVE-SCREEN.
011080       MOVE 4              TO W44-FUNCTION.
011090	     PERFORM SCREEN-CONTENTS.
	     PERFORM CREDITOR-LOOKUP.
011320	     PERFORM RESTORE-SCREEN.

       AA99.
             EXIT.

       AA350-LOOKUP    SECTION.
       AA350.
011050	     PERFORM SAVE-SCREEN.
011080       MOVE 4              TO W44-FUNCTION.
011090	     PERFORM SCREEN-CONTENTS.
	     PERFORM GACCNT-LOOKUP.
011320	     PERFORM RESTORE-SCREEN.
       AA399.
             EXIT.

       OPEN-PRINTER    SECTION.
       OPEN-PRINT-FILE.
      *
      *    ****   O P E N   P R I N T E R   F I L E
      *
	     MOVE "O"		 TO WS-COMMAND.
	     MOVE "P"		 TO WS-PRINTER.
	     MOVE ZERO		 TO WS-ADVANCE
				    WS-REPORT
				    WS-SCREEN.
	     MOVE 1		 TO WS-REPORT.

       CALL-CHQPRINT.
      *
      *    ****   C A L L   T H E   P R I N T / S P O O L   U T I L I T Y
      *
	     CALL "UTP\CHQPRN" USING WS-PARID
				       LS-USER-ID
				       WS-SCREEN-PRINT
				       W02-PRINTER-DETAILS
		  ON EXCEPTION
		      MOVE "Print/Spool Utility problem"
				 TO WS-ERR-STRING
003260		      PERFORM ERROR-MESSAGE
		      MOVE 8	 TO WS-ERROR
	     END-CALL.

       OPEN-PRINTER-EXIT.
	     EXIT.

      /
      *    ****    READ FILES ROUTINES
      *
011130 AC000           SECTION.

       COPY CHQBATCH.RD.

       COPY CREDIT.RD.

       COPY GACCNT.RD.

011290 COPY PARAM.RD.

       AD000	       SECTION.

       COPY CHQBATCH.WR.

       COPY FUNCTION.CRT.

       COPY OPTION.CRT.

011390 COPY LOCKED.RC2.

011410 COPY CLEAR.CRT.

       COPY DATE.CHK.

       COPY GACCNT.LUP.

      /
009010 AE155-GET-CREDITOR    SECTION.
009020 AE155-ACCOUNT.
011060       MOVE W15-ACNO       TO P-NUMBER.
011130       PERFORM READ-CREDIT THRU READ-CREDIT-EXIT.
011140     IF WS-F-ERROR = 3
011150         MOVE 1 TO WS-ERROR
011160     ELSE
011170     IF P-NUMBER NOT = W15-ACNO
011180         MOVE 2 TO WS-ERROR
011190     ELSE
011200         MOVE 0 TO WS-ERROR.
009180 AE160-EXIT.
009190       EXIT.

       COPY CREDIT.ILU.

       COPY APAC.HLP.

      /
      *    ****    C A P T U R E   A N D   P R I N T   C H E Q U E S
      *
       BA000	       SECTION 50.
       BA00.
	     MOVE W12-TODAY	 TO W15-DATE.

       BA02.
026330       DISPLAY CLR-SCREEN.
	     MOVE 4		 TO SHADE-ROW.
	     MOVE 10		 TO SHADE-COL.
	     MOVE 63		 TO SHADE-WIDTH.
	     MOVE 18		 TO SHADE-LINES.
	     DISPLAY S-CHEQUE.
	     PERFORM SCREEN-SHADOW.
	   IF WS-BATCH = "Y"
	       DISPLAY "BATCH CHEQUE PRINTING" AT 0230
			WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     MOVE SPACES	 TO W15-NARRATIVE-1 W15-PAYEE
				    W15-BANK-NAME   W15-CRED
				    W15-CNAME.
	     MOVE ZERO		 TO W15-VALUE W15-CHQ-NO.
	     MOVE 1		 TO WS-S8.

       BA02-LOOP.
	     MOVE SPACES	 TO W15-GLAC-NAME(WS-S8)
				    W15-NARRATIVE(WS-S8).
	     MOVE ZERO		 TO W15-GL-AC(WS-S8)
				    W15-AMOUNT(WS-S8).
	   IF WS-S8 < 10
	       ADD 1		 TO WS-S8
	       GO TO BA02-LOOP.
	     MOVE SPACE		 TO WS-CRD-CHQ.
013720       MOVE W70-BNKGL      TO W15-BANK.
	   IF WS-BATCH = "N"
	       GO TO BA05.
	     MOVE WS-CRD-CHQ	 TO WS-OPTION.

       BA02A.
	     MOVE SPACES     TO WS-ERR-MES.
	     STRING "Trade Creditor Payment 'Y'/'N' or 'E'xit  ["
			    DELIMITED SIZE
		    WS-OPTION DELIMITED SIZE
		    "]" DELIMITED SIZE
			     INTO WS-ERR-MES.
	     MOVE 7		 TO SLIN.
	     PERFORM OPT-SETUP THRU OPT-EXIT.
	   IF NOT (WS-OPTION = "E" OR "N" OR "Y")
	       GO TO BA02A.
	     IF WS-OPTION = "E"
		 GO TO BA999.
	     MOVE WS-OPTION	 TO WS-CRD-CHQ.
	   IF WS-CRD-CHQ = "Y"
	       PERFORM DA000
	       IF WS-ERROR = 9
		   GO TO BA999
	       END-IF
	       IF WS-ERROR > ZERO
		   GO TO BA02.

       BA05.
	     ACCEPT SA-CHQ-DTE.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      GO TO BA999
		 WHEN OTHER	 CALL X"E5"
		      GO TO BA05
	       END-EVALUATE.
027380	     MOVE W15-DATE	 TO W10-EDTE.
027390       PERFORM CHECK-DATE.
027400     IF WS-ERROR = 1
027410	       MOVE "Date"	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
027420	       GO TO BA05.
	     MOVE W22-DTE1	 TO W22-DTE2 W22-CYMD.
      *
      *    ****    C H E C K   I F   T H E   C H E Q U E   I S
      * 	   P O S T   D A T E D	 O R   S T A L E
      *
	   IF W22-CYMD = W12-T-CYMD
		GO TO BA10.
	   IF W22-CYMD < W12-T-CYMD
	       GO TO BA07.
	   IF NOT (WS-CRD-CHQ = "Y")
027410	       MOVE "G/L Cheques may not be post dated"
				 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
027420	       GO TO BA05.
	     MOVE " "		 TO WS-OPTION.

       BA06.
	     MOVE "Cheque is Post-Dated; Accept Y/N?  [ ]"
				 TO WS-ERR-MES.
	     MOVE 15		 TO SLIN.
	     PERFORM OPT-SETUP THRU OPT-EXIT.
	   IF NOT (WS-OPTION = "Y" OR "N")
	       GO TO BA06.
	   IF WS-OPTION = "Y"
	       GO TO BA10.
	     GO TO BA05.

       BA07.
	   IF W22-CY = W12-TCY
		MOVE ZERO	 TO WS-S8
	   ELSE
		SUBTRACT W22-CY FROM W12-TCY
				 GIVING WS-S8.
	   IF WS-S8 > 1
	       GO TO BA08.
	   IF WS-S8 > ZERO
	       COMPUTE WS-S7 = (W12-TMM + 12) - W22-M
	   ELSE
	       SUBTRACT W22-M FROM W12-TMM
				 GIVING WS-S7.
	   IF WS-S7 < 6
	       GO TO BA10.
	   IF WS-S7 > 6
	       GO TO BA08.
	   IF W22-D > W12-TDD
	       GO TO BA10.

       BA08.
	     MOVE "Cheque is STALE; change date"
				 TO WS-ERR-STRING
003260	     PERFORM ERROR-MESSAGE.
	     GO TO BA05.

       BA10.
	     ACCEPT SA-CHQ-PAY.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      GO TO BA05
		 WHEN OTHER	 CALL X"E5"
		      GO TO BA10
	       END-EVALUATE.
	   IF W15-PAYEE = SPACES
	       MOVE "Payee may not be left BLANK"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO BA10.
	   IF NOT (WS-BATCH = "Y")
	       DISPLAY WS-NOT-APP AT 0618
		       WITH FOREGROUND-COLOR 3 HIGHLIGHT
			    BACKGROUND-COLOR 5
	       DISPLAY WS-NOT-APP AT 0718
		       WITH FOREGROUND-COLOR 3 HIGHLIGHT
			    BACKGROUND-COLOR 5
	       GO TO BA50.
	   IF NOT (W15-BANK = ZERO)
	       MOVE W15-BANK	 TO G-AC
008980	       PERFORM READ-GACCNT THRU READ-GACCNT-EXIT
	       IF NOT (WS-F-ERROR = 8)
		   MOVE G-NAME	 TO W15-BANK-NAME
		   DISPLAY SD-CHQ-BNAME.

       BA12.
	     DISPLAY "F1" AT 2502
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "=Help,"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "F2" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " to do Account Lookup - "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "Esc" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "ape to exit"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.

       BA15.
	     ACCEPT SA-CHQ-BANK.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      PERFORM CLEAR-L50
		      GO TO BA10
		 WHEN F1-KEY
		      PERFORM HELP-ROUTINE
		 WHEN F2-KEY
		      MOVE ZERO	 TO W15-ACCOUNT
		      PERFORM AA350
		 WHEN OTHER
		      CALL X"E5"
		      GO TO BA15
	       END-EVALUATE
               IF W15-ACCOUNT = ZERO
015990		   GO TO BA15
	       END-IF
	       MOVE W15-ACCOUNT  TO W15-BANK
	       DISPLAY SA-CHQ-BANK.
	     PERFORM CLEAR-L50.
013810	   IF W15-BANK = ZERO
013820	       GO TO BA10.
	     MOVE W15-BANK	 TO W15-ACCOUNT
013830     IF W15-ASER = ZERO
013840	       MOVE WS-ER7	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
013850	       GO TO BA15.
008970	     MOVE W15-ACCOUNT	 TO G-AC.
008980       PERFORM READ-GACCNT THRU READ-GACCNT-EXIT.
021840	   IF WS-F-ERROR = 8
013900	       MOVE WS-ER6	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
013910	       GO TO BA12.
	     MOVE G-NAME	 TO W15-BANK-NAME.
	     DISPLAY SD-CHQ-BNAME.

       BA20.
	     ACCEPT SA-CHQ-NAR-1.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      GO TO BA12
		 WHEN OTHER	 CALL X"E5"
		      GO TO BA20
	       END-EVALUATE.
	   IF W15-NARRATIVE-1 = SPACES
	       MOVE "Narrative may not be left BLANK"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO BA20.
	     MOVE 11		 TO LIN.
	     MOVE 1		 TO WS-S8.
	   IF NOT (W15-GL-AC(WS-S8) = ZERO)
	       MOVE W15-GL-AC(WS-S8)
				 TO G-AC
008980	       PERFORM READ-GACCNT THRU READ-GACCNT-EXIT
	       IF NOT (WS-F-ERROR = 8)
		   MOVE G-NAME	 TO W15-GLAC-NAME(WS-S8)
		   DISPLAY SD-CHQ-GNAME AT LINE LIN.

       BA22.
	     PERFORM BA12.

       BA25.
	     ACCEPT SA-CHQ-GLAC AT LINE LIN.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      PERFORM CLEAR-L50
		      IF WS-S8 = 1
			  GO TO BA20
		      ELSE
			  GO TO BA38
		 WHEN F1-KEY
		      PERFORM HELP-ROUTINE
		 WHEN F2-KEY
		      MOVE ZERO	 TO W15-ACCOUNT
		      PERFORM AA350
		 WHEN OTHER
		      CALL X"E5"
		      GO TO BA25
	       END-EVALUATE
               IF W15-ACCOUNT = ZERO
015990		   GO TO BA25
	       END-IF
	       MOVE W15-ACCOUNT  TO W15-GL-AC(WS-S8)
	       DISPLAY SA-CHQ-GLAC AT LINE LIN.
	     PERFORM CLEAR-L50.
013810	   IF W15-GL-AC(WS-S8) = ZERO
	       IF WS-S8 = 1
013820		   GO TO BA20
	       ELSE
		   GO TO BA38.
	      MOVE W15-GL-AC(WS-S8)
				 TO W15-ACCOUNT
013830     IF W15-ASER = ZERO
013840	       MOVE WS-ER7	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
013850	       GO TO BA22.
008970	     MOVE W15-ACCOUNT	 TO G-AC.
008980       PERFORM READ-GACCNT THRU READ-GACCNT-EXIT.
021840	   IF WS-F-ERROR = 8
013900	       MOVE WS-ER6	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
013910	       GO TO BA25.
	     MOVE G-NAME	 TO W15-GLAC-NAME(WS-S8).
	     DISPLAY SD-CHQ-GNAME AT LINE LIN.
	   IF LIN > 15
	       MOVE 11		 TO SLIN
	   ELSE
	       MOVE 16		 TO SLIN.
	     PERFORM CHECK-SETUP THRU CHECK-EXIT.
020250	   IF WS-OPTION = "N"
	       GO TO BA22.

       BA30.
	   IF W15-NARRATIVE(WS-S8) = SPACES
	       MOVE W15-NARRATIVE-1
				 TO W15-NARRATIVE(WS-S8).
	     ACCEPT SA-CHQ-GLA-NAR AT LINE LIN.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      DISPLAY SD-CHQ-GNAME AT LINE LIN
		      GO TO BA22
		 WHEN OTHER	 CALL X"E5"
		      GO TO BA30
	       END-EVALUATE.
	   IF W15-NARRATIVE(WS-S8) = SPACES
	       MOVE "Narrative may not be left BLANK"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO BA30.

       BA35.
	     ACCEPT SA-CHQ-GLA-VAL AT LINE LIN.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      GO TO BA30
		 WHEN OTHER	 CALL X"E5"
		      GO TO BA35
	       END-EVALUATE.
	   IF W15-AMOUNT(WS-S8) = ZERO
	       GO TO BA30.
	     ADD W15-AMOUNT(WS-S8)
				 TO W15-VALUE.
	     DISPLAY SA-CHQ-VAL.
	     MOVE 14		 TO SLIN.
	     PERFORM CHECK-SETUP THRU CHECK-EXIT.
020250	   IF WS-OPTION = "N"
	       SUBTRACT W15-AMOUNT(WS-S8)
				 FROM W15-VALUE
	       GO TO BA22.
	     DISPLAY SD-CHQ-GNAME AT LINE LIN.
      *
      *    ****    F O R   G / L   C H E Q U E S   A L L O W   F O R
      * 	   A L L O C A T I O N S
      *
	   IF NOT (WS-CRD-CHQ = "Y")
	       IF WS-S8 < 10
		   ADD 1	 TO WS-S8 LIN
		   GO TO BA22.
      *
      *    ****    C H E C K   F O R   M I N I M U M   V A L U E
      *
       BA38.
	   IF W15-VALUE < 2.00
	       MOVE "Cheque amount LESS than 2.00"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO BA22.
      *
      *    ****    I N C L U D E   C E N T U R Y   I N	 D A T E
      *
       BA39.
	     MOVE W22-DTE1	 TO W22-DTE2.
      *
      *    ****    S W I T C H	 D A T E   T O	 DDMMCCYY
      *
	     MOVE W22-CY	 TO W22-CCYY
	     MOVE W22-M 	 TO W22-MM
	     MOVE W22-D 	 TO W22-DD
	     MOVE W22-DMCY	 TO W02-PRN-DATE.
	     MOVE W15-PAYEE	 TO W02-PRN-PAY.
	     MOVE W15-VALUE	 TO W02-PRN-VAL.
	   IF WS-BATCH = "Y"
	       MOVE ZERO	 TO BCH-KEY
	       PERFORM READ-CHQBATCH THRU READ-CHQBATCH-EXIT
	       MOVE BCH-DATE	 TO BCH-KEY
	       MOVE W22-DMCY	 TO BCH-DATE
	       MOVE W15-PAYEE	 TO BCH-PAYEE
	       MOVE W15-BANK	 TO BCH-BANK
	       MOVE W15-BANK-NAME
				 TO BCH-BANK-NAME
	       MOVE W15-NARRATIVE-1
				 TO BCH-NARRATIVE-1
	       MOVE 1		 TO WS-S8
	       PERFORM BA40
	       MOVE W15-VALUE	 TO BCH-VALUE
	       MOVE ZERO	 TO BCH-CHQNO
	       MOVE SPACES	 TO BCH-CRED
				    BCH-CNAME
	       IF WS-CRD-CHQ = "Y"
		   MOVE "C"	 TO BCH-TYPE
		   MOVE W15-CRED TO BCH-CRED
		   MOVE W15-CNAME
				 TO BCH-CNAME
	       ELSE
		   MOVE "G"	 TO BCH-TYPE
	       END-IF
	       MOVE SPACE	 TO BCH-STATUS
	       PERFORM WRITE-CHQBATCH THRU WRITE-CHQBATCH-EXIT
	       MOVE ZERO	 TO BCH-KEY
	       PERFORM READ-CHQBATCH THRU READ-CHQBATCH-EXIT
	       ADD 1		 TO BCH-DATE
	       PERFORM REWRITE-CHQBATCH THRU WRITE-CHQBATCH-EXIT
	   ELSE
	       PERFORM CALL-CHQPRINT.
	     GO TO BA02.

       BA40.
	     MOVE W15-GL-AC(WS-S8)
				 TO BCH-GL-AC(WS-S8).
	     MOVE W15-GLAC-NAME(WS-S8)
				 TO BCH-GLAC-NAME(WS-S8).
	     MOVE W15-NARRATIVE(WS-S8)
				 TO BCH-NARRATIVE(WS-S8).
	     MOVE W15-AMOUNT(WS-S8)
				 TO BCH-GL-VALUE(WS-S8).
	   IF WS-S8 < 10
	       ADD 1		 TO WS-S8
	       GO TO BA40.

       BA49.
	   EXIT.

       BA50.
	     ACCEPT SA-CHQ-VAL.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      GO TO BA10
		 WHEN OTHER	 CALL X"E5"
		      GO TO BA35
	       END-EVALUATE.
	   IF W15-VALUE = ZERO
	       GO TO BA10.
	     MOVE 14		 TO SLIN.
	     PERFORM CHECK-SETUP THRU CHECK-EXIT.
020250	   IF WS-OPTION = "N"
	       GO TO BA10.
	   IF W15-VALUE < 2.00
	       MOVE "Cheque amount LESS than 2.00"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO BA50.
	     GO TO BA39.

       BA999.
	     EXIT.

       CA000	       SECTION 50.
       CA00.
	     OPEN I-O CHQBATCH.
	   IF WS-STATUS = "05"
	       CLOSE CHQBATCH
	       OPEN OUTPUT CHQBATCH
	       CLOSE CHQBATCH
	       OPEN I-O CHQBATCH
	       INITIALIZE BCH-REC1
	       MOVE ZERO	 TO BCH-KEY
	       MOVE 1		 TO BCH-DATE
	       PERFORM WRITE-CHQBATCH THRU WRITE-CHQBATCH-EXIT.
	     PERFORM BA000.

       CA02.
026330       DISPLAY CLR-SCREEN.
	     DISPLAY "BATCH CHEQUE PRINTING" AT 0230
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     MOVE "N"		 TO WS-SKIP.

       CA05.
	     MOVE "'P'rint,'V'iew,'A'llocate numbers or 'E'xit [P]"
				 TO WS-ERR-MES.
	     MOVE "P"		 TO WS-OPTION.
	     PERFORM OPT-MESSAGE.
	   IF NOT (WS-OPTION = "A" OR "E" OR "P" OR "V")
	       GO TO CA05.
	   IF WS-OPTION = "E"
	       GO TO CA170.
	   IF WS-OPTION = "V"
	       GO TO CA15.
	   IF WS-OPTION = "A"
	       MOVE "Y" 	 TO WS-SKIP
	       GO TO CA120.
      *
      *    ****    S E T   T H E   S T A R T   K E Y   I N   T H E
      * 	   B A T C H   F I L E	 A N D	 F I N D   T H E
      * 	   F I R S T   R E C O R D
      *
	     MOVE 1		 TO BCH-KEY.
	     PERFORM START-AT-CHQBATCH-KEY THRU READ-CHQBATCH-EXIT.
	   IF WS-F-ERROR = 58
	       GO TO CA170.
      *
      *    ****    O P E N   T H E   C H E Q U E   P R I N T E R
      *
	     PERFORM OPEN-PRINTER.
	     MOVE "P"		 TO WS-COMMAND.
	     MOVE "D"		 TO W02-PRN-TYPE.
      *
      *    ****    R E A D   T H E   B A T C H	 F I L E   A N D
      * 	   P R I N T   T H E   C H E Q U E S
      *
       CA10.
	     PERFORM READ-CHQBATCH-NEXT THRU READ-CHQBATCH-EXIT.
	   IF WS-F-ERROR = 58
	       GO TO CA165.
	   IF BCH-STATUS = "P" OR "X" OR "A"
	       GO TO CA10.
	     MOVE BCH-DATE	 TO W02-PRN-DATE.
	     MOVE BCH-PAYEE	 TO W02-PRN-PAY.
	     MOVE BCH-VALUE	 TO W02-PRN-VAL.
	     PERFORM CALL-CHQPRINT.
	     MOVE "P"		 TO BCH-STATUS.
	     PERFORM REWRITE-CHQBATCH THRU WRITE-CHQBATCH-EXIT.
	     GO TO CA10.
      *
      *    ****    V I E W   B A T C H	 F I L E   R E C O R D S
      *
       CA15.
026330	     DISPLAY CLR-SCREEN.
	     DISPLAY "REVIEW CHEQUE PRINTING BATCH" AT 0227
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     MOVE 4		 TO SHADE-ROW.
	     MOVE 10		 TO SHADE-COL.
	     MOVE 63		 TO SHADE-WIDTH.
	     MOVE 18		 TO SHADE-LINES.
	     DISPLAY S-CHEQUE.
	     PERFORM SCREEN-SHADOW.
      *
      *    ****    S E T   T H E   S T A R T   K E Y   I N   T H E
      * 	   B A T C H   F I L E	 A N D	 F I N D   T H E
      * 	   F I R S T   R E C O R D
      *
       CA18.
	     MOVE 1		 TO BCH-KEY.
	     PERFORM START-AT-CHQBATCH-KEY THRU READ-CHQBATCH-EXIT.
	   IF WS-F-ERROR = 58
	       MOVE "No cheques to view"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO CA170.
      *
      *    ****    R E A D   T H E   B A T C H	 F I L E   A N D
      * 	   D I S P L A Y   T H E   D E T A I L S
      *
       CA20.
	     PERFORM READ-CHQBATCH-NEXT THRU READ-CHQBATCH-EXIT.
	   IF WS-F-ERROR = 58
	       PERFORM READ-CHQBATCH-PREV THRU READ-CHQBATCH-EXIT
	       IF BCH-KEY = ZERO
		   GO TO CA170.
	     PERFORM CA15.

       CA25.
	     MOVE BCH-DATE	 TO W22-DMCY.
	   IF WS-SKIP = "N"
	       MOVE BCH-CHQNO	 TO W15-CHQ-NO.
	     MOVE BCH-PAYEE	 TO W15-PAYEE.
	     MOVE BCH-BANK	 TO W15-BANK.
	     MOVE BCH-BANK-NAME  TO W15-BANK-NAME.
	     MOVE BCH-NARRATIVE-1
				 TO W15-NARRATIVE-1.
	     MOVE 1		 TO WS-S8.

       CA26.
	     MOVE BCH-GL-AC(WS-S8)
				 TO W15-GL-AC(WS-S8).
	     MOVE BCH-GLAC-NAME(WS-S8)
				 TO W15-GLAC-NAME(WS-S8).
	     MOVE BCH-NARRATIVE(WS-S8)
				 TO W15-NARRATIVE(WS-S8).
	     MOVE BCH-GL-VALUE(WS-S8)
				 TO W15-AMOUNT(WS-S8).
	   IF WS-S8 < 10
	       ADD 1		 TO WS-S8
	       GO TO CA26.
	     MOVE 1		 TO WS-S8.
	     MOVE BCH-VALUE	 TO W15-VALUE
      *
      *    ****    R E M O V E	 C E N T U R Y	 F R O M   D A T E
      * 	   (DDMMYY)
      *
	     MOVE W22-CCYY	 TO W22-CY.
	     MOVE W22-MM	 TO W22-M.
	     MOVE W22-DD	 TO W22-D.
	     MOVE W22-CYMD	 TO W22-DTE2.
	     MOVE W22-CC2	 TO W22-CC3.
	     MOVE W22-YY2	 TO W22-YY3.
	     MOVE W22-MM2	 TO W22-MM3.
	     MOVE W22-DD2	 TO W22-DD3.
	     MOVE W22-DTE3	 TO W15-DATE.
	     DISPLAY SA-CHEQUE.
	     DISPLAY SD-CHQ-ALLOCATE.
	   IF NOT (BCH-STATUS = " ")
	       DISPLAY "Cheque has been printed" AT 0842
			WITH FOREGROUND-COLOR 3 HIGHLIGHT
			     BACKGROUND-COLOR 5.
	     MOVE "N"		 TO WS-CRD-CHQ.
	   IF BCH-TYPE = "C"
	       PERFORM DA00
	       MOVE BCH-CRED	 TO W15-CRED W15-ACNO
	       MOVE BCH-CNAME	 TO W15-NAME W15-CNAME
	       DISPLAY W15-ACNO AT 2223
		       WITH FOREGROUND-COLOR 1 BACKGROUND-COLOR 7
	       DISPLAY W15-NAME AT 2230
		       WITH FOREGROUND-COLOR 1 BACKGROUND-COLOR 7
	       MOVE "Y" 	 TO WS-CRD-CHQ.
      *
      *    ****    U S E R   O P T I O N S
      *
       CA30.
	     DISPLAY "" AT 2516 WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     " or " "" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     " - " "A" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "mend, " "D" WITH FOREGROUND-COLOR 6 HIGHLIGHT
		     "elete or "
		     "E" WITH FOREGROUND-COLOR 6 HIGHLIGHT "xit".
	   IF BCH-STATUS = "P"
	       DISPLAY "R" AT 2539 WITH FOREGROUND-COLOR 6 HIGHLIGHT
		       "emove printed flag or "
			WITH FOREGROUND-COLOR 3
		       "E" WITH FOREGROUND-COLOR 6 HIGHLIGHT "xit".
	     MOVE SPACE 	 TO WS-OPTION.
      *
      *    ****    G E T   T H E   U S E R   O P T I O N
      *
       CA35.
	   IF BCH-STATUS = "P"
	       ACCEPT WS-OPTION AT 2567
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT
			   BACKGROUND-COLOR 5 UPDATE AUTO
	   ELSE
	       ACCEPT WS-OPTION AT 2547
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT
			   BACKGROUND-COLOR 5 UPDATE AUTO.
	   IF ADIS-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN UP-KEY
		      GO TO CA110
		 WHEN DOWN-KEY
		      GO TO CA20
		 WHEN OTHER
		      CALL X"E5"
	       END-EVALUATE
	       GO TO CA35
	   ELSE
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      GO TO CA02
		 WHEN OTHER
		     CALL X"E5"
		     GO TO CA35
	       END-EVALUATE.
	     CALL "CBL_TOUPPER" USING WS-OPTION
				BY VALUE WS-LENGTH
				RETURNING WS-STATUS.
	   IF NOT (WS-OPTION = "A" OR "D" OR "E")
	       IF (BCH-STATUS = "P") AND (WS-OPTION NOT = "R")
		   GO TO CA35.
      *
      * 	  **** E X I T ****
      *
	   IF WS-OPTION = "E"
	       GO TO CA02.
      *
      * 	  **** D E L E T E ****
      *
	   IF WS-OPTION = "D"
	       GO TO CA115.
      *
      * 	  **** A L L O W   F O R   C H E Q U E	 T O   B E
      * 	       R E P R I N T E D ****
      *
	   IF (WS-OPTION = "R") AND (BCH-STATUS = "P")
	       MOVE SPACE	 TO BCH-STATUS
	       PERFORM REWRITE-CHQBATCH THRU WRITE-CHQBATCH-EXIT
	       PERFORM CA15
	       GO TO CA25.
      *
      * 	  **** A M E N D ****
      *
	   IF NOT (BCH-STATUS = " ")
	       MOVE "May not ammend a printed cheque"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO CA30.
	   IF WS-CRD-CHQ = "Y"
	       PERFORM DA000
	       IF WS-ERROR = 9
		   PERFORM CA15
		   GO TO BA20
	       END-IF
	       IF WS-ERROR > ZERO
		   MOVE "N"	 TO WS-CRD-CHQ
		   MOVE SPACES	 TO W15-CRED W15-ACNO
				    W15-NAME W15-CNAME
		   GO TO BA02.
      *
      *    ****    A L L O W   U S E R	 T O   A M E N D   T H E
      *		   C H E Q U E	 D A T E
      *
       CA40.
	     ACCEPT SA-CHQ-DTE.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      PERFORM CA15
		      GO TO CA20
		 WHEN OTHER	 CALL X"E5"
		     GO TO CA40
	       END-EVALUATE.
027380	     MOVE W15-DATE	 TO W10-EDTE.
027390       PERFORM CHECK-DATE.
027400     IF WS-ERROR = 1
027410	       MOVE "Date"	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
027420	       GO TO CA40.
      *
      *    ****    I N C L U D E   C E N T U R Y   I N	 D A T E
      *
	     MOVE W22-DTE1	 TO W22-CYMD
				    W22-DTE2.
      *
      *    ****    C H E C K   I F   T H E   C H E Q U E   I S
      * 	   P O S T   D A T E D	 O R   S T A L E
      *
	   IF W22-CYMD = W12-T-CYMD
		GO TO CA45.
	   IF W22-CYMD < W12-T-CYMD
	       GO TO CA43.
	   IF NOT (WS-CRD-CHQ = "Y")
027410	       MOVE "G/L Cheques may not be post dated"
				 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
027420	       GO TO CA40.
	     MOVE " "		 TO WS-OPTION.

       CA42.
	     MOVE "Cheque is Post-Dated; Accept Y/N?  [ ]"
				 TO WS-ERR-MES.
	     MOVE 15		 TO SLIN.
	     PERFORM OPT-SETUP THRU OPT-EXIT.
	   IF NOT (WS-OPTION = "Y" OR "N")
	       GO TO CA42.
	   IF WS-OPTION = "Y"
	       GO TO CA45.
	     GO TO CA40.

       CA43.
	   IF W22-CY = W12-TCY
		MOVE ZERO	 TO WS-S8
	   ELSE
		SUBTRACT W22-CY FROM W12-TCY
				 GIVING WS-S8.
	   IF WS-S8 > 1
	       GO TO CA44.
	   IF WS-S8 > ZERO
	       COMPUTE WS-S7 = (W12-TMM + 12) - W22-M
	   ELSE
	       SUBTRACT W22-M FROM W12-TMM
				 GIVING WS-S7.
	   IF WS-S7 < 6
	       GO TO CA45.
	   IF WS-S7 > 6
	       GO TO CA44.
	   IF W22-D > W12-TDD
	       GO TO CA45.

       CA44.
	     MOVE "Cheque is STALE; change date"
				 TO WS-ERR-STRING
003260	     PERFORM ERROR-MESSAGE.
	     GO TO CA40.
      *
      *    ****    A L L O W   U S E R	 T O   A M E N D   T H E
      *		   P A Y E E
      *
       CA45.
	     ACCEPT SA-CHQ-PAY.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		     GO TO CA40
		 WHEN OTHER	 CALL X"E5"
		     GO TO CA45
	       END-EVALUATE.
	   IF W15-PAYEE = SPACES
	       MOVE "Payee may not be left BLANK"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO CA45.

       CA50.
	     DISPLAY "F1" AT 2502
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "=Help,"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "F2" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " to do Account Lookup - "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "Esc" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "ape to exit"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.

       CA55.
	     ACCEPT SA-CHQ-BANK.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      PERFORM CLEAR-L50
		      GO TO CA45
		 WHEN F1-KEY
		      PERFORM HELP-ROUTINE
		 WHEN F2-KEY
		      MOVE ZERO	 TO W15-ACCOUNT
		      PERFORM AA350
		 WHEN OTHER
		      CALL X"E5"
		      GO TO CA55
	       END-EVALUATE
               IF W15-ACCOUNT = ZERO
015990		   GO TO CA55
	       END-IF
	       MOVE W15-ACCOUNT  TO W15-BANK
	       DISPLAY SA-CHQ-BANK.
	     PERFORM CLEAR-L50.
013810	   IF W15-BANK = ZERO
013820	       GO TO CA45.
	     MOVE W15-BANK	 TO W15-ACCOUNT
013830     IF W15-ASER = ZERO
013840	       MOVE WS-ER7	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
013850	       GO TO CA55.
008970	     MOVE W15-ACCOUNT	 TO G-AC.
008980       PERFORM READ-GACCNT THRU READ-GACCNT-EXIT.
021840	   IF WS-F-ERROR = 8
013900	       MOVE WS-ER6	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
013910	       GO TO CA50.
	     MOVE G-NAME	 TO W15-BANK-NAME.
	     DISPLAY SD-CHQ-BNAME.

       CA60.
	     ACCEPT SA-CHQ-NAR-1.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      GO TO CA50
		 WHEN OTHER	 CALL X"E5"
		      GO TO CA60
	       END-EVALUATE.
	   IF W15-NARRATIVE-1 = SPACES
	       MOVE "Narrative may not be left BLANK"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO CA60.
	     MOVE 11		 TO LIN.
	     MOVE 1		 TO WS-S8.

       CA65.
	     PERFORM CA50.

       CA70.
	     ACCEPT SA-CHQ-GLAC AT LINE LIN.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      PERFORM CLEAR-L50
		      IF WS-S8 = 1
			  GO TO CA60
		      ELSE
			  GO TO CA85
		 WHEN F1-KEY
		      PERFORM HELP-ROUTINE
		 WHEN F2-KEY
		      MOVE ZERO	 TO W15-ACCOUNT
		      PERFORM AA350
		 WHEN OTHER
		      CALL X"E5"
		      GO TO CA70
	       END-EVALUATE
               IF W15-ACCOUNT = ZERO
015990		   GO TO CA70
	       END-IF
	       MOVE W15-ACCOUNT  TO W15-GL-AC(WS-S8)
	       DISPLAY SA-CHQ-GLAC AT LINE LIN.
	     PERFORM CLEAR-L50.
013810	   IF W15-GL-AC(WS-S8) = ZERO
	       IF WS-S8 = 1
013820		   GO TO CA60
	       ELSE
		   GO TO CA85.
	      MOVE W15-GL-AC(WS-S8)
				 TO W15-ACCOUNT
013830     IF W15-ASER = ZERO
013840	       MOVE WS-ER7	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
013850	       GO TO CA65.
008970	     MOVE W15-ACCOUNT	 TO G-AC.
008980       PERFORM READ-GACCNT THRU READ-GACCNT-EXIT.
021840	   IF WS-F-ERROR = 8
013900	       MOVE WS-ER6	 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
013910	       GO TO CA70.
	     MOVE G-NAME	 TO W15-GLAC-NAME(WS-S8).
	     DISPLAY SD-CHQ-GNAME AT LINE LIN.
	   IF LIN > 15
	       MOVE 11		 TO SLIN
	   ELSE
	       MOVE 16		 TO SLIN.
	     PERFORM CHECK-SETUP THRU CHECK-EXIT.
020250	   IF WS-OPTION = "N"
	       GO TO CA65.

       CA75.
	   IF W15-NARRATIVE(WS-S8) = SPACES
	       MOVE W15-NARRATIVE-1
				 TO W15-NARRATIVE(WS-S8).
	     ACCEPT SA-CHQ-GLA-NAR AT LINE LIN.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      DISPLAY SD-CHQ-GNAME AT LINE LIN
		      GO TO CA65
		 WHEN OTHER	 CALL X"E5"
		      GO TO CA75
	       END-EVALUATE.
	   IF W15-NARRATIVE(WS-S8) = SPACES
	       MOVE "Narrative may not be left BLANK"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO CA75.
	   IF NOT (W15-AMOUNT(WS-S8) = ZERO)
	       SUBTRACT W15-AMOUNT(WS-S8)
				 FROM W15-VALUE.

       CA80.
	     ACCEPT SA-CHQ-GLA-VAL AT LINE LIN.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      GO TO CA75
		 WHEN OTHER	 CALL X"E5"
		      GO TO CA80
	       END-EVALUATE.
	   IF W15-AMOUNT(WS-S8) = ZERO
	       PERFORM CA90 THRU CA100
	       DISPLAY SD-CHQ-ALLOCATE
	       GO TO CA65.
	     ADD W15-AMOUNT(WS-S8)
				 TO W15-VALUE.
	     MOVE W15-AMOUNT(WS-S8)
				 TO BCH-GL-VALUE(WS-S8).
	     DISPLAY SA-CHQ-VAL.
	     MOVE 14		 TO SLIN.
	     PERFORM CHECK-SETUP THRU CHECK-EXIT.
020250	   IF WS-OPTION = "N"
	       SUBTRACT W15-AMOUNT(WS-S8)
				 FROM W15-VALUE
	       GO TO CA65.
	     DISPLAY SD-CHQ-GNAME AT LINE LIN.
	   IF NOT (WS-CRD-CHQ = "Y")
	       IF WS-S8 < 10
		   ADD 1	 TO WS-S8 LIN
		   GO TO CA65.
      *
      *    ****    C H E C K   F O R   M I N I M U M   V A L U E
      *
       CA85.
	   IF W15-VALUE < 2.00
	       MOVE "Cheque amount LESS than 2.00"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO CA50.
	     MOVE 14		 TO SLIN.
	     PERFORM CHECK-SETUP THRU CHECK-EXIT.
020250	   IF WS-OPTION = "N"
	       GO TO CA40.
	     MOVE W22-DTE1	 TO W22-DTE2.
      *
      *    ****    S W I T C H	 D A T E   T O	 DDMMCCYY
      *
	     MOVE W22-CY	 TO W22-CCYY.
	     MOVE W22-M 	 TO W22-MM.
	     MOVE W22-D 	 TO W22-DD.
	     MOVE W22-DMCY	 TO BCH-DATE.
	     MOVE W15-PAYEE	 TO BCH-PAYEE.
	     MOVE W15-VALUE	 TO BCH-VALUE.
	   IF WS-CRD-CHQ = "Y"
	       MOVE "C"		 TO BCH-TYPE
	       MOVE W15-CRED	 TO BCH-CRED
	       MOVE W15-CNAME	 TO BCH-CNAME
	   ELSE
	       MOVE "G"		 TO BCH-TYPE
	       MOVE SPACES	 TO BCH-CRED BCH-CNAME.
	     PERFORM REWRITE-CHQBATCH THRU WRITE-CHQBATCH-EXIT.
	     GO TO CA25.
      *
      *    ****    D E L E T E	 A N   A L L O C A T I O N   E N T R Y
      *
       CA90.
	     MOVE WS-S8 	 TO WS-S7.
	     ADD 1 WS-S8	 GIVING WS-S6.
      *
      *    ****    C L E A R   W O R K	 F I E L D S
      *
       CA95.
	     MOVE SPACES	 TO W15-GLAC-NAME (WS-S7)
				    W15-NARRATIVE (WS-S7).
	     MOVE ZERO		 TO W15-GL-AC  (WS-S7)
				    W15-AMOUNT (WS-S7).
	   IF WS-S6 > 10
	       GO TO CA100.
      *
      *    ****    S H I F T   U P   T H E   D A T A
      *
	     MOVE W15-GLAC-NAME (WS-S6)
				 TO W15-GLAC-NAME (WS-S7).
	     MOVE W15-NARRATIVE (WS-S6)
				 TO W15-NARRATIVE (WS-S7).
	     MOVE W15-GL-AC (WS-S6)
				 TO W15-GL-AC (WS-S7).
	     MOVE W15-AMOUNT (WS-S6)
				 TO W15-AMOUNT (WS-S7).
	     ADD 1		 TO WS-S6 WS-S7.
	     GO TO CA95.

       CA100.
	     EXIT.

       CA110.
	   IF BCH-KEY < 2
	       GO TO CA25.
	     PERFORM READ-CHQBATCH-PREV THRU READ-CHQBATCH-EXIT.
	   IF BCH-KEY = ZERO
	       GO TO CA20.
	     GO TO CA25.

       CA115.
	     MOVE "Confirm deletion Y/N  [ ]"
				 TO WS-ERR-MES.
	     MOVE " "		 TO WS-OPTION.
	     PERFORM OPT-MESSAGE.
	   IF NOT (WS-OPTION = "Y" OR "N")
	       GO TO CA115.
	   IF WS-OPTION = "N"
	       GO TO CA25.
	     PERFORM DELETE-CHQBATCH-REC THRU WRITE-CHQBATCH-EXIT.
	     GO TO CA110.
      *
      *    ****    A L L O C A T E   N U M B E R S
      *
       CA120.
026330	     DISPLAY CLR-SCREEN.
	     DISPLAY "ALLOCATE CHEQUE NUMBERS" AT 0229
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     MOVE 1		 TO BCH-KEY.
	     PERFORM START-AT-CHQBATCH-KEY THRU READ-CHQBATCH-EXIT.
	   IF WS-F-ERROR = 58
	       MOVE "No cheques for allocation"
				 TO WS-ERR-STRING
	       PERFORM ERROR-SETUP THRU ERROR-POS
	       MOVE 15		 TO SLIN
003260	       PERFORM ERROR-DISPLAY THRU ERROR-EXIT
	       GO TO CA170.
	     MOVE 1		 TO WS-CHQ.

       CA125.
	     PERFORM READ-CHQBATCH-NEXT THRU READ-CHQBATCH-EXIT.
	   IF WS-F-ERROR = 58
	       PERFORM READ-CHQBATCH-PREV THRU READ-CHQBATCH-EXIT
	       IF BCH-KEY = ZERO
		   GO TO CA170
	       ELSE
		   GO TO CA150.
	   IF NOT (BCH-STATUS = "P")
	       GO TO CA125.
026330	     DISPLAY CLR-SCREEN.
	     DISPLAY "ALLOCATE CHEQUE NUMBERS" AT 0229
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT.
	     MOVE 4		 TO SHADE-ROW.
	     MOVE 10		 TO SHADE-COL.
	     MOVE 63		 TO SHADE-WIDTH.
	     MOVE 18		 TO SHADE-LINES.
	     DISPLAY S-CHEQUE.
	     PERFORM SCREEN-SHADOW.
	     PERFORM CA25 THRU CA26.
	   IF WS-CHQ = 0
	       MOVE SPACE	 TO WS-OPTION
	       GO TO CA145.
	     MOVE "Y"		 TO WS-OPTION.

       CA130.
	     MOVE SPACES     TO WS-ERR-MES.
033840	     STRING "Start with this cheque Y/N?  ["
		    DELIMITED SIZE
		    WS-OPTION DELIMITED SIZE
		    "]" DELIMITED SIZE
			     INTO WS-ERR-MES.
	     MOVE 15		 TO SLIN.
	     PERFORM OPT-SETUP THRU OPT-EXIT.
	   IF NOT (WS-OPTION = "N" OR "Y")
	       GO TO CA130.
	   IF WS-OPTION = "N"
	       GO TO CA125.
	     PERFORM SAVE-SCREEN.
	     MOVE 16		 TO SHADE-ROW.
	     MOVE 25		 TO SHADE-COL.
	     MOVE 33		 TO SHADE-WIDTH.
	     MOVE 2		 TO SHADE-LINES.
	     DISPLAY "旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴" AT 1523
		      WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
		     "" WITH FOREGROUND-COLOR 7 HIGHLIGHT
			      BACKGROUND-COLOR 7.
	     DISPLAY " Start at cheque number " AT 1623
		      WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
		     "        " WITH FOREGROUND-COLOR 7 HIGHLIGHT
				     BACKGROUND-COLOR 5
		     " " WITH FOREGROUND-COLOR 7 HIGHLIGHT
			      BACKGROUND-COLOR 7.
	     DISPLAY "" AT 1723
		      WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
		     "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸"
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT
			   BACKGROUND-COLOR 7.
	     PERFORM SCREEN-SHADOW.
	     MOVE ZERO		 TO W15-CHQ-NO.

       CA135.
	     ACCEPT SA-ALLOCATE.
	     PERFORM RESTORE-SCREEN.
	     DISPLAY SD-CHQ-NO.
	     PERFORM CHECK-CORRECT.
	   IF WS-OPTION = "N"
	       MOVE "Y"		 TO WS-OPTION
	       GO TO CA130.
	     MOVE ZERO		 TO WS-CHQ.

       CA140.
	     MOVE W15-CHQ-NO	 TO BCH-CHQNO.
	     MOVE "A"		 TO BCH-STATUS.
	     PERFORM REWRITE-CHQBATCH THRU WRITE-CHQBATCH-EXIT.
	   IF W15-CHQ-NO < 999999
	       ADD 1		 TO W15-CHQ-NO
	   ELSE
	       MOVE 1		 TO W15-CHQ-NO.
	     GO TO CA125.

       CA145.
	     MOVE "'A'llocate or 'E'nd  [ ]"
				 TO WS-ERR-MES.
	     PERFORM OPT-MESSAGE.
	   IF NOT (WS-OPTION = "A" OR "E")
	       GO TO CA145.
	   IF WS-OPTION = "E"
	       GO TO CA170.
	     GO TO CA140.

       CA150.
	     MOVE "Number allocation complete - Press ANY key"
				 TO WS-ERR-MES.
	     PERFORM OPT-MESSAGE.
	     GO TO CA170.

       CA165.
	     MOVE "C"		 TO WS-COMMAND.
	     PERFORM CALL-CHQPRINT.
	     CANCEL "UTP\CHQPRN".

       CA170.
	     CLOSE CHQBATCH.

       CA999.
	     EXIT.
      /
      *    ****    C H E Q U E	 P A Y M E N T S   T O	 T R A D E
      * 	   C R E D I T O R S
      *
       DA000	       SECTION 50.
       DA00.
	     DISPLAY "旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
      -		     "컴컴컴컴" AT 2111 WITH FOREGROUND-COLOR 0
					      BACKGROUND-COLOR 7
		     "" WITH FOREGROUND-COLOR 7 HIGHLIGHT
			      BACKGROUND-COLOR 7.
	     DISPLAY " " AT 2211
		      WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
		     "Cred. A/C " WITH FOREGROUND-COLOR 6 HIGHLIGHT
				       BACKGROUND-COLOR 7
		     "                                               "
		      WITH FOREGROUND-COLOR 7 HIGHLIGHT
			   BACKGROUND-COLOR 7.
	     DISPLAY "" AT 2311
		      WITH FOREGROUND-COLOR 0 BACKGROUND-COLOR 7
		     "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
      -		     "컴컴컴컴" WITH FOREGROUND-COLOR 7 HIGHLIGHT
				      BACKGROUND-COLOR 7.
011140	     MOVE SPACES	 TO W15-ACNO.

011150 DA05.
	     DISPLAY "F1" AT 2502
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     "=Help,"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "F2" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " to do Creditor Lookup "
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1
		     "Esc" WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " to exit"
		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 1.
	     ACCEPT W15-ACNO AT 2223
		    WITH FOREGROUND-COLOR 1 BACKGROUND-COLOR 7.
	   IF USER-FUNC
	       EVALUATE KEY-CODE-1
		 WHEN ESC-KEY
		      MOVE 9	 TO WS-ERROR
		      GO TO DA999
		 WHEN F1-KEY
		     PERFORM HELP-ROUTINE
		 WHEN F2-KEY
		     PERFORM AA50-LOOKUP
		 WHEN OTHER
		     CALL X"E5"
		     GO TO DA05
	       END-EVALUATE
	       DISPLAY W15-ACNO AT 2223
		       WITH FOREGROUND-COLOR 1 BACKGROUND-COLOR 7
               IF W15-ACNO = SPACES
015990             GO TO DA05.
011170	   IF W15-ACNO = SPACES
	       MOVE 1		 TO WS-ERROR
011180	       GO TO DA999.
	     MOVE 5		 TO WS-LENGTH.
	     CALL "CBL_TOUPPER" USING W15-ACNO
				BY VALUE WS-LENGTH
				RETURNING WS-STATUS.
	     MOVE 1		 TO WS-LENGTH.
011200	     PERFORM AE155-GET-CREDITOR.
011210     IF WS-ERROR NOT = ZERO
011220	       MOVE "Account number"
				 TO WS-ERR-STRING
003260	       PERFORM ERROR-MESSAGE
011230         GO TO DA05.
011240	     MOVE P-NAME	 TO W15-NAME.
011250	     DISPLAY P-NAME AT 2230
		     WITH FOREGROUND-COLOR 1 BACKGROUND-COLOR 7.
	     MOVE 14		 TO SLIN.
	     PERFORM CHECK-SETUP THRU CHECK-EXIT.
020250	   IF WS-OPTION = "N"
	       GO TO DA05.
	     MOVE W15-ACNO	 TO W15-CRED.
	     MOVE W15-NAME	 TO W15-CNAME W15-PAYEE.
	     MOVE ZERO		 TO WS-ERROR.
	     MOVE W70-CREGL	 TO W15-GL-AC (1).

       DA999.
	     EXIT.
      /
049180 ZA000-INIT	       SECTION 90.
049190 ZA000-OPEN.
             PERFORM ZA55 THRU ZA60.
	     MOVE LS-PARID	 TO WS-PARID.
	     MOVE LS-L-OR-N	 TO W02-L-OR-N.
	     MOVE WS-SYS-ID	 TO W02-SYSID.
	     MOVE LS-TODAY-DDMMYY
				 TO TODAY-DDMMYY.
	     MOVE LS-USUB	 TO WS-USUB.
042000	     DISPLAY CLR-SCREEN.
      *
      *    ****    S E T   U P   T H E   F U N C T I O N   K E Y S
      *
	     MOVE 1		 TO USER-ACTION
				    USER-SETTING.
      *
      *    ESC, F1 to F10 keys
      *
	     MOVE ZERO		 TO USER-NUMBER.
	     MOVE 11		 TO USER-KEYS.
	     CALL X"AF" USING SET-BIT-PAIRS, USER-KEY-CONTROL.
      *
      *    PAGE-UP AND PAGE-DOWN KEYS
      *
	     MOVE 53		 TO USER-NUMBER.
	     MOVE 2		 TO USER-KEYS.
	     CALL X"AF" USING SET-BIT-PAIRS, USER-KEY-CONTROL.
      *
      *    UP AND DOWN ARROW KEYS
      *
	     MOVE 2		 TO USER-ACTION.
	     MOVE 3		 TO USER-SETTING.
	     MOVE 5		 TO USER-NUMBER.
	     MOVE 2		 TO USER-KEYS.
	     CALL X"AF" USING SET-BIT-PAIRS, USER-KEY-CONTROL.
      *
      *    ****    A C T I V A T E   M O U S E
      *
	     MOVE 64		 TO MOUSE-FUNC.
	     MOVE 1		 TO MOUSE-PARAM.
	     CALL X"AF" USING MOUSE-FUNC
			      MOUSE-PARAM.
	   IF MOUSE-FUNC NOT = 255
	       MOVE "Y"		 TO MOUSE-ATTACHED
	       MOVE 66		 TO MOUSE-FUNC
	       MOVE 0		 TO MOUSE-PARAM
	       CALL X"AF" USING MOUSE-FUNC
				MOUSE-PARAM
	   ELSE
	       GO TO ZA00A.
      *
      *    ****    S E T   M O U S E   K E Y   T O   A C T
      * 	   A S	 F U N C T I O N   K E Y
      *
	     MOVE 3		 TO USER-ACTION.
	     MOVE 27		 TO USER-NUMBER.
	     MOVE 2		 TO USER-KEYS.
	     CALL X"AF" USING SET-BIT-PAIRS, USER-KEY-CONTROL.
      *
      *    ****    P A R A M E T E R   F I L E
      *
       ZA00A.
	     MOVE "PARAM"	 TO AFID-KEY.

       ZA00-READ-APACFIDS.
000030	     READ APACFIDS WITH IGNORE LOCK
	       KEY IS AFID-KEY.
	   IF WS-STATUS = "00"
	       GO TO ZA00-READ-APACFIDS-EXIT.
006260	     STRING "Missing " DELIMITED SIZE
		     AFID-KEY DELIMITED BY " "
		     " file ID - Status " DELIMITED SIZE
		     WS-STATUS DELIMITED SIZE
		     INTO WS-ERR-MES.
	     PERFORM ERROR-LENGTH THRU ERROR-EXIT.
006370	     STOP RUN.

       ZA00-READ-APACFIDS-EXIT.
	     EXIT.

       ZA00A-CONTINUE.
	     MOVE AFID-PATH	 TO W02-PARAM.
	     MOVE "CHQBATCH"	 TO AFID-KEY.
	     PERFORM ZA00-READ-APACFIDS THRU ZA00-READ-APACFIDS-EXIT.
	     MOVE AFID-PATH	 TO W02-CHQBATCH.
	     MOVE "CREDIT"	 TO AFID-KEY.
	     PERFORM ZA00-READ-APACFIDS THRU ZA00-READ-APACFIDS-EXIT.
	     MOVE AFID-PATH	 TO W02-CREDIT.
	     MOVE "GACCNT"	 TO AFID-KEY.
	     PERFORM ZA00-READ-APACFIDS THRU ZA00-READ-APACFIDS-EXIT.
	     MOVE AFID-PATH	 TO W02-GACCNT.
042240	     OPEN I-O CREDIT.
042250	   IF RUNTIME-ERROR
               IF FLE-LOCKED
042130             GO TO ZA200
               ELSE
               IF FLE-LIMIT
                   GO TO ZA49
               ELSE
	       IF IDX-CORRUPT
                   MOVE 3        TO WS-F-ERROR
                   GO TO ZA50.
050190     IF WS-STATUS NOT = "00"
050200         MOVE 3            TO WS-F-ERROR
	       IF WS-STATUS = "39"
038770		   GO TO ZA50
	       ELSE
	       IF NOT (WS-STATUS = "41")
050210		   PERFORM OPEN-ERROR.
035470	     OPEN I-O GACCNT.
035480     IF RUNTIME-ERROR
               IF FLE-LOCKED
042030             GO TO ZA200
               ELSE
               IF FLE-LIMIT
		   GO TO ZA49
               ELSE
	       IF IDX-CORRUPT
		   MOVE 8	 TO WS-F-ERROR
                   GO TO ZA50.
035500     IF WS-STATUS NOT = "00"
035510	       MOVE 8		 TO WS-F-ERROR
	       IF WS-STATUS = "39"
038770		   GO TO ZA50
	       ELSE
	       IF NOT (WS-STATUS = "41")
050480		   PERFORM OPEN-ERROR.
	     MOVE 6		 TO WS-PARKEY.
             PERFORM READ-PARAM THRU READ-PARAM-EXIT.
             MOVE PAR-DEBGL      TO W70-DEBGL.
             MOVE PAR-CREGL      TO W70-CREGL.
             MOVE PAR-INTGL      TO W70-INTGL.
             MOVE PAR-BNKGL      TO W70-BNKGL.
             MOVE PAR-UNPROF     TO W70-UNPROF.
025630	     MOVE 1		 TO WS-PARKEY.
025640       PERFORM READ-PARAM THRU READ-PARAM-EXIT.
025660	     MOVE PAR-DMY	 TO W12-TODAY.
025670	     MOVE PAR-YMD	 TO W12-T-CYMD
				    W12-T-YMD.
      *    IF W12-YY > 55
      *
      *    ****   ASSUME 1900
      *
      *	       MOVE 19		 TO W12-CC
      *	   ELSE
      *
      *    ****   ASSUME 2000
      *
      *	       MOVE 20		 TO W12-CC.
025830	     GO TO ZA999-EXIT.

       ZA49.
             DISPLAY "Too many files OPEN" AT 0812
                      WITH FOREGROUND-COLOR 14.
             DISPLAY "Check the FILES option in CONFIG.SYS" AT 1012.
             DISPLAY "Press any key to continue" AT 1212.
             ACCEPT WS-OPTION AT 1238 WITH FOREGROUND-COLOR 15.
             GO TO ZA205.

039850 ZA50.
041650	   IF WS-F-ERROR = 3
041660         MOVE "CREDITOR"   TO WS-FILE
	   ELSE
041850	   IF WS-F-ERROR = 8
041860	       MOVE "G/L ACCOUNT file"
				 TO WS-FILE.
039980	     DISPLAY "Rebuild " AT 0812
039990                WS-FILE WITH FOREGROUND-COLOR 14.
040000       DISPLAY "Press any key to continue" AT 1012.
	     CALL X"AF" USING GET-SINGLE-CHAR, KEY-STATUS.

040020 ZA51.
040030	     EXIT PROGRAM.

       ZA55.
041220       MOVE 1              TO WS-S1.
021870	     MOVE SPACES	 TO WS-MID-LNE.

041240 ZA60.
021950	     MOVE WS-G3 	 TO WS-MCHR (11) WS-MCHR (45)
021960				    WS-MCHR (63)
				    WS-MCHR  (1) WS-MCHR (80)
				    WS-MCR  (8)	 WS-MCR (50)
021960                              WS-MCR  (66) WS-MCR (1)
				    WS-MCR  (80).
	     MOVE LS-COMPANY	 TO WS-TOP-COMP.
	   IF LS-USER = LS-SYS-ID
	       MOVE "Supervisor"  TO WS-WRKHD
	   ELSE
	       MOVE "Workstation"  TO WS-WRKHD
	       MOVE LS-USER	   TO WS-WRKST.

036260 ZA200.
036270	     DISPLAY "Files locked - Try later" AT 2502
036280		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     " " WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14
		     WS-STATUS
		     WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15
036290		     " Press any key"
036300		      WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 14.
036310	     ACCEPT WS-OPTION AT 2545
		    WITH BACKGROUND-COLOR 3 FOREGROUND-COLOR 15 AUTO.

       ZA205.
             EXIT PROGRAM.

025920 ZA999-EXIT.
025930       EXIT.
      /
      *    ****    I / O   E R R O R   M E S S A G E S
      *
042900 ZB000-ERROR	     SECTION 91.

041480 OPEN-ERROR.
041490       DISPLAY CLR-SCREEN.
041500       DISPLAY "Open error" AT 0812 WITH FOREGROUND-COLOR 14.
041510	     GO TO DISPLAY-FILE-NAME.

       READ-ERROR.
041490	     DISPLAY CLR-SCREEN.
041500       DISPLAY "Read error" AT 0812 WITH FOREGROUND-COLOR 14.
041510       GO TO DISPLAY-FILE-NAME.

041520 WRITE-ERROR.
041530       DISPLAY CLR-SCREEN.
041540       DISPLAY "Write error" AT 0812 WITH FOREGROUND-COLOR 14.
041510       GO TO DISPLAY-FILE-NAME.
       I-O-ERROR-EXIT.
             EXIT.

041560 DISPLAY-FILE-NAME.
041650	   IF WS-F-ERROR = 3
041660         MOVE W02-CREDIT   TO WS-FILE
041670         MOVE ZERO         TO WS-KEY
               MOVE P-NUMBER     TO WS-KEYX
041680     ELSE
041810	   IF WS-F-ERROR = 8
041820         MOVE W02-GACCNT   TO WS-FILE
041830	       MOVE ZERO	 TO WS-KEY
	       MOVE G-AC	 TO WS-KEYX
041840	   ELSE
041850	   IF WS-F-ERROR = 15
041860	       MOVE WS-PARID	 TO WS-FILE
041870	       MOVE WS-PARKEY	 TO WS-KEY
041840	   ELSE
041850	   IF WS-F-ERROR = 58
041860	       MOVE W02-CHQBATCH TO WS-FILE
041830	       MOVE ZERO	 TO WS-KEY
041870	       MOVE BCH-KEY	 TO WS-KEYX.
041880	   IF WS-STATUS = "10"
041890         MOVE "End of FILE" TO WS-STAT-MESSAGE
041900     ELSE
041910     IF WS-STATUS = "22"
041920         MOVE "Duplicate record number" TO WS-STAT-MESSAGE
041930     ELSE
041940     IF WS-STATUS = "23"
041950         MOVE "Invalid record number" TO WS-STAT-MESSAGE
041960     ELSE
041970     IF WS-STATUS = "24"
041980         MOVE "DISK full" TO WS-STAT-MESSAGE
041990     ELSE
042000     IF WS-STATUS = "30"
042010         MOVE "DISK error" TO WS-STAT-MESSAGE
042020     ELSE
042030     IF WS-STATUS = "94"
042040         MOVE "FILE locked" TO WS-STAT-MESSAGE.
045380       DISPLAY "File - " AT 1012 WS-FILE WITH FOREGROUND-COLOR 11.
045390       DISPLAY "Status " AT 1212
                      WS-STATUS WITH FOREGROUND-COLOR 11
                     ": " WS-STAT-MESSAGE WITH FOREGROUND-COLOR 14.
045400     IF WS-STATUS NOT = "94"
045410         DISPLAY "Key    " AT 1412
                        WS-KEY WITH FOREGROUND-COLOR 11
                        " " WS-KEYX WITH FOREGROUND-COLOR 11
045420         DISPLAY "Reverse backup or contact program Support"
                        AT 1612.
045440         DISPLAY "Please make a note of these details" AT 1812.
042170       STOP RUN.
